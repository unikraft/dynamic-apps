/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as A,r as u,l as f,w as c,o as r,a as n,T as ge,z as w,J as Ee,u as Ae,m as we,n as ke,g as Ie,c as v,b as l,d as i,t as b,k as R,v as Re,ah as xe,R as D,U as k,p as x,e as P,H as Pe,Q as Te,at as Ce,h,V as T,E as C,__tla as Se}from"./index.84d84090.3_3_0_0.js";import{C as Le,__tla as Oe}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{E as Ve,__tla as $e}from"./EntityList.9d5d453d.3_3_0_0.js";import{E as Ue,__tla as Ne}from"./EntityFilter.bf4158bc.3_3_0_0.js";import{s as S}from"./Developer.90ecd3d4.3_3_0_0.js";import{D as je,__tla as Me}from"./DisabledView.3ce50815.3_3_0_0.js";import{W as He,__tla as qe}from"./WorkspaceMixin.71f3f83c.3_3_0_0.js";import{V as Ke,__tla as Je}from"./VNode.44f1f698.3_3_0_0.js";import{__tla as Fe}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as Qe}from"./preferences.ea825a88.3_3_0_0.js";import{__tla as Ye}from"./EntityListEmptyState.9b958bba.3_3_0_0.js";import{__tla as We}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{__tla as Be}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import"./RedirectMixin.efeb36f2.3_3_0_0.js";let L,ze=Promise.all([(()=>{try{return Se}catch{}})(),(()=>{try{return Oe}catch{}})(),(()=>{try{return $e}catch{}})(),(()=>{try{return Ne}catch{}})(),(()=>{try{return Me}catch{}})(),(()=>{try{return qe}catch{}})(),(()=>{try{return Je}catch{}})(),(()=>{try{return Fe}catch{}})(),(()=>{try{return Qe}catch{}})(),(()=>{try{return Ye}catch{}})(),(()=>{try{return We}catch{}})(),(()=>{try{return Be}catch{}})()]).then(async()=>{const O={name:"AlertDeveloper",props:{developer:{type:Object,default:()=>({})},portalUrl:{type:String,default:""}},methods:{computeEmailName(e){try{return JSON.parse(e.meta).full_name||e.username}catch{return e.username||""}},getCompiledTemplate(){const e=this.developer.email,t=this.computeEmailName(this.developer),o="Your account has been approved",d=`Hello ${t},
Your developer account has been approved!

Navigate to ${this.portalUrl}/login To login use ${this.developer.email} and
the password you used at registration. If you do not remember the password used
please reply to this email requesting for it to be reset.

Thank you`;return encodeURI(`mailto:${e}?subject=${o}&body=${d}`)}}},V=["href"];function $(e,t,o,d,a,s){const y=u("KDropdownItem");return r(),f(y,{"data-testid":"email-btn","data-testaction":"menu-email"},{default:c(()=>[n("a",{class:"",href:s.getCompiledTemplate()}," Email ",8,V)]),_:1})}const U=A(O,[["render",$],["__scopeId","data-v-a53e03e8"]]),N={name:"InviteDevelopers",mixins:[ge],props:{portalUrl:{type:String,default:"",required:!1}},data(){return{errors:[],isVisible:!1,emailList:"",failedEmails:null}},computed:{...w(Ee,["workspace"]),...w(Ae,{perms:"permissions"}),sendDisabled(){return this.failedEmails===this.emailList},isAllowedToCreated(){return this.$rbac.isAllowed(this.perms,[{path:"/developers/invite",actions:["create"]}],this.workspace)}},methods:{...we(ke,["notify"]),openModal(){this.errors=[],this.isVisible=!0},closeModal(){this.errors=[],this.emailList="",this.isVisible=!1},sendInvite(){const e=this.emailList.replace(/\s+/g,"").split(",").filter(Boolean);if(e.length)return this.$api.createRecord("developers/invite",{emails:e}).then(this.handleSuccess).catch(this.handleError)},handleSuccess(e){const t=e.data.sent,o={type:"success",message:`${t.count} invite${t.count>1?"s":""} sent.`},d=e.data.error;return d.count>0&&(o.type="warning",o.message+=` ${d.count} invite${d.count>1?"s":""} failed.`),this.notify(o).then(()=>{if(o.type==="success")return this.closeModal();d.emails&&this.parseFailedInvites(d)})},handleError(e){const t=Ie(e),o=t.error||t,d={type:"danger",message:o};return o&&o.count&&(d.message=`${o.count} invite${o.count>1?"s":""} failed.`),this.notify(d).then(()=>{o.emails&&this.parseFailedInvites(o)})},parseFailedInvites(e){const t=Object.keys(e.emails).sort();this.errors=t.map(o=>({email:o,reason:`${e.emails[o].replace("Invalid email:","")}`})),this.emailList=t.join(", "),this.failedEmails=this.emailList}}},g=e=>(x("data-v-a670c1b8"),e=e(),P(),e),j={class:"invite-developers"},M=i(" Invite Developers "),H=g(()=>n("p",{class:"dev-list-description"}," Email ",-1)),q=g(()=>n("p",{class:"dev-list-instructions"}," Use commas to separate emails ",-1)),K={class:"invite-error-wrapper"},J=g(()=>n("p",{class:"invite-error-description"}," Errors ",-1)),F={class:"list-unstyled invite-error-list"},Q={class:"invite-error-reason"};function Y(e,t,o,d,a,s){const y=u("KButton"),E=u("KModal");return r(),v("div",j,[l(y,{disabled:!s.isAllowedToCreated,appearance:"primary",onClick:s.openModal},{default:c(()=>[M]),_:1},8,["disabled","onClick"]),l(E,{"is-visible":a.isVisible,title:`Invite Developers to ${e.workspace}`,"action-button-text":"Invite Developer",class:"invite-modal","tabbable-options":e.tabbableOptions,onProceed:s.sendInvite,onCanceled:s.closeModal},{"header-content":c(()=>[i(" Invite Developers to "+b(e.workspace),1)]),"body-content":c(()=>[H,R(n("textarea",{"onUpdate:modelValue":t[0]||(t[0]=_=>a.emailList=_),class:"email-textarea",rows:"4"},null,512),[[Re,a.emailList]]),q,R(n("div",K,[J,n("ul",F,[(r(!0),v(D,null,k(a.errors,_=>(r(),v("li",{key:_.email},[i(b(_.email)+" ",1),n("span",Q,b(_.reason),1)]))),128))])],512),[[xe,a.errors.length]])]),_:1},8,["is-visible","title","tabbable-options","onProceed","onCanceled"])])}const W=A(N,[["render",Y],["__scopeId","data-v-a670c1b8"]]),B={name:"DeveloperPortalList",components:{AlertDeveloper:U,ConfirmModalDialog:Le,DisabledView:je,EntityList:Ve,InviteDevelopers:W,PageHeader:Pe,VNode:Ke,EntityFilter:Ue},mixins:[He],data(){return{isLoading:!0,portalEnabled:null,portalAuthEnabled:null,actionItem:null,portalUrl:null,customAction:null,notifications:{APPROVED:!1,REQUESTED:!1,REJECTED:!1,REVOKED:!1,INVITED:!1},states:{APPROVED:{value:0,title:"Approved",text:"Developers approved for Dev Portal access.",shouldShowUpdate:!1,customActions:[{getText:e=>l("p",null,[i("Portal access for "),l("strong",null,[e.email]),i(" will be put \u201COn-Hold\u201D. They will NOT be able to continue using your Dev Portal and will NOT have access to your APIs. You can undo this by clicking \u201CRe-Approve\u201D in the \u201CRevoked\u201D list.")]),action:"Revoke",variant:"link",class:"revoke entity-action",type:"REVOKED"}],noResults:{title:"No Approved Developers",text:"Developers who are approved for Dev Portal access appear here.",ctaText:"Invite a Developer",ctaIsHidden:!0}},REVOKED:{value:3,title:"Revoked",text:"Developers revoked from Dev Portal access.",shouldShowUpdate:!1,customActions:[{getText:e=>l("p",null,[i("Are you sure you want to give access to "),l("strong",null,[e.email]),i("?")]),action:"Re-Approve",variant:"link",class:"re-approve entity-action",type:"APPROVED"}],noResults:{title:"No Revoked Developers",text:"Developers who have been revoked appear here. When a Developer is revoked, access to the Dev Portal is put on hold.",ctaText:"",ctaIsHidden:!0}},REJECTED:{value:2,title:"Rejected",text:"Developers rejected from Dev Portal access.",shouldShowUpdate:!1,customActions:[{getText:e=>l("p",null,[i("Are you sure you want to give access to "),l("strong",null,[e.email]),i("?")]),action:"Approve",variant:"link",class:"approve entity-action",type:"APPROVED"}],noResults:{title:"No Rejected Developers",text:`Developers who have been rejected appear here. Rejected Developers don't have access to your Dev Portal. They can't request access again. You can reject a Developer from the "Requested Access" or "Revoked" tab.`,ctaIsHidden:!0}},REQUESTED:{value:1,title:"Requested Access",text:"Developers requesting Dev Portal access.",shouldShowUpdate:!1,shouldShowDelete:!1,customActions:[{getText:()=>{},action:"Approve",skipModal:!0,variant:"link",class:"approve entity-action",type:"APPROVED"},{getText:e=>l("p",null,[i("Reject "),l("strong",null,[e.email]),i(" from your Dev Portal? They will not be able to request access again.")]),action:"Reject",variant:"link",class:"reject link-danger entity-action entity-action-danger",type:"REJECTED"}],noResults:{title:"No Requests for Access",text:"Developers who have completed the registration form and are waiting for your approval or rejection appear here.",ctaText:"Invite a Developer",ctaIsHidden:!0}}},schema:{id:{type:"text"}}}},computed:{entityListOptions(){return{entity:"developers",entityName:"Developer",params:{status:this.activeState.value},emptyTitle:this.activeState.noResults.title,helpMessage:this.activeState.noResults.text,showCtaLink:!1,fields:{email:S.email,"meta.full_name":S["meta-full_name"],id:{label:"ID",searchable:!0}}}},activeState(){return this.states[this.activeIndex]},activeIndex(){return this.$route.meta.status||"APPROVED"},...w(Te,{portalDocs:"docsPortal"})},async mounted(){const e=await this.getWorkspaceConfig();if(this.portalUrl=Ce(e,this.workspace),this.portalAuthEnabled=e.portal_auth,this.portalEnabled=e.portal,this.isLoading=!1,this.portalEnabled&&this.activeIndex!=="REQUESTED"){const t=await this.$api.findAll("developers",{status:1});t&&t.data&&t.data.data.length&&(this.notifications.REQUESTED=!0)}},methods:{tabChange(){this.isLoading=!0,this.notifications[this.activeIndex]=!1},setCustomAction(e,t){this.customAction=t,this.actionItem=e,t.skipModal&&this.makeCustomAction()},makeCustomAction(){const e=this.customAction.type,t=this.states[this.customAction.type].value;this.$api.updateRecord("developers",this.actionItem.id,{status:t}).then(()=>{this.$refs.entitylist.reloadData(),this.notifications[e]=!0}),this.dismissCustomAction()},dismissCustomAction(){this.customAction=null,this.actionItem=null}}},I=e=>(x("data-v-0143b382"),e=e(),P(),e),z={class:"developer-portal-list"},G=I(()=>n("strong",null,"The Dev Portal is disabled!",-1)),X=i(" To enable visit the "),Z=i(" Portal Settings "),ee=i(" page or visit our "),te=["href"],ae=i(" to learn more. "),se={key:0},ie=I(()=>n("strong",null,"Dev Portal authentication is disabled!",-1)),oe=i(" Developers will not be able to register until authentication is enabled. To enable visit the "),le=i(" Portal Settings "),re=i(" page. "),ne={class:"row"},ce={class:"col"},de={class:"nav nav-tabs mb-2"},pe={key:0,class:"notification"};function ue(e,t,o,d,a,s){const y=u("router-link"),E=u("DisabledView"),_=u("EntityFilter"),me=u("InviteDevelopers"),ve=u("PageHeader"),he=u("AlertDeveloper"),ye=u("KDropdownItem"),_e=u("VNode"),be=u("ConfirmModalDialog"),fe=u("EntityList");return r(),v("section",z,[!a.isLoading&&(!a.portalEnabled||!a.portalAuthEnabled)?(r(),f(E,{key:0,class:"mb-7"},{disabledMessage:c(()=>[a.portalEnabled?h("",!0):(r(),v(D,{key:0},[G,X,l(y,{to:{name:"portal-settings"}},{default:c(()=>[Z]),_:1}),ee,n("a",{href:e.portalDocs.url},"documentation",8,te),ae],64)),a.portalAuthEnabled?h("",!0):(r(),v(D,{key:1},[!a.portalEnabled&&!a.portalAuthEnabled?(r(),v("br",se)):h("",!0),ie,oe,l(y,{to:{name:"portal-settings"}},{default:c(()=>[le]),_:1}),re],64))]),_:1})):h("",!0),l(ve,{title:"Developers"},{default:c(()=>[l(_,{entity:s.entityListOptions.entity,fields:s.entityListOptions.fields,schema:a.schema},null,8,["entity","fields","schema"]),l(me,{"portal-url":a.portalUrl},null,8,["portal-url"])]),_:1}),n("div",ne,[n("div",ce,[n("ul",de,[(r(!0),v(D,null,k(a.states,(m,p)=>(r(),v("li",{key:p,class:"nav-item",onClick:t[0]||(t[0]=De=>s.tabChange())},[l(y,{to:{name:`developers-${p.toLowerCase()}`},class:T([{active:p===s.activeIndex},"nav-link"])},{default:c(()=>[i(b(m.title)+" ",1),a.notifications[p]?(r(),v("span",pe)):h("",!0)]),_:2},1032,["to","class"])]))),128))]),a.portalEnabled?(r(),f(fe,{ref:"entitylist",key:s.activeIndex,options:s.entityListOptions,"enable-entity-actions":!0,"overflow-actions":!0,"view-action-fields":["email"],"show-view-action":!0,"show-update-action":s.activeState.shouldShowUpdate,"show-delete-action":s.activeState.shouldShowDelete,"disable-row-click":!0},{["meta.full_name"]:c(({item:m})=>[i(b(m.meta&&JSON.parse(m.meta).full_name),1)]),header:c(m=>[n("div",C(m,{class:"header-text"}),[n("p",null,b(s.activeState.text),1)],16)]),extraActions:c(m=>[s.activeState.value===0?(r(),f(he,{key:0,developer:m.item,"portal-url":a.portalUrl},null,8,["developer","portal-url"])):h("",!0),m.rbac.isAllowedToUpdate?(r(!0),v(D,{key:1},k(s.activeState.customActions,p=>(r(),f(ye,{key:p.action,class:T(p.class),"data-testaction":`menu-${p.action.toLowerCase()}`,"is-dangerous":p.action==="Reject",onClick:De=>s.setCustomAction(m.item,p)},{default:c(()=>[i(b(p.action),1)]),_:2},1032,["class","data-testaction","is-dangerous","onClick"]))),128)):h("",!0)]),customModal:c(m=>[l(be,C(m,{"entity-name":s.entityListOptions.entityName,action:a.customAction&&a.customAction.action,"proceed-text":a.customAction&&a.customAction.action,visible:!!a.actionItem,class:"customModal",onOk:t[1]||(t[1]=p=>s.makeCustomAction()),onCancel:t[2]||(t[2]=p=>s.dismissCustomAction())}),{"body-text":c(()=>[l(_e,{render:()=>a.customAction.getText(a.actionItem)},null,8,["render"])]),_:2},1040,["entity-name","action","proceed-text","visible"])]),_:2},1032,["options","show-update-action","show-delete-action"])):h("",!0)])])])}L=A(B,[["render",ue],["__scopeId","data-v-0143b382"]])});export{ze as __tla,L as default};
