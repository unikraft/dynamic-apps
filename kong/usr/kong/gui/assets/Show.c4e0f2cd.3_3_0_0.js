/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as Q,B as A,C as x,ak as ie,ax as ye,r as v,o as w,c as O,b as d,O as G,ay as o,w as n,d as E,t as R,a as K,l as M,R as he,U as ne,i as St,h as j,G as J,az as me,aA as ge,aB as Pt,Z as fe,n as $t,aC as Tt,q as At,H as _e,V as Rt,y as be,_ as ve,z as Ce,J as Dt,Y as xt,aF as It,a4 as Nt,K as Et,E as we,__tla as Mt}from"./index.84d84090.3_3_0_0.js";import{u as jt,a as Bt,b as le,__tla as Kt}from"./useRbacPermission.15766885.3_3_0_0.js";import{u as Ot,__tla as Lt}from"./useRedirect.ccdc1330.3_3_0_0.js";import{E as qt,__tla as Ft}from"./EmptyWrapper.df2b9a4e.3_3_0_0.js";import{B as Ut,__tla as Ht}from"./Breadcrumbs.6127883e.3_3_0_0.js";import{P as Vt,S as Wt,__tla as zt}from"./StatusCodesWrapper.94765128.3_3_0_0.js";import{_ as Jt,__tla as Qt}from"./LineChartWrapper.be3dd56e.3_3_0_0.js";import{D as Gt,T as Yt,__tla as Zt}from"./TagsBlock.4b7d5635.3_3_0_0.js";import{E as Xt,__tla as ea}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{E as ta,__tla as aa}from"./EntityConfiguration.03651df4.3_3_0_0.js";import{R as ra,__tla as sa}from"./RbacPermMixin.3a5f32ef.3_3_0_0.js";import{D as ia,__tla as na}from"./DetailContainer.85becad9.3_3_0_0.js";import{p as ke}from"./plugins.f651ca50.3_3_0_0.js";import{C as la}from"./consumers.07a3440a.3_3_0_0.js";import{c as oa}from"./Consumer.4cc90c16.3_3_0_0.js";import{d as ca,B as ua}from"./chartHelpers.1bf67333.3_3_0_0.js";import{E as da,__tla as pa}from"./EntityMixin.2764673d.3_3_0_0.js";import{b as ya}from"./buildRoute.1ddadad0.3_3_0_0.js";import{R as ha}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as ma}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as ga}from"./ChartDataController.a765a4e0.3_3_0_0.js";import{__tla as fa}from"./ChartHeader.0a2c695d.3_3_0_0.js";import{__tla as _a}from"./TimeFramePicker.465b75eb.3_3_0_0.js";import"./TimeFrames.25a2a20b.3_3_0_0.js";import{__tla as ba}from"./VitalsDisabled.f093ed15.3_3_0_0.js";import{__tla as va}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{__tla as Ca}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import"./icon-help.699f8c28.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";import{__tla as wa}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as ka}from"./EntityFilter.bf4158bc.3_3_0_0.js";let Se,Sa=Promise.all([(()=>{try{return Mt}catch{}})(),(()=>{try{return Kt}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Ft}catch{}})(),(()=>{try{return Ht}catch{}})(),(()=>{try{return zt}catch{}})(),(()=>{try{return Qt}catch{}})(),(()=>{try{return Zt}catch{}})(),(()=>{try{return ea}catch{}})(),(()=>{try{return aa}catch{}})(),(()=>{try{return sa}catch{}})(),(()=>{try{return na}catch{}})(),(()=>{try{return pa}catch{}})(),(()=>{try{return ma}catch{}})(),(()=>{try{return ga}catch{}})(),(()=>{try{return fa}catch{}})(),(()=>{try{return _a}catch{}})(),(()=>{try{return ba}catch{}})(),(()=>{try{return va}catch{}})(),(()=>{try{return Ca}catch{}})(),(()=>{try{return wa}catch{}})(),(()=>{try{return ka}catch{}})()]).then(async()=>{const Pe={title:"Consumer Credentials",list:{toolbar_actions:{acls:{new:"New ACL Credential"},"basic-auth":{new:"New Basic Auth Credential"},"key-auth":{new:"New Key Auth Credential"},"key-auth-enc":{new:"New Key Auth Encrypted Credential"},oauth2:{new:"New OAuth 2.0 Credential"},"hmac-auth":{new:"New HMAC Credential"},jwt:{new:"New JWT Credential"}},table_headers:{acls:{group:"Group",created_at:"Created At",tags:"Tags"},"basic-auth":{password:"Credential",username:"Username",created_at:"Created at",tags:"Tags"},"key-auth":{key:"Key",created_at:"Created at",tags:"Tags"},"key-auth-enc":{key:"Key",created_at:"Created at",tags:"Tags"},oauth2:{name:"Name",client_id:"Client ID",client_secret:"Client secret",created_at:"Created at",tags:"Tags"},"hmac-auth":{username:"Username",secret:"Secret",created_at:"Created at",tags:"Tags"},jwt:{key:"Key",algorithm:"Algorithm",created_at:"Created at",tags:"Tags"}},empty_state:{acls:{title:"Configure a New ACL Credential",cta:"New ACL Credential"},"basic-auth":{title:"Configure a New Basic Auth Credential",cta:"New Basic Auth Credential"},"key-auth":{title:"Configure a New Key Auth Credential",cta:"New Key Auth Credential"},"key-auth-enc":{title:"Configure a New Key Auth Encrypted Credential",cta:"New Key Auth Encrypted Credential"},oauth2:{title:"Configure a New OAuth 2.0 Credential",cta:"New OAuth 2.0 Credential"},"hmac-auth":{title:"Configure a New HMAC Credential",cta:"New HMAC Credential"},jwt:{title:"Configure a New JWT Credential",cta:"New JWT Credential"}}},actions:{copy_id:"Copy ID",copy_credential:"Copy Credential",copy_key:"Copy Key",copy_secret:"Copy Secret",copy_json:"Copy JSON",edit:"Edit",delete:"Delete"},delete:{acls:{title:"Delete an ACL Credential"},"basic-auth":{title:"Delete a Basic Auth Credential"},"key-auth":{title:"Delete a Key Auth Credential"},"key-auth-enc":{title:"Delete a Key Auth Encrypted Credential"},oauth2:{title:"Delete an OAuth 2.0 Credential"},"hmac-auth":{title:"Delete an HMAC Credential"},jwt:{title:"Delete a JWT Credential"},description:"This action cannot be reversed."},error:{general:"Credentials could not be retrieved",delete:"The credential could not be deleted at this time.",copy:"Failed to copy to clipboard"},copy:{success:"Copied {val} to clipboard",success_brief:"Successfully copied to clipboard"}},$e={credentials:Pe};function Te(){const e=me("en-us",$e);return{i18n:e,i18nT:ge(e)}}const Ae={useI18n:Te},Re={list:{konnect:"/api/runtime_groups/{controlPlaneId}/consumers/{consumerId}/{plugin}",kongManager:"/{workspace}/consumers/{consumerId}/{plugin}"}};function Y(e={}){return{axiosInstance:Pt.create({withCredentials:!0,timeout:3e4,...e})}}function De(e,r){const t=o(r),a=x(()=>e.apiBaseUrl.startsWith("/")?new URL(`${window.location.origin}${t}`):new URL(t));return a.value.search="",s=>`${a.value.href}/${s}`}const xe={message:"Are you sure you want to delete this {entityType}?",messageWithName:"Are you sure you want to delete this {entityType} {entityName}?"},Ie={actions:{save:"Save",cancel:"Cancel",back:"Back"},errors:{edit:"The entity could not be edited at this time."}},Ne={emptyState:{noSearchResultsTitle:"No results found",noSearchResultsMessage:"Please adjust the criteria and try again.",noSearchResultsCtaText:"Clear"}},Ee={filterButtonText:"Filter",fieldLabel:"Filter by:",inputPlaceholder:"Enter a value",selectPlaceholder:"Select an item",applyButtonText:"Apply",clearButtonText:"Clear",clearAllButtonText:"Clear all filters"},Me={errors:{fetch:"Could not fetch available items",invalid:"Please select a valid value"}},je={unexpected:"An unexpected error has occurred"},Be={enable:{title:"Enable {entityType}",message:"Are you sure you want to enable the {entityType} {entityName}?",confirmText:"Yes, enable"},disable:{title:"Disable {entityType}",message:"Are you sure you want to disable the {entityType} {entityName}?",confirmText:"Yes, disable"}},Ke={deleteModal:xe,baseForm:Ie,baseTable:Ne,filter:Ee,debouncedFilter:Me,errors:je,toggleModal:Be};function Z(){const e=me("en-us",Ke);return{i18n:e,i18nT:ge(e)}}function Oe(){const{i18n:{t:e}}=Z();return{getMessageFromError:r=>{var t,a,s;if(!r)return e("errors.unexpected");if((t=r==null?void 0:r.response)!=null&&t.data){if(r.response.data.detail)return r.response.data.detail;if((a=r.response.data.details)!=null&&a.length)return r.response.data.details.map(i=>{let g=e("errors.unexpected");return i.messages&&typeof i.messages=="object"&&i.messages.length&&(g=i.messages.join(", ")),i.field?`${i.field} - ${g}`:g}).join("; ");if(r.response.data.message){const{message:i}=r.response.data;return Array.isArray(i)?(s=i[0])!=null&&s.constraints?Object.values(i[0].constraints)[0]:i[0]:i}if(typeof r.response.data=="string")return r.response.data;if(typeof r.response.data=="object")return Object.keys(r.response.data).map(i=>`${i} ${r.response.data[i]}`).join(", ")}return r.message||e("errors.unexpected")}}}function oe(e,r){const t=A(o(e)),a=A(o(r)),s=x(()=>!!(t.value.app==="konnect"||t.value.isExactMatch)),i=x(()=>a.value.startsWith("/")?new URL(`${window.location.origin}${a.value}`):new URL(a.value));return g=>{const{page:f,pageSize:h,offset:c,sortColumnKey:l,sortColumnOrder:b,query:$}=g;try{let _=new URL(i.value.href);return s.value&&$?(_.search="",_=new URL(`${_.href}/${$}/`)):(s.value||new URLSearchParams($).forEach((B,p)=>{_.searchParams.append(p,B)}),l&&_.searchParams.append("sort_by",l),b==="desc"&&_.searchParams.append("sort_desc","1"),_.searchParams.append("size",String(h))),c&&f!==1&&_.searchParams.append("offset",String(c)),_.href}catch(_){return console.error("RouteList(fetcher)",_),a.value}}}function Le(){return{debounce:(e,r)=>{let t;return(...a)=>{clearTimeout(t),t=window==null?void 0:window.setTimeout(()=>{e(...a)},r)}}}}const X="khcp-user-table-preferences",qe={pageSize:30,sortColumnKey:void 0,sortColumnOrder:void 0};function Fe(){const e=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(a){console.error("useTablePreferences(tryParseJson)",a);return}},r=()=>{const t=e(localStorage.getItem(X));return!t||!Object.keys(t).length?new Map:new Map(Object.entries(t))};return{setTablePreferences:(t,a)=>{try{const s=r();s.set(t,a),localStorage.setItem(X,JSON.stringify(Object.fromEntries(s.entries())))}catch(s){console.error("useTablePreferences(setTablePreferences)",s)}},getTablePreferences:t=>{const a=r();return(a==null?void 0:a.get(t))||void 0||qe},deleteAllTablePreferences:()=>{localStorage.removeItem(X)}}}function Ue(e,r,t){t||(t="100");const{axiosInstance:a}=Y({headers:e.requestHeaders}),{i18n:{t:s}}=Z(),{debounce:i}=Le(),g=i(async u=>{await k(u)},200),f=A(!1),h=A(""),c=A(""),l=A([]),b=A(void 0),$=o(r);let _=`${e.apiBaseUrl}${$}`;e.app==="konnect"?_=_.replace(/{controlPlaneId}/gi,(e==null?void 0:e.controlPlaneId)||""):e.app==="kongManager"&&(_=_.replace(/{workspace}/gi,(e==null?void 0:e.workspace)||""));const B=async()=>{try{f.value=!0;const{data:u}=await a.get(`${_}?size=${t}`);u!=null&&u.next||(b.value=u.data),u!=null&&u.data&&(l.value=u.data)}catch{l.value=[],h.value=s("debouncedFilter.errors.fetch")}finally{f.value=!1}},p=A(""),k=async u=>{var q,S;if(p.value!==u)if(p.value=u||"",b.value===void 0)try{f.value=!0,h.value="",c.value="";let T=_+"";u&&(T+=`/${u}`);const{data:D}=await a.get(`${T}?size=${t}`);D!=null&&D.data?l.value=D.data:D!=null&&D.id?l.value=[D]:l.value=[]}catch(T){((q=T==null?void 0:T.response)==null?void 0:q.status)===404?c.value=s("debouncedFilter.errors.invalid"):(l.value=[],h.value=s("debouncedFilter.errors.fetch"))}finally{f.value=!1}else f.value=!0,c.value="",u?(l.value=(S=b.value)==null?void 0:S.filter(T=>T.id.includes(u)),(!l.value||!l.value.length)&&(c.value=s("debouncedFilter.errors.invalid"))):l.value=b.value,f.value=!1};return{loading:f,error:h,validationError:c,results:l,allRecords:b,loadItems:B,debouncedQueryChange:g}}var ce=(e=>(e.GatewayService="service",e.Route="route",e.Consumer="consumer",e.ConsumerGroup="consumer group",e.Plugin="plugin",e.Upstream="upstream",e.Certificate="certificate",e.CACertificate="ca certificate",e.SNI="SNI",e.Key="key",e.KeySet="key set",e.Vault="vault",e.Application="application",e.Developer="developer",e.acls="ACL Credential",e["basic-auth"]="Basic Auth Credential",e["key-auth"]="Key Auth Credential",e["key-auth-enc"]="Key Auth Encrypted Credential",e.oauth2="OAuth 2.0 Credential",e["hmac-auth"]="HMAC Credential",e.jwt="JWT Credential",e.Target="target",e))(ce||{}),L=(e=>(e[e.Loading=0]="Loading",e[e.Idle=1]="Idle",e[e.NoResults=2]="NoResults",e[e.Error=3]="Error",e))(L||{});function He(e,r,t="data"){const a=o(r),{axiosInstance:s}=Y({headers:e.requestHeaders}),i=oe(e,a),g=A({status:L.Idle});return{fetcher:async f=>{try{g.value={status:L.Loading};const h=i(f),{data:c}=await s.get(h),l=t&&t.replace(/[^\w-_]/gi,"");let b;c[l]&&Array.isArray(c[l])?b=c[l]:b=Object.keys(c).length?[c]:[];const $={data:b,total:b.length,...c.offset?{pagination:{offset:c.offset}}:null};return g.value={status:L.Idle,response:$},$}catch(h){const c={data:[],total:0};return f.query&&h.response.status===404?(g.value={status:L.NoResults,response:c,error:h},c):(g.value={status:L.Error,response:c,error:h},c)}},fetcherState:g}}const ee={useAxios:Y,useDeleteUrlBuilder:De,useErrors:Oe,useFetchUrlBuilder:oe,useDebouncedFilter:Ue,useFetcher:He,useI18n:Z},ue=(e,r)=>{const t=e.__vccOpts||e;for(const[a,s]of r)t[a]=s;return t},Ve={class:"toolbar-container"},We={key:0,class:"toolbar-button-container"},ze=["data-testid"],Je=Q({__name:"EntityBaseTable",props:{tableHeaders:{type:Object,required:!0,default:()=>({})},fetcher:{type:Function,required:!0,default:async()=>({data:[],total:0})},initialFetcherParams:{type:Object,default:null},fetcherCacheKey:{type:Number,default:1},isLoading:{type:Boolean,default:!1},query:{type:String,default:""},enableClientSort:{type:Boolean,default:!1},enableEntityActions:{type:Boolean,default:!0},emptyStateOptions:{type:Object,default:()=>({})},errorMessage:{type:String,default:""},disablePaginationPageJump:{type:Boolean,default:void 0},disableSorting:{type:Boolean,default:void 0},paginationType:{type:String,default:void 0},cellAttributes:{type:Function,default:()=>({})},rowAttributes:{type:Function,default:()=>({})},preferencesStorageKey:{type:String,default:"",required:!0},dropdownMenuWidth:{type:String,default:"",required:!1}},emits:["click:row","sort","clear-search-input","empty-state-cta-clicked"],setup(e,{emit:r}){const t=e,{i18n:{t:a}}=ee.useI18n(),s=x(()=>{const p=[];return Object.keys(t.tableHeaders).forEach(k=>{const u=t.tableHeaders[k];p.push({label:u.label??k,key:k,sortable:u.sortable??!1})}),t.enableEntityActions&&p.push({key:"actions",hideLabel:!0}),p}),i=p=>({"data-rowid":p.id,"data-testid":p.name,...t.rowAttributes(p)}),g=p=>({"data-testid":p.headerKey,...t.cellAttributes(p)}),f=()=>{r("empty-state-cta-clicked"),h()},h=()=>{r("clear-search-input")},c=(p,k)=>{r("click:row",k)},l=p=>{r("sort",p)},{setTablePreferences:b,getTablePreferences:$}=Fe(),_=x(()=>{const p=$(t.preferencesStorageKey);return{...t.initialFetcherParams,...p}}),B=p=>{t.preferencesStorageKey&&b(t.preferencesStorageKey,p)};return(p,k)=>{const u=v("KIcon"),q=v("KButton"),S=v("KDropdownMenu"),T=v("KTable"),D=v("KCard");return w(),M(D,{class:"kong-ui-entity-base-table"},{body:n(()=>[d(T,{"cell-attrs":g,"disable-pagination-page-jump":e.disablePaginationPageJump,"disable-sorting":e.disableSorting,"empty-state-action-button-icon":e.query?"":"plus","empty-state-action-message":e.query?o(a)("baseTable.emptyState.noSearchResultsCtaText"):e.emptyStateOptions.ctaText,"empty-state-action-route":e.query?"":e.emptyStateOptions.ctaPath,"empty-state-icon":e.query?"stateNoSearchResults":"stateGruceo","empty-state-icon-size":"96","empty-state-message":e.query?o(a)("baseTable.emptyState.noSearchResultsMessage"):e.emptyStateOptions.message,"empty-state-title":e.query?o(a)("baseTable.emptyState.noSearchResultsTitle"):e.emptyStateOptions.title,"enable-client-sort":e.enableClientSort,"error-state-title":e.errorMessage,fetcher:e.fetcher,"fetcher-cache-key":String(e.fetcherCacheKey),"has-error":!!e.errorMessage,headers:o(s),"hide-pagination-when-optional":"","initial-fetcher-params":o(_),"is-loading":e.isLoading,"pagination-type":e.paginationType,"row-attrs":i,"search-input":e.query,onKtableEmptyStateCtaClicked:f,"onRow:click":c,onSort:l,"onUpdate:tablePreferences":B},G({toolbar:n(()=>[K("div",Ve,[J(p.$slots,"toolbar-filter",{},void 0,!0),p.$slots["toolbar-button"]?(w(),O("div",We,[J(p.$slots,"toolbar-button",{},void 0,!0)])):j("",!0)])]),actions:n(({row:H,rowKey:F,rowValue:W})=>[K("div",{class:"actions-container","data-testid":H.name},[d(S,{"kpop-attributes":{placement:"bottomEnd"},width:e.dropdownMenuWidth},{items:n(()=>[J(p.$slots,"actions",{row:H,rowKey:F,rowValue:W},void 0,!0)]),default:n(()=>[d(q,{class:"non-visual-button","data-testid":"overflow-actions-button",size:"small"},{icon:n(()=>[d(u,{color:"var(--black-400, #3c4557)",icon:"more",size:"16"})]),_:1})]),_:2},1032,["width"])],8,ze)]),_:2},[ne(e.tableHeaders,(H,F)=>({name:F,fn:n(({row:W,rowKey:ae,rowValue:re})=>[J(p.$slots,F,{row:W,rowKey:ae,rowValue:re},void 0,!0)])}))]),1032,["disable-pagination-page-jump","disable-sorting","empty-state-action-button-icon","empty-state-action-message","empty-state-action-route","empty-state-icon","empty-state-message","empty-state-title","enable-client-sort","error-state-title","fetcher","fetcher-cache-key","has-error","headers","initial-fetcher-params","is-loading","pagination-type","search-input"])]),_:3})}}}),Qe=ue(Je,[["__scopeId","data-v-6eab8cd1"]]),Ge={key:0,class:"kong-ui-entity-delete-error"},Ye={key:1,class:"description"},Ze=Q({__name:"EntityDeleteModal",props:{visible:{type:Boolean,required:!0,default:!1},title:{type:String,default:"Delete"},entityType:{type:String,required:!0},entityName:{type:String,default:""},needConfirm:{type:Boolean,default:!0},description:{type:String,default:""},actionPending:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["cancel","proceed"],setup(e,{emit:r}){const t=e,{i18nT:a}=ee.useI18n(),s=x(()=>t.needConfirm?t.entityName:""),i=()=>{r("cancel")},g=()=>{r("proceed")};return(f,h)=>{const c=v("KAlert"),l=v("KPrompt");return w(),M(l,{"action-button-text":"Yes, delete","action-pending":e.actionPending,class:"kong-ui-entity-delete-modal","confirmation-text":o(s),"is-visible":e.visible,title:e.title,type:"danger",onCanceled:i,onProceed:g},{"body-content":n(()=>[e.error?(w(),O("div",Ge,[d(c,{appearance:"danger"},{alertMessage:n(()=>[E(R(e.error),1)]),_:1})])):j("",!0),d(o(a),{class:"message",keypath:t.entityName?"deleteModal.messageWithName":"deleteModal.message",tag:"p"},G({entityType:n(()=>[E(R(t.entityType),1)]),_:2},[t.entityName?{name:"entityName",fn:n(()=>[K("strong",null,R(t.entityName),1)]),key:"0"}:void 0]),1032,["keypath"]),t.description||f.$slots.description?(w(),O("div",Ye,[J(f.$slots,"description",{},()=>[K("p",null,R(t.description),1)],!0)])):j("",!0)]),_:3},8,["action-pending","confirmation-text","is-visible","title"])}}}),Xe=ue(Ze,[["__scopeId","data-v-3513e33b"]]),te=Q({__name:"PermissionsWrapper",props:{authFunction:{type:Function,required:!0,default:async()=>!0},forceShow:{type:Boolean,default:!1}},setup(e){const r=e,t=A(void 0),a=x(()=>t.value===!0||t.value!==void 0&&r.forceShow===!0);return ye(async()=>{t.value=await r.authFunction()}),(s,i)=>o(a)?J(s.$slots,"default",{key:0,isAllowed:t.value}):j("",!0)}}),{useAxios:et,useDeleteUrlBuilder:tt,useErrors:Pa,useFetchUrlBuilder:$a,useFetcher:at,useDebouncedFilter:Ta}=ee,rt=e=>{const r=new Date(e*1e3),t=r.getFullYear(),a=`${r.getMonth()+1}`.padStart(2,"0"),s=`${r.getDate()}`.padStart(2,"0"),i=`${r.getHours()}`.padStart(2,"0"),g=`${r.getMinutes()}`.padStart(2,"0"),f=`${r.getSeconds()}`.padStart(2,"0"),h=r.getTimezoneOffset(),c=Math.floor(Math.abs(h)/60),l=Math.abs(h)%60,b=`${h<=0?"+":"-"}${c.toString().padStart(2,"0")}${l.toString().padStart(2,"0")}`;return`${t}-${a}-${s} ${i}:${g}:${f} ${b}`},st={class:"kong-ui-entities-consumer-credentials-list"},it={key:1},nt=Q({__name:"ConsumerCredentialList",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.createRoute||!e.getEditRoute)},canCreate:{type:Function,required:!1,default:async()=>!0},canDelete:{type:Function,required:!1,default:async()=>!0},canEdit:{type:Function,required:!1,default:async()=>!0}},emits:["error","loading","copy:success","copy:error","delete:success"],setup(e,{emit:r}){const t=e,{i18n:{t:a}}=Ae.useI18n(),{axiosInstance:s}=et({headers:t.config.requestHeaders}),i=A(1),g={acls:{group:{label:a("credentials.list.table_headers.acls.group")},created_at:{label:a("credentials.list.table_headers.acls.created_at")},tags:{label:a("credentials.list.table_headers.acls.tags")}},"basic-auth":{password:{label:a("credentials.list.table_headers.basic-auth.password")},username:{label:a("credentials.list.table_headers.basic-auth.username")},created_at:{label:a("credentials.list.table_headers.basic-auth.created_at")},tags:{label:a("credentials.list.table_headers.basic-auth.tags")}},"key-auth":{key:{label:a("credentials.list.table_headers.key-auth.key")},created_at:{label:a("credentials.list.table_headers.key-auth.created_at")},tags:{label:a("credentials.list.table_headers.key-auth.tags")}},"key-auth-enc":{key:{label:a("credentials.list.table_headers.key-auth-enc.key")},created_at:{label:a("credentials.list.table_headers.key-auth-enc.created_at")},tags:{label:a("credentials.list.table_headers.key-auth-enc.tags")}},oauth2:{name:{label:a("credentials.list.table_headers.oauth2.name")},client_id:{label:a("credentials.list.table_headers.oauth2.client_id")},client_secret:{label:a("credentials.list.table_headers.oauth2.client_secret")},created_at:{label:a("credentials.list.table_headers.oauth2.created_at")},tags:{label:a("credentials.list.table_headers.oauth2.tags")}},"hmac-auth":{username:{label:a("credentials.list.table_headers.hmac-auth.username")},secret:{label:a("credentials.list.table_headers.hmac-auth.secret")},created_at:{label:a("credentials.list.table_headers.hmac-auth.created_at")},tags:{label:a("credentials.list.table_headers.hmac-auth.tags")}},jwt:{key:{label:a("credentials.list.table_headers.jwt.key")},algorithm:{label:a("credentials.list.table_headers.jwt.algorithm")},created_at:{label:a("credentials.list.table_headers.jwt.created_at")},tags:{label:a("credentials.list.table_headers.jwt.tags")}}},f=x(()=>g[t.config.plugin]),h=x(()=>{let y=`${t.config.apiBaseUrl}${Re.list[t.config.app]}`;return t.config.app==="konnect"?y=y.replace(/{controlPlaneId}/gi,t.config.controlPlaneId||"").replace(/{consumerId}/gi,t.config.consumerId||"").replace(/{plugin}/gi,t.config.plugin||""):t.config.app==="kongManager"&&(y=y.replace(/{workspace}/gi,t.config.workspace||"").replace(/{consumerId}/gi,t.config.consumerId||"").replace(/{plugin}/gi,t.config.plugin||"")),y}),{fetcher:c,fetcherState:l}=at(t.config,h),b=()=>{i.value++},$=A(""),_=x(()=>l.value.status===L.Loading),B=x(()=>{var y;return l.value.status===L.Idle&&!!((y=l.value.response)!=null&&y.data.length)}),p=x(()=>!_.value&&B.value),k=(y,P,U)=>{const N=P?y[P]:JSON.stringify(y);if(!U(N)){S(y,P);return}q(y,P)},u=(y,P,U)=>{const{type:N}=y;N==="success"?q(P,U):S(P,U)},q=(y,P)=>{r("copy:success",{entity:y,field:P,message:P?a("credentials.copy.success",{val:y[P]}):a("credentials.copy.success_brief")})},S=(y,P)=>{r("copy:error",{entity:y,field:P,message:a("credentials.error.copy")})},T=y=>({label:a("credentials.actions.edit"),to:t.config.getEditRoute(y)}),D=A(void 0),H=A(!1),F=A(!1),W=A(""),ae=tt(t.config,h.value),re=x(()=>ce[t.config.plugin]),bt=y=>{D.value=y,H.value=!0},vt=()=>{H.value=!1},Ct=async()=>{var y,P,U;if((y=D.value)!=null&&y.id){F.value=!0;try{await s.delete(ae(D.value.id)),F.value=!1,H.value=!1,i.value++,r("delete:success",D.value)}catch(N){W.value=((U=(P=N.response)==null?void 0:P.data)==null?void 0:U.message)||N.message||a("credentials.error.delete"),r("error",N)}finally{F.value=!1}}};ie(_,y=>{r("loading",y)},{immediate:!0}),ie(l,y=>{if(y.status===L.Error){$.value=a("credentials.error.general"),r("error",y.error);return}$.value=""});const se=A({ctaPath:t.config.createRoute,ctaText:void 0,message:"",title:a("credentials.title")});return ye(async()=>{await t.canCreate()&&(se.value.title=a(`credentials.list.empty_state.${t.config.plugin}.title`),se.value.ctaText=a(`credentials.list.empty_state.${t.config.plugin}.cta`))}),(y,P)=>{const U=v("KButton"),N=v("CopyUuid"),wt=v("KBadge"),kt=v("KTruncate"),V=v("KDropdownItem"),z=v("KClipboardProvider");return w(),O("div",st,[d(o(Qe),{"disable-pagination-page-jump":"","disable-sorting":"","empty-state-options":se.value,"enable-entity-actions":"","error-message":$.value,fetcher:o(c),"fetcher-cache-key":i.value,"is-loading":o(_),"pagination-type":"offset","preferences-storage-key":"kong-ui-entities-consumer-credentials-list","table-headers":o(f),onSort:b},G({group:n(({rowValue:m})=>[K("b",null,R(m??"-"),1)]),name:n(({rowValue:m})=>[K("b",null,R(m??"-"),1)]),username:n(({rowValue:m})=>[K("span",null,R(m??"-"),1)]),password:n(({row:m,rowValue:C})=>[d(N,{"is-hidden":"",notify:I=>u(I,m,"password"),uuid:C},null,8,["notify","uuid"])]),key:n(({row:m,rowValue:C})=>[d(N,{"is-hidden":"",notify:I=>u(I,m,"key"),uuid:C},null,8,["notify","uuid"])]),client_secret:n(({row:m,rowValue:C})=>[d(N,{"is-hidden":"",notify:I=>u(I,m,"client_secret"),uuid:C},null,8,["notify","uuid"])]),secret:n(({row:m,rowValue:C})=>[d(N,{"is-hidden":"",notify:I=>u(I,m,"secret"),uuid:C},null,8,["notify","uuid"])]),created_at:n(({rowValue:m})=>[E(R(o(rt)(m)),1)]),tags:n(({rowValue:m})=>[(m==null?void 0:m.length)>0?(w(),M(kt,{key:0},{default:n(()=>[(w(!0),O(he,null,ne(m,C=>(w(),M(wt,{key:C,onClick:P[0]||(P[0]=St(()=>{},["stop"]))},{default:n(()=>[E(R(C),1)]),_:2},1024))),128))]),_:2},1024)):(w(),O("span",it,"-"))]),actions:n(({row:m})=>[d(z,null,{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-id",onClick:I=>k(m,"id",C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_id")),1)]),_:2},1032,["onClick"])]),_:2},1024),e.config.plugin==="basic-auth"?(w(),M(z,{key:0},{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-credential",onClick:I=>k(m,"password",C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_credential")),1)]),_:2},1032,["onClick"])]),_:2},1024)):j("",!0),["key-auth","key-auth-enc","jwt"].includes(e.config.plugin)?(w(),M(z,{key:1},{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-key",onClick:I=>k(m,"key",C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_key")),1)]),_:2},1032,["onClick"])]),_:2},1024)):j("",!0),e.config.plugin==="oauth2"?(w(),M(z,{key:2},{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-secret",onClick:I=>k(m,"client_secret",C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_secret")),1)]),_:2},1032,["onClick"])]),_:2},1024)):j("",!0),e.config.plugin==="hmac-auth"?(w(),M(z,{key:3},{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-secret",onClick:I=>k(m,"secret",C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_secret")),1)]),_:2},1032,["onClick"])]),_:2},1024)):j("",!0),d(z,null,{default:n(({copyToClipboard:C})=>[d(V,{"data-testid":"action-entity-copy-json",onClick:I=>k(m,void 0,C)},{default:n(()=>[E(R(o(a)("credentials.actions.copy_json")),1)]),_:2},1032,["onClick"])]),_:2},1024),d(o(te),{"auth-function":()=>e.canEdit(m)},{default:n(()=>[d(V,{"data-testid":"action-entity-edit","has-divider":"",item:T(m.id)},null,8,["item"])]),_:2},1032,["auth-function"]),d(o(te),{"auth-function":()=>e.canDelete(m)},{default:n(()=>[d(V,{"data-testid":"action-entity-delete","has-divider":"","is-dangerous":"",onClick:C=>bt(m)},{default:n(()=>[E(R(o(a)("credentials.actions.delete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["auth-function"])]),_:2},[o(p)?{name:"toolbar-button",fn:n(()=>[d(o(te),{"auth-function":()=>e.canCreate()},{default:n(()=>[d(U,{appearance:"primary","data-testid":"toolbar-add-credential",icon:"plus",to:e.config.createRoute},{default:n(()=>[E(R(o(a)(`credentials.list.toolbar_actions.${e.config.plugin}.new`)),1)]),_:1},8,["to"])]),_:1},8,["auth-function"])]),key:"0"}:void 0]),1032,["empty-state-options","error-message","fetcher","fetcher-cache-key","is-loading","table-headers"]),d(o(Xe),{"action-pending":F.value,description:o(a)("credentials.delete.description"),"entity-type":o(re),error:W.value,title:o(a)(`credentials.delete.${e.config.plugin}.title`),visible:H.value,onCancel:vt,onProceed:Ct},null,8,["action-pending","description","entity-type","error","title","visible"])])}}}),lt=(e,r)=>{const t=e.__vccOpts||e;for(const[a,s]of r)t[a]=s;return t},ot=lt(nt,[["__scopeId","data-v-48842e06"]]),ct=Q({__name:"ConsumerCredentialList",props:{consumerId:{type:String,default:""},title:{type:String,default:""},plugin:{type:String,default:""}},setup(e){const r=e,t=be("rbac"),a=be("onHasResults"),s=fe(),i=$t(),{infoPlugins:g}=Tt(s),{createRedirectRouteQuery:f}=Ot(),h=x(()=>r.plugin==="acl"?"acls":r.plugin),c=x(()=>({name:"create-consumer-plugin",params:{consumerId:r.consumerId,type:r.plugin},query:f()})),l=S=>({name:"update-consumer-plugin",params:{consumerId:r.consumerId,consumerPluginId:S,type:r.plugin},query:f()}),b=At({...jt(),consumerId:r.consumerId,plugin:h.value,createRoute:c,getEditRoute:l}),$=()=>le(t,{path:`/consumers/${r.consumerId}/${h.value}`,action:"create"}),_=S=>le(t,{path:`/consumers/${r.consumerId}/${h.value}/${S.id}`,action:"delete"}),B=S=>le(t,{path:`/consumers/${r.consumerId}/${h.value}/${S.id}`,action:"update"}),p=x(()=>{var S,T,D;return(D=(T=(S=g.value)==null?void 0:S.enabled)==null?void 0:T.includes)==null?void 0:D.call(T,r.plugin)});ie(()=>p.value,S=>{S&&a&&a()},{immediate:!0});const{onCopySuccess:k,onCopyError:u}=Bt(),q=()=>{i.notify({message:"Credential successfully deleted!",type:"success"})};return(S,T)=>o(p)?(w(),O("section",{key:0,class:Rt(e.plugin)},[d(_e,{title:e.title,size:5},null,8,["title"]),d(o(ot),{config:b,"can-create":$,"can-delete":_,"can-edit":B,"onCopy:success":o(k),"onCopy:error":o(u),"onDelete:success":q},null,8,["config","onCopy:success","onCopy:error"])],2)):j("",!0)}}),de=5,ut={name:"CodeCountByRoute",components:{PercentList:Vt},extends:Jt,props:{rawData:{type:Object,default:()=>({})},statusCode:{type:String,required:!0}},data(){return{colors:{"1xx":{h:49,s:90,l:69},"2xx":{h:146,s:70,l:62},"3xx":{h:208,s:90,l:75},"4xx":{h:0,s:90,l:62},"5xx":{h:245,s:40,l:60}},category:{text:"Path",key:"title"},value:{text:"Count",key:"count"},routes:{},routeList:[],routeTimeout:null}},computed:{stats(){return!this.rawData||!this.rawData.stats?{}:this.rawData.stats},meta(){return this.rawData&&this.rawData.meta?this.rawData.meta:{}},routeKeys(){return Object.keys(this.stats)},datasets(){return this.chartData.datasets}},watch:{isUtc:{handler(){}},rawData:{handler(){this.fetchRouteData(0)}}},beforeUnmount(){clearTimeout(this.routeTimeout)},methods:{fetchRouteData(e){let r;Promise.all(Object.keys(this.datasets).map(t=>Promise.resolve(this.routes[t]).then(a=>a||this.$api.findRecord("routes",t).then(s=>s&&s.data&&s.data.paths&&s.data.paths.join(","))).then(a=>(this.routes[t]=a,{color:this.getColor(this.statusCode,{l:85}),title:a,id:t,count:this.datasets[t]})).catch(()=>{r=!0}))).then(t=>{this.routeList=t,clearTimeout(this.routeTimeout),r&&(e<de?this.routeTimeout=setTimeout(()=>this.fetchRouteData(e+1),0):console.debug("Max retries reached: ",de))})},viewRouteDetails({id:e}){this.$router.push({name:"show-route",params:{id:e}})},getColor(e,r){return this.getHslaFromColorObj(this.colors[`${e.charAt(0)}xx`],r)},getChartData(){const e=this.getTimeRange(this.meta),r=e.range[0],t=e.range[e.range.length-1];return{datasets:this.routeKeys.reduce((a,s)=>{const i=this.stats[s];return Object.keys(i).reduce((g,f)=>{const h=f>=r&&f<=t,c=i[f];return h?Object.keys(c).reduce((l,b)=>(b!==this.statusCode||(l[s]=l[s]||0,l[s]+=c[b]),l),g):g},a)},{})}}}};function dt(e,r,t,a,s,i){const g=v("PercentList");return w(),O("div",null,[d(g,{"items-are-links":!0,"on-click":i.viewRouteDetails,category:s.category,value:s.value,list:s.routeList,"initial-sort":"valSort"},null,8,["on-click","category","value","list"])])}const pt=ve(ut,[["render",dt]]),pe=Object.keys(ke).map(e=>ke[e]),yt={name:"ConsumersShow",components:{PageHeader:_e,EntityConfiguration:ta,CredentialsList:ct,Breadcrumbs:Ut,EmptyWrapper:qt,StatusCodesWrapper:Wt,CodeCountByRoute:pt,DetailsHeader:Gt,DetailContainer:ia,TagsBlock:Yt,EntityDeleteModal:Xt},mixins:[da,ra,ha],props:{entity:{type:Object,default:()=>({id:void 0,name:"Consumer",path:"consumer",rootPath:"consumers",createRouteName:null})},pluginRouteNames:{type:Object,default:()=>({selectRouteName:"select-plugin",updateRouteName:"update-plugin",createRouteName:"create-consumer-plugin"})},canEdit:{type:Boolean,default:!0}},data(){return{record:null,configSchema:oa,configuredPlugins:[],credentialMessage:"",emptyMessage:"No Plugins Enabled",infoTexts:{statusCodes:ca.statusCodesConsumer,codeDetail:ua.routesByConsumerAndCode},tabs:[{hash:"#activity",title:"Activity",vitals:!0},{hash:"#credentials",title:"Credentials"},{hash:"#plugins",title:"Plugins"}],computedTabs:[],deleteModalModel:null,redirectRouteAfterDelete:{name:"consumers"},navItems:[{key:"show-consumer",label:"Configuration"},{key:"consumer-groups",label:"Groups"},{key:"consumer-activity",label:"Activity"},{key:"consumer-credentials",label:"Credentials"},{key:"consumer-plugins",label:"Plugins"}]}},computed:{...Ce(fe,{config:"infoConfig"}),...Ce(Dt,["workspace"]),resourceEndpoint(){return this.entity.rootPath},id(){return this.record&&this.record.id||this.$route.params.id},isLoading(){return!this.record},title(){return this.isLoading?" ":this.record.username},titleMapping(){let e=xt(this.record,"consumers")||this.id;return It(e)&&(e=e.split("-")[0].trim()),{id:e}},credentials(){return pe},vitalsEnabled(){return this.config.vitals},chartDataUrls(){return{statusCodes:`status_codes/by_consumer?consumer_id=${this.id}`,codeDetail:`status_codes/by_consumer_and_route?consumer_id=${this.id}`}},entityQuery(){return this.record?{entity_id:this.id+","+(this.record.username||""),entity_type:"consumer_id"}:{}},entityId(){return this.entity.id||this.$route.query.entity_id},currentEntity(){return{id:this.record.username??this.record.custom_id??this.id,name:"consumer"}},actions(){return[{name:"Edit configuration",testAction:"action-edit",isAllowed:this.hasUpdatePerm,handler:this.handleEdit},{name:"Install Plugin",divider:this.hasUpdatePerm,testAction:"action-install-plugin",isAllowed:this.canCreatePlugins,handler:this.installPlugin},{name:"Delete",divider:this.hasUpdatePerm||this.canCreatePlugins,testAction:"action-delete",isAllowed:this.hasDeletePerm,dangerous:!0,handler:this.confirmDelete}]},editRoute(){return{name:"update-consumer"}},canCreatePlugins(){return this.hasPerms(["create"],`${this.resourceEndpoint}/${this.id}/plugins`)}},watch:{config:{handler(){if(!this.config.vitals){this.computedTabs=this.tabs.filter(e=>!e.vitals).concat(this.tabs.filter(e=>e.vitals));return}this.computedTabs=this.tabs},immediate:!0},$route(){this.$route.hash==="#plugins"&&this.fetchRecord()}},mounted(){return this.fetchRecord()},methods:{fetchRecord(){return this.$api.findRecord("consumers",encodeURIComponent(this.id)).then(e=>{this.credentialMessage=`Add one of the following Plugins for the ability to add credentials to this Consumer: ${pe.map(r=>r.title).join(", ")}`,this.record=e.data}).then(this.fetchPlugins).catch(Nt(this.$router,404,"/404",{replace:!0}))},transformRecord(e){return{...e,..."type"in e?{type:la[e.type]}:null}},fetchPlugins(e){return e||(e={}),this.$api.getPluginsByEntity("consumers",this.id,e.pageSize,e.offset).then(r=>(this.configuredPlugins=r.data,r))},navigateToPlugins(e={}){this.$router.push({name:this.pluginRouteNames.selectRouteName,params:{fields:{consumer_id:this.id},returnLink:this.$route.fullPath},query:{...e,...this.createRedirectRouteQuery()}})},buildRouteFor(e,r){const{entityQuery:t,$route:a}=this;return ya({fields:{consumer_id:this.id},route:e,query:t,$route:a,name:r})},handleEdit(){this.$router.push({name:this.editRoute.name,params:this.editRoute.params||{id:this.record.id,returnLink:this.$route.fullPath},query:{...this.editRoute.query,...this.createRedirectRouteQuery(),...this.createPostDeleteRouteQuery()}})},installPlugin(){this.$router.push(this.buildRouteFor(`/${this.$route.params.workspace}/plugins/select`,this.pluginRouteNames.selectRouteName))},confirmDelete(){this.deleteModalModel={record:this.record}}}},ht={class:"consumer-view"},mt={class:"consumer-details"},gt={class:"flex flex-col gap-2 mt-4"},ft={class:"flex items-center justify-between"};function _t(e,r,t,a,s,i){const g=v("Breadcrumbs"),f=v("TagsBlock"),h=v("DetailsHeader"),c=v("EntityConfiguration"),l=v("CodeCountByRoute"),b=v("StatusCodesWrapper"),$=v("PageHeader"),_=v("CredentialsList"),B=v("EmptyWrapper"),p=v("DetailContainer"),k=v("EntityDeleteModal");return w(),O("article",ht,[d(g,{"title-mapping":i.titleMapping},null,8,["title-mapping"]),K("section",mt,[d(h,{title:i.title,record:s.record,entity:{...t.entity,id:i.id},actions:i.actions},G({_:2},[s.record?{name:"below-title",fn:n(()=>[K("div",gt,[K("div",ft,[s.record.tags&&s.record.tags.length?(w(),M(f,{key:0,tags:s.record.tags},null,8,["tags"])):j("",!0)])])])}:void 0]),1032,["title","record","entity","actions"])]),d(p,{entity:t.entity,items:s.navItems,"entity-name":"service"},{"show-consumer":n(()=>[d(c,{"config-schema":s.configSchema,record:s.record,"transform-record":i.transformRecord,"edit-route":i.editRoute,entity:"consumers","entity-name":"consumer","flatten-actions":""},null,8,["config-schema","record","transform-record","edit-route"])]),"consumer-activity":n(()=>[s.record&&s.record.id?(w(),M(b,we({key:0},{infoTexts:s.infoTexts,chartDataUrls:i.chartDataUrls},{entity:i.currentEntity,"status-code-detail-route":"view-consumer-status-code","as-detail-tab-content":"",title:"Analytics"}),{statusCodeDetail:n(u=>[u.statusCode?(w(),M(l,Et(we({key:0},u)),null,16)):j("",!0)]),_:1},16,["entity"])):j("",!0)]),"consumer-credentials":n(()=>[d($,{title:"Credentials"}),K("section",null,[d(B,{"handle-click":()=>i.navigateToPlugins(),title:s.emptyMessage,message:s.credentialMessage,"rbac-settings":{workspace:e.workspace,restricted:[{path:"/consumers/*/plugins",actions:["create"]}]},"button-props":{appearance:"primary"},"cta-text":"Install Plugin",transparent:""},{default:n(()=>[(w(!0),O(he,null,ne(i.credentials,u=>(w(),M(_,{key:u.plugin,"consumer-id":i.id,plugin:u.plugin,title:u.title},null,8,["consumer-id","plugin","title"]))),128))]),_:1},8,["handle-click","title","message","rbac-settings"])])]),_:1},8,["entity","items"]),d(k,{modelValue:s.deleteModalModel,"onUpdate:modelValue":r[0]||(r[0]=u=>s.deleteModalModel=u),entity:t.entity.rootPath,"redirect-route":s.redirectRouteAfterDelete,"entity-name":"consumer",class:"defaultModal"},null,8,["modelValue","entity","redirect-route"])])}Se=ve(yt,[["render",_t],["__scopeId","data-v-e7e6c7b3"]])});export{Sa as __tla,Se as default};
