/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as st,H as nt,N as it,M as ct,z as b,Q as pt,u as ut,at as dt,m,n as ht,J as ft,a8 as g,g as kt,r as s,c as o,b as p,w as u,o as e,a,t as h,h as d,l as _,d as n,p as bt,e as mt,__tla as gt}from"./index.84d84090.3_3_0_0.js";import{W as _t,__tla as vt}from"./WorkspaceMixin.71f3f83c.3_3_0_0.js";import{__tla as Et}from"./monaco-editor.90904fcf.3_3_0_0.js";let v,wt=Promise.all([(()=>{try{return gt}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return Et}catch{}})()]).then(async()=>{const E={name:"PortalOverview",components:{PageHeader:nt},mixins:[_t,it],data(){return{workspacePortalUrl:null,portalURL:null,portalAuthType:null,portalAuth:!1,portalAuthError:!1,masterPortalAuth:null,masterPortalEnabled:null,portalEnabled:!1,portalLoaded:!1,machine:ct({id:"portalMachine",initial:"off",states:{off:{on:{TURN_ON:"turningOn"}},on:{on:{TURN_OFF:"confirm",SUBMIT:"submitting"}},turningOn:{on:{RESOLVE:"on",REJECT:"error"}},error:{on:{type:"final"}}}})}},computed:{...b(pt,{portalDocs:"docsPortal"}),...b(ut,{perms:"permissions"}),buttonText(){return{turningOn:"Enabling Developer Portal",off:"Enable Developer Portal"}[this.currentState]},canUpdateWorkspace(){return this.$rbac.isAllowed(this.perms,[{path:`/workspaces/${this.workspace}`,actions:["update"]}],this.workspace)},portalLabelText(){return this.canUpdateWorkspace?"When turning on the portal for first time, it can take up to a few minutes to populate the files.":"You do not have permission to enable the Dev Portal"}},mounted(){this.getWorkspaceConfig().then(t=>{this.portalLoaded=!0,this.portalURL=dt(t,this.workspace),this.portalEnabled=t.portal;const i=t.portal_auth;i==="openid-connect"||i==="basic-auth"||i==="key-auth"||this.masterPortalAuth!==null&&this.portalAuthType!==" "?this.portalAuth=!0:this.portalAuth!==""||this.masterPortalAuth===null?this.portalAuth=!1:this.portalAuthError=!0})},methods:{...m(ht,["notify"]),...m(ft,["setWorkspaceConfig"]),async togglePortal(){this.transition("TURN_ON");try{const t=await this.$api.updateWorkspace(this.workspace,{config:{portal:!0}});this.setWorkspaceConfig(t.data.config),g.trackEvent(g.EVENTS.PORTAL_ENABLED),this.portalEnabled=!0,this.transition("RESOLVE")}catch(t){this.handleError(t)}},handleError(t){this.transition("REJECT"),this.notify({message:kt(t),type:"danger"})}}},l=t=>(bt("data-v-da73454f"),t=t(),mt(),t),w={key:0},y={class:"row header"},A=n(" Dev Portal Docs "),P={key:0,class:"col"},L={class:"row"},D={class:"col-lg-12 container"},O={"data-testid":"portalEnabledHero",class:"hero"},R=l(()=>a("h2",null,"Dev Portal is enabled!",-1)),T=l(()=>a("h6",null,"Access your Dev Portal at the link below",-1)),U={class:"url-display"},x=["href"],S={class:"auth-status"},W={key:0,class:"auth-enabled"},N=l(()=>a("i",{class:"material-icons"},"lock",-1)),C=n("Authentication is Enabled"),H=[N,C],$={key:1,class:"auth-disabled"},V=l(()=>a("i",{class:"material-icons"},"lock_open",-1)),B=n("Authentication is Disabled"),I=[V,B],J={key:2,class:"auth-error"},M=l(()=>a("i",{class:"material-icons"},"lock",-1)),z=l(()=>a("strong",null,"Error",-1)),F=n(": Unsupported Authentication Plugin"),K=[M,z,F],Q=["href"],Y={key:1,class:"col"},j={class:"row"},q={class:"col-lg-12 container"},G={"data-testid":"portalDisabledHero",class:"hero"},X=l(()=>a("h2",null,"Dev Portal is disabled",-1)),Z={class:"portal-enable-text lower-text"},tt={key:1,class:"mb-7"};function at(t,i,yt,At,r,c){const et=s("PageHeader"),f=s("KButton"),rt=s("KIcon"),ot=s("RbacEmptyList"),lt=s("RbacValidate");return e(),o("section",null,[p(lt,{workspace:t.workspace,restricted:[{path:`/workspaces/${t.workspace}`,actions:["read"]}]},{default:u(({isAllowed:k})=>[r.portalLoaded&&k?(e(),o("div",w,[a("div",y,[p(et,{title:"Dev Portal Overview"}),p(f,{to:t.portalDocs.url,class:"float-right",appearance:"outline",rel:"noopener",target:"_blank"},{default:u(()=>[A]),_:1},8,["to"])]),r.portalEnabled?(e(),o("div",P,[a("div",L,[a("div",D,[a("div",O,[a("div",null,[R,T,a("div",U,[a("a",{href:r.portalURL,rel:"noopener",target:"_blank"},h(r.portalURL),9,x)])]),a("span",S,[r.portalAuth===!0?(e(),o("span",W,H)):d("",!0),r.portalAuth?d("",!0):(e(),o("span",$,I)),r.portalAuthError?(e(),o("span",J,K)):d("",!0)]),a("a",{id:"authDocsLink",href:`${t.portalDocs.url}/authentication/basic-auth/`,class:"mb-2 lower-text",rel:"noopener",target:"_blank"}," Learn more about supported authentication plugins ",8,Q)])])])])):(e(),o("div",Y,[a("div",j,[a("div",q,[a("div",G,[X,p(f,{id:"portal-switch",disabled:["turningOn","turningOff"].includes(t.currentState)||!c.canUpdateWorkspace,class:"mb-4",appearance:"primary","data-testid":"portalSwitch",onClick:c.togglePortal},{icon:u(()=>[["turningOn","turningOff"].includes(t.currentState)?(e(),_(rt,{key:0,color:t.currentState==="turningOff"?"#000":"#fff",icon:"spinner",size:"16"},null,8,["color"])):d("",!0)]),default:u(()=>[n(" "+h(c.buttonText),1)]),_:1},8,["disabled","onClick"]),a("div",Z,h(c.portalLabelText),1)])])])]))])):!r.portalLoaded&&k?(e(),o("div",tt," Loading... ")):(e(),_(ot,{key:2}))]),_:1},8,["workspace","restricted"])])}v=st(E,[["render",at],["__scopeId","data-v-da73454f"]])});export{wt as __tla,v as default};
