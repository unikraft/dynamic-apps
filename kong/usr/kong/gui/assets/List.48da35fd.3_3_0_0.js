/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as W,aw as It,B as x,C as T,ak as de,ax as be,r as K,o as I,c as A,b as g,O as pe,ay as l,w as u,d as V,t as B,k as te,ah as ae,a as E,l as j,R as ke,U as ye,i as Mt,G,h as ne,az as we,aA as _e,aB as Bt,J as Et,aC as Rt,n as $t,q as Vt,y as Ft,__tla as At}from"./index.84d84090.3_3_0_0.js";import{u as qt,a as Ot,b as se,__tla as jt}from"./useRbacPermission.15766885.3_3_0_0.js";import{__tla as Nt}from"./monaco-editor.90904fcf.3_3_0_0.js";let Se,Ut=Promise.all([(()=>{try{return At}catch{}})(),(()=>{try{return jt}catch{}})(),(()=>{try{return Nt}catch{}})()]).then(async()=>{const Ce={title:"Key Sets",list:{toolbar_actions:{new_key_set:"New Key Set"},table_headers:{name:"Name",id:"ID",tags:"Tags"},empty_state:{title:"Configure a New Key Set",description:"A Key Set object holds a collection of asymmetric key objects. This entity allows to logically group keys by their purpose."}},actions:{create:"New Key Set",copy_id:"Copy ID",copy_json:"Copy JSON",edit:"Edit",delete:"Delete",clear:"Clear",view:"View Details"},search:{placeholder:"Filter by exact name or ID"},delete:{title:"Delete a Key Set",description:"Deleting this key set will also delete keys associated. This action cannot be reversed so make sure to check the key set usage before deleting."},errors:{general:"Key sets could not be retrieved",delete:"The key set could not be deleted at this time.",copy:"Failed to copy to clipboard"},copy:{success:"Copied {val} to clipboard",success_brief:"Successfully copied to clipboard"},form:{sections:{general:{title:"General Information",description:"General information will help identify and manage this key set."}},fields:{name:{label:"Name",placeholder:"Enter a unique name for this key set"},tags:{label:"Tags",placeholder:"Enter a list of tags separated by comma",help:"e.g. tag1, tag2, tag3",tooltip:"An optional set of strings for grouping and filtering, separated by commas."}}}},Pe={keySets:Ce};function xe(){const e=we("en-us",Pe);return{i18n:e,i18nT:_e(e)}}const Te={useI18n:xe},Ke={list:{konnect:"/api/runtime_groups/{controlPlaneId}/key-sets",kongManager:"/{workspace}/key-sets"},form:{konnect:{create:"/api/runtime_groups/{controlPlaneId}/key-sets",edit:"/api/runtime_groups/{controlPlaneId}/key-sets/{id}"},kongManager:{create:"/{workspace}/key-sets",edit:"/{workspace}/key-sets/{id}"}}};function le(e={}){return{axiosInstance:Bt.create({withCredentials:!0,timeout:3e4,...e})}}function Ie(e,n){const t=l(n),a=T(()=>e.apiBaseUrl.startsWith("/")?new URL(`${window.location.origin}${t}`):new URL(t));return a.value.search="",s=>`${a.value.href}/${s}`}const Me={message:"Are you sure you want to delete this {entityType}?",messageWithName:"Are you sure you want to delete this {entityType} {entityName}?"},Be={actions:{save:"Save",cancel:"Cancel",back:"Back"},errors:{edit:"The entity could not be edited at this time."}},Ee={emptyState:{noSearchResultsTitle:"No results found",noSearchResultsMessage:"Please adjust the criteria and try again.",noSearchResultsCtaText:"Clear"}},Re={filterButtonText:"Filter",fieldLabel:"Filter by:",inputPlaceholder:"Enter a value",selectPlaceholder:"Select an item",applyButtonText:"Apply",clearButtonText:"Clear",clearAllButtonText:"Clear all filters"},$e={errors:{fetch:"Could not fetch available items",invalid:"Please select a valid value"}},Ve={unexpected:"An unexpected error has occurred"},Fe={enable:{title:"Enable {entityType}",message:"Are you sure you want to enable the {entityType} {entityName}?",confirmText:"Yes, enable"},disable:{title:"Disable {entityType}",message:"Are you sure you want to disable the {entityType} {entityName}?",confirmText:"Yes, disable"}},Ae={deleteModal:Me,baseForm:Be,baseTable:Ee,filter:Re,debouncedFilter:$e,errors:Ve,toggleModal:Fe};function re(){const e=we("en-us",Ae);return{i18n:e,i18nT:_e(e)}}function qe(){const{i18n:{t:e}}=re();return{getMessageFromError:n=>{var t,a,s;if(!n)return e("errors.unexpected");if((t=n==null?void 0:n.response)!=null&&t.data){if(n.response.data.detail)return n.response.data.detail;if((a=n.response.data.details)!=null&&a.length)return n.response.data.details.map(o=>{let b=e("errors.unexpected");return o.messages&&typeof o.messages=="object"&&o.messages.length&&(b=o.messages.join(", ")),o.field?`${o.field} - ${b}`:b}).join("; ");if(n.response.data.message){const{message:o}=n.response.data;return Array.isArray(o)?(s=o[0])!=null&&s.constraints?Object.values(o[0].constraints)[0]:o[0]:o}if(typeof n.response.data=="string")return n.response.data;if(typeof n.response.data=="object")return Object.keys(n.response.data).map(o=>`${o} ${n.response.data[o]}`).join(", ")}return n.message||e("errors.unexpected")}}}function fe(e,n){const t=x(l(e)),a=x(l(n)),s=T(()=>!!(t.value.app==="konnect"||t.value.isExactMatch)),o=T(()=>a.value.startsWith("/")?new URL(`${window.location.origin}${a.value}`):new URL(a.value));return b=>{const{page:h,pageSize:k,offset:y,sortColumnKey:f,sortColumnOrder:_,query:P}=b;try{let v=new URL(o.value.href);return s.value&&P?(v.search="",v=new URL(`${v.href}/${P}/`)):(s.value||new URLSearchParams(P).forEach((F,c)=>{v.searchParams.append(c,F)}),f&&v.searchParams.append("sort_by",f),_==="desc"&&v.searchParams.append("sort_desc","1"),v.searchParams.append("size",String(k))),y&&h!==1&&v.searchParams.append("offset",String(y)),v.href}catch(v){return console.error("RouteList(fetcher)",v),a.value}}}function Oe(){return{debounce:(e,n)=>{let t;return(...a)=>{clearTimeout(t),t=window==null?void 0:window.setTimeout(()=>{e(...a)},n)}}}}const oe="khcp-user-table-preferences",je={pageSize:30,sortColumnKey:void 0,sortColumnOrder:void 0};function Ne(){const e=t=>{if(typeof t=="string")try{return JSON.parse(t)}catch(a){console.error("useTablePreferences(tryParseJson)",a);return}},n=()=>{const t=e(localStorage.getItem(oe));return!t||!Object.keys(t).length?new Map:new Map(Object.entries(t))};return{setTablePreferences:(t,a)=>{try{const s=n();s.set(t,a),localStorage.setItem(oe,JSON.stringify(Object.fromEntries(s.entries())))}catch(s){console.error("useTablePreferences(setTablePreferences)",s)}},getTablePreferences:t=>{const a=n();return(a==null?void 0:a.get(t))||void 0||je},deleteAllTablePreferences:()=>{localStorage.removeItem(oe)}}}function Ue(e,n,t){t||(t="100");const{axiosInstance:a}=le({headers:e.requestHeaders}),{i18n:{t:s}}=re(),{debounce:o}=Oe(),b=o(async r=>{await p(r)},200),h=x(!1),k=x(""),y=x(""),f=x([]),_=x(void 0),P=l(n);let v=`${e.apiBaseUrl}${P}`;e.app==="konnect"?v=v.replace(/{controlPlaneId}/gi,(e==null?void 0:e.controlPlaneId)||""):e.app==="kongManager"&&(v=v.replace(/{workspace}/gi,(e==null?void 0:e.workspace)||""));const F=async()=>{try{h.value=!0;const{data:r}=await a.get(`${v}?size=${t}`);r!=null&&r.next||(_.value=r.data),r!=null&&r.data&&(f.value=r.data)}catch{f.value=[],k.value=s("debouncedFilter.errors.fetch")}finally{h.value=!1}},c=x(""),p=async r=>{var d,S;if(c.value!==r)if(c.value=r||"",_.value===void 0)try{h.value=!0,k.value="",y.value="";let R=v+"";r&&(R+=`/${r}`);const{data:$}=await a.get(`${R}?size=${t}`);$!=null&&$.data?f.value=$.data:$!=null&&$.id?f.value=[$]:f.value=[]}catch(R){((d=R==null?void 0:R.response)==null?void 0:d.status)===404?y.value=s("debouncedFilter.errors.invalid"):(f.value=[],k.value=s("debouncedFilter.errors.fetch"))}finally{h.value=!1}else h.value=!0,y.value="",r?(f.value=(S=_.value)==null?void 0:S.filter(R=>R.id.includes(r)),(!f.value||!f.value.length)&&(y.value=s("debouncedFilter.errors.invalid"))):f.value=_.value,h.value=!1};return{loading:h,error:k,validationError:y,results:f,allRecords:_,loadItems:F,debouncedQueryChange:b}}var me=(e=>(e.GatewayService="service",e.Route="route",e.Consumer="consumer",e.ConsumerGroup="consumer group",e.Plugin="plugin",e.Upstream="upstream",e.Certificate="certificate",e.CACertificate="ca certificate",e.SNI="SNI",e.Key="key",e.KeySet="key set",e.Vault="vault",e.Application="application",e.Developer="developer",e.acls="ACL Credential",e["basic-auth"]="Basic Auth Credential",e["key-auth"]="Key Auth Credential",e["key-auth-enc"]="Key Auth Encrypted Credential",e.oauth2="OAuth 2.0 Credential",e["hmac-auth"]="HMAC Credential",e.jwt="JWT Credential",e.Target="target",e))(me||{}),q=(e=>(e[e.Loading=0]="Loading",e[e.Idle=1]="Idle",e[e.NoResults=2]="NoResults",e[e.Error=3]="Error",e))(q||{});function Le(e,n,t="data"){const a=l(n),{axiosInstance:s}=le({headers:e.requestHeaders}),o=fe(e,a),b=x({status:q.Idle});return{fetcher:async h=>{try{b.value={status:q.Loading};const k=o(h),{data:y}=await s.get(k),f=t&&t.replace(/[^\w-_]/gi,"");let _;y[f]&&Array.isArray(y[f])?_=y[f]:_=Object.keys(y).length?[y]:[];const P={data:_,total:_.length,...y.offset?{pagination:{offset:y.offset}}:null};return b.value={status:q.Idle,response:P},P}catch(k){const y={data:[],total:0};return h.query&&k.response.status===404?(b.value={status:q.NoResults,response:y,error:k},y):(b.value={status:q.Error,response:y,error:k},y)}},fetcherState:b}}const Z={useAxios:le,useDeleteUrlBuilder:Ie,useErrors:qe,useFetchUrlBuilder:fe,useDebouncedFilter:Ue,useFetcher:Le,useI18n:re},ie=(e,n)=>{const t=e.__vccOpts||e;for(const[a,s]of n)t[a]=s;return t},De={class:"toolbar-container"},He={key:0,class:"toolbar-button-container"},ze=["data-testid"],Je=W({__name:"EntityBaseTable",props:{tableHeaders:{type:Object,required:!0,default:()=>({})},fetcher:{type:Function,required:!0,default:async()=>({data:[],total:0})},initialFetcherParams:{type:Object,default:null},fetcherCacheKey:{type:Number,default:1},isLoading:{type:Boolean,default:!1},query:{type:String,default:""},enableClientSort:{type:Boolean,default:!1},enableEntityActions:{type:Boolean,default:!0},emptyStateOptions:{type:Object,default:()=>({})},errorMessage:{type:String,default:""},disablePaginationPageJump:{type:Boolean,default:void 0},disableSorting:{type:Boolean,default:void 0},paginationType:{type:String,default:void 0},cellAttributes:{type:Function,default:()=>({})},rowAttributes:{type:Function,default:()=>({})},preferencesStorageKey:{type:String,default:"",required:!0},dropdownMenuWidth:{type:String,default:"",required:!1}},emits:["click:row","sort","clear-search-input","empty-state-cta-clicked"],setup(e,{emit:n}){const t=e,{i18n:{t:a}}=Z.useI18n(),s=T(()=>{const c=[];return Object.keys(t.tableHeaders).forEach(p=>{const r=t.tableHeaders[p];c.push({label:r.label??p,key:p,sortable:r.sortable??!1})}),t.enableEntityActions&&c.push({key:"actions",hideLabel:!0}),c}),o=c=>({"data-rowid":c.id,"data-testid":c.name,...t.rowAttributes(c)}),b=c=>({"data-testid":c.headerKey,...t.cellAttributes(c)}),h=()=>{n("empty-state-cta-clicked"),k()},k=()=>{n("clear-search-input")},y=(c,p)=>{n("click:row",p)},f=c=>{n("sort",c)},{setTablePreferences:_,getTablePreferences:P}=Ne(),v=T(()=>{const c=P(t.preferencesStorageKey);return{...t.initialFetcherParams,...c}}),F=c=>{t.preferencesStorageKey&&_(t.preferencesStorageKey,c)};return(c,p)=>{const r=K("KIcon"),d=K("KButton"),S=K("KDropdownMenu"),R=K("KTable"),$=K("KCard");return I(),j($,{class:"kong-ui-entity-base-table"},{body:u(()=>[g(R,{"cell-attrs":b,"disable-pagination-page-jump":e.disablePaginationPageJump,"disable-sorting":e.disableSorting,"empty-state-action-button-icon":e.query?"":"plus","empty-state-action-message":e.query?l(a)("baseTable.emptyState.noSearchResultsCtaText"):e.emptyStateOptions.ctaText,"empty-state-action-route":e.query?"":e.emptyStateOptions.ctaPath,"empty-state-icon":e.query?"stateNoSearchResults":"stateGruceo","empty-state-icon-size":"96","empty-state-message":e.query?l(a)("baseTable.emptyState.noSearchResultsMessage"):e.emptyStateOptions.message,"empty-state-title":e.query?l(a)("baseTable.emptyState.noSearchResultsTitle"):e.emptyStateOptions.title,"enable-client-sort":e.enableClientSort,"error-state-title":e.errorMessage,fetcher:e.fetcher,"fetcher-cache-key":String(e.fetcherCacheKey),"has-error":!!e.errorMessage,headers:l(s),"hide-pagination-when-optional":"","initial-fetcher-params":l(v),"is-loading":e.isLoading,"pagination-type":e.paginationType,"row-attrs":o,"search-input":e.query,onKtableEmptyStateCtaClicked:h,"onRow:click":y,onSort:f,"onUpdate:tablePreferences":F},pe({toolbar:u(()=>[E("div",De,[G(c.$slots,"toolbar-filter",{},void 0,!0),c.$slots["toolbar-button"]?(I(),A("div",He,[G(c.$slots,"toolbar-button",{},void 0,!0)])):ne("",!0)])]),actions:u(({row:N,rowKey:w,rowValue:U})=>[E("div",{class:"actions-container","data-testid":N.name},[g(S,{"kpop-attributes":{placement:"bottomEnd"},width:e.dropdownMenuWidth},{items:u(()=>[G(c.$slots,"actions",{row:N,rowKey:w,rowValue:U},void 0,!0)]),default:u(()=>[g(d,{class:"non-visual-button","data-testid":"overflow-actions-button",size:"small"},{icon:u(()=>[g(r,{color:"var(--black-400, #3c4557)",icon:"more",size:"16"})]),_:1})]),_:2},1032,["width"])],8,ze)]),_:2},[ye(e.tableHeaders,(N,w)=>({name:w,fn:u(({row:U,rowKey:L,rowValue:D})=>[G(c.$slots,w,{row:U,rowKey:L,rowValue:D},void 0,!0)])}))]),1032,["disable-pagination-page-jump","disable-sorting","empty-state-action-button-icon","empty-state-action-message","empty-state-action-route","empty-state-icon","empty-state-message","empty-state-title","enable-client-sort","error-state-title","fetcher","fetcher-cache-key","has-error","headers","initial-fetcher-params","is-loading","pagination-type","search-input"])]),_:3})}}}),We=ie(Je,[["__scopeId","data-v-6eab8cd1"]]),Ge={key:0,class:"kong-ui-entity-delete-error"},Ye={key:1,class:"description"},Ze=W({__name:"EntityDeleteModal",props:{visible:{type:Boolean,required:!0,default:!1},title:{type:String,default:"Delete"},entityType:{type:String,required:!0},entityName:{type:String,default:""},needConfirm:{type:Boolean,default:!0},description:{type:String,default:""},actionPending:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["cancel","proceed"],setup(e,{emit:n}){const t=e,{i18nT:a}=Z.useI18n(),s=T(()=>t.needConfirm?t.entityName:""),o=()=>{n("cancel")},b=()=>{n("proceed")};return(h,k)=>{const y=K("KAlert"),f=K("KPrompt");return I(),j(f,{"action-button-text":"Yes, delete","action-pending":e.actionPending,class:"kong-ui-entity-delete-modal","confirmation-text":l(s),"is-visible":e.visible,title:e.title,type:"danger",onCanceled:o,onProceed:b},{"body-content":u(()=>[e.error?(I(),A("div",Ge,[g(y,{appearance:"danger"},{alertMessage:u(()=>[V(B(e.error),1)]),_:1})])):ne("",!0),g(l(a),{class:"message",keypath:t.entityName?"deleteModal.messageWithName":"deleteModal.message",tag:"p"},pe({entityType:u(()=>[V(B(t.entityType),1)]),_:2},[t.entityName?{name:"entityName",fn:u(()=>[E("strong",null,B(t.entityName),1)]),key:"0"}:void 0]),1032,["keypath"]),t.description||h.$slots.description?(I(),A("div",Ye,[G(h.$slots,"description",{},()=>[E("p",null,B(t.description),1)],!0)])):ne("",!0)]),_:3},8,["action-pending","confirmation-text","is-visible","title"])}}}),Qe=ie(Ze,[["__scopeId","data-v-3513e33b"]]),Xe={fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},et={id:"mask0_180_20349",height:"20",maskUnits:"userSpaceOnUse",style:{"mask-type":"alpha"},width:"20",x:"0",y:"0"},tt=["fill"],at={mask:"url(#mask0_180_20349)"},nt=["fill"],st=W({__name:"IconFilter",props:{color:{type:String,default:"var(--kong-ui-entity-filter-color, var(--blue-500, #1155cb))"}},setup(e){return(n,t)=>(I(),A("svg",Xe,[E("mask",et,[E("rect",{fill:e.color,height:"20",width:"20"},null,8,tt)]),E("g",at,[E("path",{d:"M8 14.5V13H12V14.5H8ZM5 10.75V9.25H15V10.75H5ZM3 7V5.5H17V7H3Z",fill:e.color},null,8,nt)])]))}}),lt={key:1,class:"kong-ui-entity-filter"},rt={class:"menu-item-title"},ot={class:"menu-item-indicator"},it={class:"menu-item-body"},ct=["for"],ut={class:"menu-item-buttons"},dt=W({__name:"EntityFilter",props:{config:{type:Object,required:!0,default:()=>({isExactMatch:!0,placeholder:""})},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:n}){const t=e,{i18n:{t:a}}=Z.useI18n(),s=x(!1),o=x({}),b=T(()=>{const p=[];return new URLSearchParams(t.modelValue).forEach((r,d)=>{r!==""&&p.push(d)}),p}),h=T(()=>{const p=t.config.fields;return Object.keys(p).filter(r=>p[r].searchable).map(r=>({label:p[r].label||r,value:r}))});de(()=>t.modelValue,p=>{o.value={},new URLSearchParams(p).forEach((r,d)=>{o.value[d]=r})});const k=()=>{s.value=!s.value},y=p=>{n("update:modelValue",p)},f=p=>`filter-${p}`,_=p=>{var r,d;return(((d=(r=t.config.schema)==null?void 0:r[p])==null?void 0:d.values)??[]).map(S=>({value:S,label:S}))},P=p=>{var r,d;return((d=(r=t.config.schema)==null?void 0:r[p])==null?void 0:d.type)??"text"},v=p=>{o.value={...o.value,[p]:""},c()},F=()=>{o.value={},c(!0)},c=(p=!1)=>{const r=Object.keys(o.value).reduce((d,S)=>(o.value[S]&&(d[S]=`${o.value[S]}`),d),{});p&&(s.value=!1),n("update:modelValue",new URLSearchParams(r).toString())};return(p,r)=>{const d=K("KInput"),S=K("KButton"),R=K("KSelect"),$=K("KMenuItem"),N=K("KMenu");return e.config.isExactMatch?(I(),j(d,{key:0,autocomplete:"off",class:"kong-ui-entity-filter-input","data-testid":"search-input","model-value":e.modelValue,placeholder:e.config.placeholder,"onUpdate:modelValue":y},{icon:u(()=>[g(st)]),_:1},8,["model-value","placeholder"])):(I(),A("div",lt,[g(S,{appearance:"btn-link","data-testid":"filter-button",icon:"filter",onClick:k},{default:u(()=>[V(B(l(a)("filter.filterButtonText"))+" "+B(l(b).length>0?`(${l(b).length})`:""),1)]),_:1}),te(E("div",{class:"kong-ui-entity-filter-backdrop",onClick:k},null,512),[[ae,s.value]]),te(g(N,{class:"kong-ui-entity-filter-menu"},{body:u(()=>[(I(!0),A(ke,null,ye(l(h),(w,U)=>(I(),j($,{key:w.value,"data-testid":w.value,expandable:"","last-menu-item":U===l(h).length-1},{itemTitle:u(()=>[E("span",rt,[V(B(w.label)+" ",1),te(E("span",ot,null,512),[[ae,l(b).includes(w.value)]])])]),itemBody:u(()=>{var L,D;return[E("div",it,[E("label",{class:"menu-item-label",for:f(w.value)},B(l(a)("filter.fieldLabel")),9,ct),((D=(L=e.config.schema)==null?void 0:L[w.value])==null?void 0:D.type)==="select"?(I(),j(R,{key:0,id:f(w.value),modelValue:o.value[w.value],"onUpdate:modelValue":H=>o.value[w.value]=H,appearance:"select",items:_(w.value),placeholder:l(a)("filter.selectPlaceholder")},null,8,["id","modelValue","onUpdate:modelValue","items","placeholder"])):(I(),j(d,{key:1,id:f(w.value),modelValue:o.value[w.value],"onUpdate:modelValue":H=>o.value[w.value]=H,autocomplete:"off",placeholder:l(a)("filter.inputPlaceholder"),size:"small",type:P(w.value)},null,8,["id","modelValue","onUpdate:modelValue","placeholder","type"]))]),E("div",ut,[g(S,{appearance:"btn-link","data-testid":"apply-filter",size:"small",onClick:r[0]||(r[0]=H=>c(!0))},{default:u(()=>[V(B(l(a)("filter.applyButtonText")),1)]),_:1}),g(S,{appearance:"btn-link","data-testid":"clear-filter",size:"small",onClick:H=>v(w.value)},{default:u(()=>[V(B(l(a)("filter.clearButtonText")),1)]),_:2},1032,["onClick"])])]}),_:2},1032,["data-testid","last-menu-item"]))),128))]),actionButton:u(()=>[g(S,{onClick:F},{default:u(()=>[V(B(l(a)("filter.clearAllButtonText")),1)]),_:1})]),_:1},512),[[ae,s.value]])]))}}}),pt=ie(dt,[["__scopeId","data-v-fcf9a8f1"]]),Q=W({__name:"PermissionsWrapper",props:{authFunction:{type:Function,required:!0,default:async()=>!0},forceShow:{type:Boolean,default:!1}},setup(e){const n=e,t=x(void 0),a=T(()=>t.value===!0||t.value!==void 0&&n.forceShow===!0);return be(async()=>{t.value=await n.authFunction()}),(s,o)=>l(a)?G(s.$slots,"default",{key:0,isAllowed:t.value}):ne("",!0)}}),{useAxios:yt,useDeleteUrlBuilder:ft,useErrors:Lt,useFetchUrlBuilder:Dt,useFetcher:mt,useDebouncedFilter:Ht}=Z,gt={class:"kong-ui-entities-key-sets-list"},ht={key:1},vt=W({__name:"KeySetList",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.createRoute||!e.getViewRoute||!e.getEditRoute||e.app==="kongManager"&&!e.isExactMatch&&!e.filterSchema)},canCreate:{type:Function,required:!1,default:async()=>!0},canDelete:{type:Function,required:!1,default:async()=>!0},canEdit:{type:Function,required:!1,default:async()=>!0},canRetrieve:{type:Function,required:!1,default:async()=>!0}},emits:["error","loading","copy:success","copy:error","delete:success"],setup(e,{emit:n}){var t;const a=e,{i18n:{t:s}}=Te.useI18n(),o=It(),{axiosInstance:b}=yt({headers:(t=a.config)==null?void 0:t.requestHeaders}),h=x(1),k=T(()=>a.config.app!=="kongManager"||!!a.config.disableSorting),y={name:{label:s("keySets.list.table_headers.name"),searchable:!0,sortable:!0},tags:{label:s("keySets.list.table_headers.tags")},id:{label:s("keySets.list.table_headers.id"),sortable:!0}},f=y,_=T(()=>{var i,m;let M=`${a.config.apiBaseUrl}${Ke.list[a.config.app]}`;return a.config.app==="konnect"?M=M.replace(/{controlPlaneId}/gi,((i=a.config)==null?void 0:i.controlPlaneId)||""):a.config.app==="kongManager"&&(M=M.replace(/{workspace}/gi,((m=a.config)==null?void 0:m.workspace)||"")),M}),P=x(""),v=T(()=>{const i=a.config.app==="konnect"||a.config.isExactMatch;if(i)return{isExactMatch:i,placeholder:s("keySets.search.placeholder")};const m={name:y.name};return{isExactMatch:i,fields:m,schema:a.config.filterSchema}}),{fetcher:F,fetcherState:c}=mt(a.config,_.value),p=()=>{P.value=""},r=()=>{h.value++},d=x(""),S=T(()=>c.value.status===q.Loading),R=T(()=>{var i;return c.value.status===q.Idle&&!!((i=c.value.response)!=null&&i.data.length)}),$=T(()=>!S.value&&(R.value||!!P.value)),N=(i,m)=>{const M=i.id;if(!m(M)){D(i,"id");return}L(i,"id")},w=(i,m)=>{const M=JSON.stringify(i);if(!m(M)){n("copy:error",{entity:i,message:s("keySets.errors.copy")});return}n("copy:success",{entity:i,message:s("keySets.copy.success_brief")})},U=(i,m,M)=>{const{type:J}=i;J==="success"?L(m,M):D(m,M)},L=(i,m)=>{n("copy:success",{entity:i,field:m,message:s("keySets.copy.success",{val:i[m]})})},D=(i,m)=>{n("copy:error",{entity:i,field:m,message:s("keySets.errors.copy")})},H=async i=>{var m;await((m=a.canRetrieve)==null?void 0:m.call(a,i))&&o.push(a.config.getViewRoute(i.id))},wt=i=>({label:s("keySets.actions.view"),to:a.config.getViewRoute(i)}),_t=i=>({label:s("keySets.actions.edit"),to:a.config.getEditRoute(i)}),z=x(void 0),X=x(!1),ee=x(!1),he=x(""),St=ft(a.config,_.value),Ct=i=>{z.value=i,X.value=!0},Pt=()=>{X.value=!1},xt=async()=>{var i,m,M;if((i=z.value)!=null&&i.id){ee.value=!0;try{await b.delete(St(z.value.id)),ee.value=!1,X.value=!1,h.value++,n("delete:success",z.value)}catch(J){he.value=((M=(m=J.response)==null?void 0:m.data)==null?void 0:M.message)||J.message||s("keySets.errors.delete"),n("error",J)}finally{ee.value=!1}}};de(S,i=>{n("loading",i)},{immediate:!0}),de(c,i=>{if(i.status===q.Error){d.value=s("keySets.errors.general"),n("error",i.error);return}d.value=""});const ce=x({ctaPath:a.config.createRoute,ctaText:void 0,message:s("keySets.list.empty_state.description"),title:s("keySets.title")});return be(async()=>{await a.canCreate()&&(ce.value.title=s("keySets.list.empty_state.title"),ce.value.ctaText=s("keySets.actions.create"))}),(i,m)=>{const M=K("KButton"),J=K("KBadge"),Tt=K("KTruncate"),Kt=K("CopyUuid"),Y=K("KDropdownItem"),ve=K("KClipboardProvider");return I(),A("div",gt,[g(l(We),{"disable-pagination-page-jump":"","disable-sorting":l(k),"empty-state-options":ce.value,"enable-entity-actions":"","error-message":d.value,fetcher:l(F),"fetcher-cache-key":h.value,"is-loading":l(S),"pagination-type":"offset","preferences-storage-key":"kong-ui-entities-key-sets-list",query:P.value,"table-headers":l(f),onClearSearchInput:p,"onClick:row":m[2]||(m[2]=C=>H(C)),onSort:r},pe({"toolbar-filter":u(()=>[te(g(l(pt),{modelValue:P.value,"onUpdate:modelValue":m[0]||(m[0]=C=>P.value=C),config:l(v)},null,8,["modelValue","config"]),[[ae,l($)]])]),name:u(({rowValue:C})=>[E("b",null,B(C??"-"),1)]),tags:u(({rowValue:C})=>[(C==null?void 0:C.length)>0?(I(),j(Tt,{key:0},{default:u(()=>[(I(!0),A(ke,null,ye(C,O=>(I(),j(J,{key:O,onClick:m[1]||(m[1]=Mt(()=>{},["stop"]))},{default:u(()=>[V(B(O),1)]),_:2},1024))),128))]),_:2},1024)):(I(),A("span",ht,"-"))]),id:u(({row:C,rowValue:O})=>[g(Kt,{notify:ue=>U(ue,C,"id"),truncated:!1,uuid:O},null,8,["notify","uuid"])]),actions:u(({row:C})=>[g(ve,null,{default:u(({copyToClipboard:O})=>[g(Y,{"data-testid":"action-entity-copy-id",onClick:ue=>N(C,O)},{default:u(()=>[V(B(l(s)("keySets.actions.copy_id")),1)]),_:2},1032,["onClick"])]),_:2},1024),g(ve,null,{default:u(({copyToClipboard:O})=>[g(Y,{"data-testid":"action-entity-copy-json",onClick:ue=>w(C,O)},{default:u(()=>[V(B(l(s)("keySets.actions.copy_json")),1)]),_:2},1032,["onClick"])]),_:2},1024),g(l(Q),{"auth-function":()=>e.canRetrieve(C)},{default:u(()=>[g(Y,{"data-testid":"action-entity-view","has-divider":"",item:wt(C.id)},null,8,["item"])]),_:2},1032,["auth-function"]),g(l(Q),{"auth-function":()=>e.canEdit(C)},{default:u(()=>[g(Y,{"data-testid":"action-entity-edit",item:_t(C.id)},null,8,["item"])]),_:2},1032,["auth-function"]),g(l(Q),{"auth-function":()=>e.canDelete(C)},{default:u(()=>[g(Y,{"data-testid":"action-entity-delete","has-divider":"","is-dangerous":"",onClick:O=>Ct(C)},{default:u(()=>[V(B(l(s)("keySets.actions.delete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["auth-function"])]),_:2},[l($)?{name:"toolbar-button",fn:u(()=>[g(l(Q),{"auth-function":()=>e.canCreate()},{default:u(()=>[g(M,{appearance:"primary","data-testid":"toolbar-add-key-set",icon:"plus",to:e.config.createRoute},{default:u(()=>[V(B(l(s)("keySets.list.toolbar_actions.new_key_set")),1)]),_:1},8,["to"])]),_:1},8,["auth-function"])]),key:"0"}:void 0]),1032,["disable-sorting","empty-state-options","error-message","fetcher","fetcher-cache-key","is-loading","query","table-headers"]),g(l(Qe),{"action-pending":ee.value,description:l(s)("keySets.delete.description"),"entity-name":z.value&&(z.value.name||z.value.id),"entity-type":l(me).KeySet,error:he.value,title:l(s)("keySets.delete.title"),visible:X.value,onCancel:Pt,onProceed:xt},null,8,["action-pending","description","entity-name","entity-type","error","title","visible"])])}}}),bt=(e,n)=>{const t=e.__vccOpts||e;for(const[a,s]of n)t[a]=s;return t},kt=bt(vt,[["__scopeId","data-v-5cba529f"]]);let ge;ge={class:"key-set-listing pt-4"},Se=W({__name:"List",setup(e){const n=Ft("rbac"),t="key-sets",a=Et(),{workspace:s}=Rt(a),o=$t(),b=T(()=>({name:{type:"text"}})),h=T(()=>({name:"create-key-set",params:{workspace:s.value}})),k=T(()=>d=>({name:"show-key-set",params:{workspace:s.value,id:d}})),y=T(()=>d=>({name:"update-key-set",params:{workspace:s.value,id:d}})),f=Vt({...qt(),createRoute:h,getViewRoute:k,getEditRoute:y,filterSchema:b}),_=()=>se(n,{path:t,action:"create"}),P=d=>se(n,{path:`${t}/${d.id}`,action:"delete"}),v=d=>se(n,{path:`${t}/${d.id}`,action:"update"}),F=d=>se(n,{path:`${t}/${d.id}`,action:"read"}),{onCopySuccess:c,onCopyError:p}=Ot(),r=d=>{o.notify({message:`${d.name} Key Set successfully deleted!`,type:"success"})};return(d,S)=>(I(),A("section",ge,[g(l(kt),{config:f,"can-create":_,"can-delete":P,"can-edit":v,"can-retrieve":F,"onCopy:success":l(c),"onCopy:error":l(p),"onDelete:success":r},null,8,["config","onCopy:success","onCopy:error"])]))}})});export{Ut as __tla,Se as default};
