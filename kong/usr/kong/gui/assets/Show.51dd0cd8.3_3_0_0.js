/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{T as J,__tla as W}from"./Tabs.fabb4b38.3_3_0_0.js";import M,{__tla as V}from"./Show.c4e0f2cd.3_3_0_0.js";import{H as D,z as w,Z,_ as v,r,o as l,c as g,b as n,w as s,V as F,h as d,d as y,m as G,l as _,t as Q,a4 as X,a as k,K as Y,E as C,R as tt,U as et,__tla as rt}from"./index.84d84090.3_3_0_0.js";import{E as at,__tla as it}from"./EntityList.9d5d453d.3_3_0_0.js";import{T as st,__tla as nt}from"./entities-plugins.es.44654093.3_3_0_0.js";import{p as ot,u as L,__tla as lt}from"./preferences.ea825a88.3_3_0_0.js";import ut,{__tla as ct}from"./ApplicationsList.00ceb12b.3_3_0_0.js";import{C as dt,a as _t}from"./consumers.07a3440a.3_3_0_0.js";import{E as pt,__tla as ht}from"./EntityMixin.2764673d.3_3_0_0.js";import{E as mt,__tla as ft}from"./EntityConfiguration.03651df4.3_3_0_0.js";import{__tla as gt}from"./useRbacPermission.15766885.3_3_0_0.js";import{__tla as yt}from"./useRedirect.ccdc1330.3_3_0_0.js";import{__tla as bt}from"./EmptyWrapper.df2b9a4e.3_3_0_0.js";import{__tla as Pt}from"./Breadcrumbs.6127883e.3_3_0_0.js";import{__tla as vt}from"./StatusCodesWrapper.94765128.3_3_0_0.js";import{__tla as kt}from"./ChartDataController.a765a4e0.3_3_0_0.js";import{__tla as Ct}from"./ChartHeader.0a2c695d.3_3_0_0.js";import{__tla as Dt}from"./TimeFramePicker.465b75eb.3_3_0_0.js";import"./TimeFrames.25a2a20b.3_3_0_0.js";import{__tla as wt}from"./VitalsDisabled.f093ed15.3_3_0_0.js";import{__tla as Lt}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as Et}from"./LineChartWrapper.be3dd56e.3_3_0_0.js";import"./chartHelpers.1bf67333.3_3_0_0.js";import{__tla as St}from"./TagsBlock.4b7d5635.3_3_0_0.js";import"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as $t}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{__tla as Rt}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{__tla as Tt}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{__tla as zt}from"./RbacPermMixin.3a5f32ef.3_3_0_0.js";import{__tla as Ht}from"./DetailContainer.85becad9.3_3_0_0.js";import"./plugins.f651ca50.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./Consumer.4cc90c16.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";import"./buildRoute.1ddadad0.3_3_0_0.js";import"./icon-help.699f8c28.3_3_0_0.js";import{__tla as At}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as It}from"./EntityFilter.bf4158bc.3_3_0_0.js";import{__tla as xt}from"./EntityListEmptyState.9b958bba.3_3_0_0.js";import{__tla as Ot}from"./DisabledView.3ce50815.3_3_0_0.js";import{__tla as Kt}from"./WorkspaceMixin.71f3f83c.3_3_0_0.js";let E,jt=Promise.all([(()=>{try{return W}catch{}})(),(()=>{try{return V}catch{}})(),(()=>{try{return rt}catch{}})(),(()=>{try{return it}catch{}})(),(()=>{try{return nt}catch{}})(),(()=>{try{return lt}catch{}})(),(()=>{try{return ct}catch{}})(),(()=>{try{return ht}catch{}})(),(()=>{try{return ft}catch{}})(),(()=>{try{return gt}catch{}})(),(()=>{try{return yt}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return Pt}catch{}})(),(()=>{try{return vt}catch{}})(),(()=>{try{return kt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return Dt}catch{}})(),(()=>{try{return wt}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return St}catch{}})(),(()=>{try{return $t}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return Tt}catch{}})(),(()=>{try{return zt}catch{}})(),(()=>{try{return Ht}catch{}})(),(()=>{try{return At}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return xt}catch{}})(),(()=>{try{return Ot}catch{}})(),(()=>{try{return Kt}catch{}})()]).then(async()=>{const S={name:"DeveloperCredentialList",components:{EntityList:at,PageHeader:D},inject:["onHasResults"],inheritAttrs:!1,props:{id:{type:String,default:""},title:{type:String,default:""},name:{type:String,default:""},plugin:{type:String,default:""},endpoint:{type:String,default:""},fields:{type:Object,default:()=>({})}},data(){return{validPluginList:["basic-auth","oauth2","hmac-auth","jwt","key-auth","openid-connect"]}},computed:{...w(Z,{plugins:t=>t.info.plugins}),listOptions(){return{entity:`developers/${this.id}/credentials/${this.plugin}`,entityName:this.name,fields:this.fields,createRoute:`/developers/${this.id}/credentials/${this.plugin}/create`,ctaIsHidden:!0}},show(){return this.isPluginEnabled(this.plugin)}},methods:{isPluginEnabled(t){const e=this.plugins&&this.plugins.enabled_in_cluster.indexOf&&~this.plugins.enabled_in_cluster.indexOf(t)&&~this.validPluginList.indexOf(t);return e&&this.onHasResults&&this.onHasResults(),e}}},$=y(" Add New Credential ");function R(t,e,a,u,o,i){const p=r("KButton"),h=r("PageHeader"),m=r("EntityList");return i.show?(l(),g("section",{key:0,class:F(a.plugin)},[n(h,{size:5,title:a.title},{default:s(()=>[n(p,{to:{name:"create-developer-plugin",params:{id:a.id,type:a.plugin,returnLink:t.$router.currentRoute.value.fullPath}},appearance:"primary"},{default:s(()=>[$]),_:1},8,["to"])]),_:1},8,["title"]),n(m,{options:i.listOptions,"enable-entity-actions":!0,"default-row-click-action":"update","show-delete-action":!0,"show-update-action":!0,"overflow-actions":""},null,8,["options"])],2)):d("",!0)}const T=v(S,[["render",R]]),z={name:"DevelopersPluginsList",components:{PageHeader:D,PluginIcon:st},inject:["onHasResults"],props:{plugins:{type:Array,default:()=>[]},entity:{type:Object,default:()=>{}}},data(){return{pageSizePresets:ot,tableData:{headers:[{label:"Name",key:"name"},{label:"ID",key:"id"},{label:"Enabled",key:"enabled"},{label:"",key:"actions",hideLabel:!0}],data:[]},fetcherCacheKey:(+new Date).toString()}},computed:{...w(L,{pageSize:"listPageSize"}),id(){return this.$route.params.id},show(){return this.hasPlugins()}},methods:{...G(L,["setListPageSize"]),hasPlugins(){if(this.plugins.length>0)return this.tableData.data=this.plugins,this.fetcherCacheKey=(+new Date).toString(),this.onHasResults&&this.onHasResults(),!0},fetcher({pageSize:t}){return this.setListPageSize(t),{data:this.tableData.data,count:this.tableData.data.length}}}},H={key:0},A=y(" Add New Plugin "),I=y(" Edit ");function x(t,e,a,u,o,i){const p=r("KButton"),h=r("PageHeader"),m=r("PluginIcon"),b=r("router-link"),P=r("KTable");return i.show?(l(),g("section",H,[n(h,{size:5,title:"Configured Plugins"},{default:s(()=>[a.plugins.length>0?(l(),_(p,{key:0,to:{name:"select-plugin",params:{id:i.id,props:{returnLink:t.$router.currentRoute.value.fullPath}},query:{...a.entity,no_search:!0,from:"developer"}},appearance:"primary"},{default:s(()=>[A]),_:1},8,["to"])):d("",!0)]),_:1}),i.show?(l(),_(P,{key:0,fetcher:i.fetcher,"fetcher-cache-key":o.fetcherCacheKey,options:o.tableData,"has-side-border":!1,"initial-fetcher-params":{pageSize:t.pageSize},"pagination-page-sizes":o.pageSizePresets},{name:s(({row:c})=>[n(m,{name:c.name,class:"plugin-icon"},null,8,["name"]),y(" "+Q(c.name),1)]),actions:s(({row:c})=>[n(b,{to:{name:"update-plugin",params:{plugin:c.name,id:c.id,returnLink:t.$router.currentRoute.value.fullPath}}},{default:s(()=>[I]),_:2},1032,["to"])]),_:1},8,["fetcher","fetcher-cache-key","options","initial-fetcher-params","pagination-page-sizes"])):d("",!0)])):d("",!0)}const O=v(z,[["render",x]]),K={name:"KMDevelopers",components:{Tabs:J,DeveloperCredentialsList:T,DevelopersPluginList:O,ApplicationsList:ut,EntityConfiguration:mt},extends:M,mixins:[pt],data(){return{configuredPlugins:[],record:{}}},computed:{chartDataUrls(){return this.recordConsumerId?{statusCodes:`status_codes/by_consumer?consumer_id=${this.recordConsumerId}`,codeDetail:`status_codes/by_consumer_and_route?consumer_id=${this.recordConsumerId}`}:{}},recordConsumerId(){return this.record&&this.record.consumer&&this.record.consumer.id},consumerEntity(){return{entity_id:this.recordConsumerId,entity_type:"consumer_id"}},developerTabs(){const t=this.computedTabs.slice();return t.push({hash:"#applications",title:"Applications"}),t},id(){return this.record&&this.record.id||this.$route.params.id}},mounted(){this.fetchRecord()},methods:{fetchRecord(){return this.$api.findRecord("developers",this.id).then(t=>(this.record=t.data,t)).then(this.fetchPlugins).catch(X(this.$router,404,"/404",{replace:!0}))},fetchPlugins(){return this.$api.query(`${this.workspace}/developers/${this.id}/plugins`).then(t=>{this.configuredPlugins=t.data})},transformRecord(t){const e={...t};return Object.keys(e).forEach(a=>{if(a==="type"){const u=e[a];e[a]=dt[u]}if(a==="status"){const u=e[a];e[a]=_t[u]}if(a==="meta"&&e.meta){const u=JSON.parse(e.meta);Object.keys(u).forEach(o=>{e[o]=u[o]}),delete e.meta}}),delete e.consumer,e},notifySiblings(t,e){this[t]=e},navigateToPlugins(){this.$router.push({name:"select-plugin",params:{fields:{consumer_id:this.recordConsumerId},returnLink:this.$route.fullPath},query:{...this.consumerEntity,no_search:!0,hide_breadcrumb:!0,from:"developer"}})}}},j={class:"developer-view"};function N(t,e,a,u,o,i){const p=r("PageHeader"),h=r("EntityConfiguration"),m=r("CodeCountByRoute"),b=r("StatusCodesWrapper"),P=r("DeveloperCredentialsList"),c=r("EmptyWrapper"),U=r("DevelopersPluginList"),q=r("ApplicationsList"),B=r("Tabs");return l(),g("article",j,[n(p,{title:t.title},null,8,["title"]),t.isLoading?d("",!0):(l(),_(h,{key:0,record:o.record,"transform-record":i.transformRecord,"edit-route":{name:"update-developer"},entity:"developers","entity-name":"developer","flatten-actions":""},null,8,["record","transform-record"])),k("section",null,[n(B,{tabs:i.developerTabs},{Activity:s(()=>[k("section",null,[i.recordConsumerId?(l(),_(b,C({key:0},{infoTexts:t.infoTexts,chartDataUrls:i.chartDataUrls},{"status-code-detail-route":"view-consumer-status-code"}),{statusCodeDetail:s(f=>[f.statusCode?(l(),_(m,Y(C({key:0},f)),null,16)):d("",!0)]),_:1},16)):d("",!0)])]),Credentials:s(()=>[k("section",null,[n(c,{"handle-click":i.navigateToPlugins,class:"mb-4",title:"No Credentials",message:"To see Credentials, enable an Authentication plugin and add this Developer.","cta-text":"Add Plugin"},{default:s(()=>[(l(!0),g(tt,null,et(t.credentials,f=>(l(),_(P,C(f,{id:i.id,key:f.credential}),null,16,["id"]))),128))]),_:1},8,["handle-click"])])]),Plugins:s(()=>[n(c,{"handle-click":i.navigateToPlugins,class:"mb-4",title:"No Plugins Enabled",message:"To enable a plugin for this Developer, visit the Plugins Hub","cta-text":"Add Plugin"},{default:s(()=>[n(U,{plugins:o.configuredPlugins,entity:i.consumerEntity},null,8,["plugins","entity"])]),_:1},8,["handle-click"])]),Applications:s(()=>[n(q,{"developer-id":o.record.id},null,8,["developer-id"])]),_:1},8,["tabs"])])])}E=v(K,[["render",N],["__scopeId","data-v-e04a7b2f"]])});export{jt as __tla,E as default};
