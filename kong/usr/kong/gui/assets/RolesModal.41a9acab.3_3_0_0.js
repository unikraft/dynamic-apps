/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as W,W as G,r as d,o as n,c as p,a as o,E as Q,R as j,U as D,V as X,b as f,N as Y,T as Z,M as ee,z as b,I as se,J as te,u as le,g as ae,l as w,w as h,G as oe,h as k,t as y,k as re,v as ce,d as R,p as ne,e as ie,__tla as de}from"./index.84d84090.3_3_0_0.js";import{M as pe,__tla as he}from"./MultiChecklist.d117c9be.3_3_0_0.js";let S,ke=Promise.all([(()=>{try{return de}catch{}})(),(()=>{try{return he}catch{}})()]).then(async()=>{const T={name:"WorkspaceSelector",components:{WorkspaceTitle:G},inheritAttrs:!1,props:{workspaces:{type:Array,required:!0},selectedWorkspace:{type:String,default:""}},emits:["selected"]},E={class:"select-box workspace-select"},F=o("label",{for:"workspace-select-input",class:"sr-only"}," Filter Workspaces ",-1),_=["onClick"];function A(e,s,l,c,t,a){const m=d("WorkspaceTitle");return n(),p("div",E,[F,o("input",Q({id:"workspace-select-input"},e.$attrs,{type:"search",placeholder:"Filter Workspaces","aria-label":"Filter Workspaces"}),null,16),o("ul",null,[(n(!0),p(j,null,D(l.workspaces,r=>(n(),p("li",{key:r.id,class:X({active:r.name===l.selectedWorkspace}),onClick:u=>e.$emit("selected",r.name)},[f(m,{title:r.name,"background-color":r.meta&&r.meta.color,icon:r.meta&&r.meta.thumbnail},null,8,["title","background-color","icon"])],10,_))),128))])])}const v={name:"RolesModal",components:{WorkspaceSelector:W(T,[["render",A]]),MultiChecklist:pe},mixins:[Y,Z],props:{isVisible:{type:Boolean,default:!1},modalTitle:{type:String,default:"Workspace Access"},modalProceedText:{type:String,default:"Add Roles"},hasAlertText:{type:Boolean,default:!1},selectedRoles:{type:Array,default:()=>[]},multiWorkspace:{type:Boolean,default:!1},workspace:{type:String,default:""}},emits:["confirm","cancel"],data(){return{workspaceFilter:"",rolesFilter:"",errorMessage:"",selectedWorkspace:null,workspaceRoles:[],roleChanges:{},added:{},deleted:{},isRoleNotChanged:!0,machine:ee({id:"rolesModalMachine",initial:"idle",states:{idle:{on:{FETCH:"pending",REJECT:"error"}},pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{FETCH:"pending"}},empty:{on:{FETCH:"pending"}},error:{on:{FETCH:"pending"}}}})}},computed:{...b(te,{workspaces:e=>e.workspaces.sort(se("name")).filter(s=>s.name==="default").concat(e.workspaces.filter(s=>s.name!=="default"))}),...b(le,{perms:"permissions"}),filteredWorkspaces(){return this.workspaces.filter(e=>this.$rbac.isAllowed(this.perms,[{path:"/rbac/roles",actions:["read"]}],e.name)&&(this.multiWorkspace?e.name.toLowerCase().includes(this.workspaceFilter.toLowerCase()):e.name.toLowerCase().includes(this.workspace.toLowerCase())))},filteredRoles(){return this.workspaceRoles.filter(e=>{const s=this.rolesFilter,{name:l,comment:c}=e;return l.toLowerCase().includes(s.toLowerCase())||c&&c.toLowerCase().includes(s.toLowerCase())})},filteredSelectedRoles(){const e=this.selectedRoles.find(s=>s.workspace===this.selectedWorkspace);return e&&e.roles||[]},emptyRolesText(){return this.workspaceRoles.length?"No matching roles":"There are no roles in this workspace"}},beforeMount(){this.selectedWorkspace=this.workspace||this.workspaces[0].name,this.fetchWorkspaceRoles()},methods:{rolesChangesAreEmpty(){for(const e in this.roleChanges)if(this.roleChanges[e].added.length>0||this.roleChanges[e].deleted.length>0){this.isRoleNotChanged=!1;return}this.isRoleNotChanged=!0},fetchWorkspaceRoles(){this.transition("FETCH"),this.$api.getAllRoles(this.selectedWorkspace).then(e=>{this.workspaceRoles=e.data,this.transition("RESOLVE")}).catch(this.handleError)},handleWorkspaceSelect(e){this.selectedWorkspace=e,this.fetchWorkspaceRoles()},handleRoleChange(e){const s=Array.from(e.added),l=Array.from(e.deleted),c={added:s,deleted:l};this.roleChanges[this.selectedWorkspace]||(this.roleChanges[this.selectedWorkspace]={added:[],deleted:[]}),this.roleChanges[this.selectedWorkspace].added=c.added,this.roleChanges[this.selectedWorkspace].deleted=c.deleted,this.added[this.selectedWorkspace]=new Set(this.roleChanges[this.selectedWorkspace].added),this.deleted[this.selectedWorkspace]=new Set(this.roleChanges[this.selectedWorkspace].deleted),this.rolesChangesAreEmpty()},comparator(e,s){const l=c=>s===c.name;return e.some(l)},isCheckedReducer(e,s,l,c){const t=i=>e===i.name,a=Array.from(s).some(t),m=Array.from(c).some(t),r=Array.from(l).some(t),u=this.roleChanges[this.selectedWorkspace]&&this.roleChanges[this.selectedWorkspace].added;return u&&u.some(i=>i.name===e)?!0:a&&!r||m},confirmRoles(){const e=this.roleChanges;this.roleChanges={},this.added={},this.deleted={},this.$emit("confirm",e)},handleError(e){this.transition("REJECT",{errorMessage:ae(e)})},async cancel(){this.$emit("cancel")}}},C=e=>(ne("data-v-7e837bc1"),e=e(),ie(),e),x={class:"row workspace-roles-selector"},M={class:"col-12 col-lg-4 mb-0 form-group"},L={class:"col-12 col-lg-8 mb-0 form-group"},V=C(()=>o("label",null,"Select Role(s):",-1)),$={class:"select-box role-select"},N=C(()=>o("label",{for:"role-select-input",class:"sr-only"}," Filter Roles ",-1)),H={key:2,class:"empty-list d-flex flex-column"},B=R(" Add a role "),J={key:3,class:"empty-list"},K=C(()=>o("strong",null,"There was an error:",-1)),P=C(()=>o("br",null,null,-1)),I={key:4,class:"empty-list"},O=R(" Cancel ");function U(e,s,l,c,t,a){const m=d("KAlert"),r=d("WorkspaceSelector"),u=d("MultiChecklist"),i=d("KButton"),q=d("KSkeleton"),z=d("KPrompt");return n(),w(z,{"is-visible":l.isVisible,title:l.modalTitle,class:"roles-modal","tabbable-options":e.tabbableOptions,onCanceled:a.cancel},{"body-content":h(()=>[o("div",null,[l.hasAlertText?(n(),w(m,{key:0,appearance:"info",class:"mb-4"},{alertMessage:h(()=>[oe(e.$slots,"modalAlertMessage",{},void 0,!0)]),_:3})):k("",!0),o("div",x,[o("div",M,[o("label",null,y(l.multiWorkspace?"Select":"")+" Workspace:",1),f(r,{modelValue:t.workspaceFilter,"onUpdate:modelValue":s[0]||(s[0]=g=>t.workspaceFilter=g),"selected-workspace":t.selectedWorkspace,workspaces:a.filteredWorkspaces,onInput:s[1]||(s[1]=g=>t.workspaceFilter=g.target.value),onSelected:a.handleWorkspaceSelect},null,8,["modelValue","selected-workspace","workspaces","onSelected"])]),o("div",L,[V,o("div",$,[N,t.workspaceRoles.length>1?re((n(),p("input",{key:0,id:"role-select-input","onUpdate:modelValue":s[2]||(s[2]=g=>t.rolesFilter=g),type:"search",placeholder:"Filter Roles","aria-label":"Filter Roles"},null,512)),[[ce,t.rolesFilter]]):k("",!0),e.currentState==="success"&&a.filteredRoles.length?(n(),w(u,{key:null,prefix:t.selectedWorkspace,options:a.filteredRoles,added:t.added[t.selectedWorkspace],deleted:t.deleted[t.selectedWorkspace],selected:a.filteredSelectedRoles,"is-checked-reducer":a.isCheckedReducer,comparator:a.comparator,"use-option":"",class:"role-select-role-list",onChangedSelection:a.handleRoleChange},null,8,["prefix","options","added","deleted","selected","is-checked-reducer","comparator","onChangedSelection"])):e.currentState==="success"&&!a.filteredRoles.length?(n(),p("div",H,[o("div",null,y(a.emptyRolesText),1),t.workspaceRoles.length===0?(n(),w(i,{key:0,to:{name:"teams-create-role",params:{workspace:t.selectedWorkspace}},rel:"noopener",target:"_blank",appearance:"outline",class:"mt-4"},{default:h(()=>[B]),_:1},8,["to"])):k("",!0)])):k("",!0),e.currentState==="error"?(n(),p("div",J,[o("p",null,[K,P,R(" "+y(t.errorMessage),1)])])):k("",!0),e.currentState==="pending"?(n(),p("div",I,[f(q,{type:"spinner"})])):k("",!0)])])])])]),"action-buttons":h(()=>[f(i,{onClick:a.cancel},{default:h(()=>[O]),_:1},8,["onClick"]),f(i,{disabled:t.isRoleNotChanged,appearance:"primary",onClick:a.confirmRoles},{default:h(()=>[R(y(l.modalProceedText),1)]),_:1},8,["disabled","onClick"])]),_:3},8,["is-visible","title","tabbable-options","onCanceled"])}S=W(v,[["render",U],["__scopeId","data-v-7e837bc1"]])});export{S as R,ke as __tla};
