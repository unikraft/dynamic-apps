/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{z as h,J as b,u as F,a0 as u,D as g,a1 as m,a2 as _,__tla as k}from"./index.84d84090.3_3_0_0.js";import{E as S,__tla as T}from"./EntityButton.1838e0e9.3_3_0_0.js";import{E as x,__tla as v}from"./EntityFilter.bf4158bc.3_3_0_0.js";let p,w=Promise.all([(()=>{try{return k}catch{}})(),(()=>{try{return T}catch{}})(),(()=>{try{return v}catch{}})()]).then(async()=>{function y(e){return e.fields.reduce((t,l)=>(l.fields&&l.fields.forEach(i=>{t[i.model]=i}),l.model&&(t[l.model]=l),t),{})}function c(e){return Array.isArray(e.default)||e.default!=null&&typeof e.default!="object"&&e.default!=="function"}function f(e,t){return e.inputType==="hidden"?"":e.label||_(t)}p={components:{EntityButton:S,EntityFilter:x},computed:{...h(b,["workspace"]),...h(F,{perms:"permissions"}),entityId(){return this.$route&&this.$route.query&&this.$route.query.entity_id}},methods:{scrollToBottom(){this.$nextTick(()=>{window.scrollTo({top:document.body.clientHeight-window.innerHeight,left:0,behavior:"smooth"})})},getBlacklist(){return["created_at","updated_at","id"]},parseSchema(e,t){let l={};(e||this.schema)&&(l=e||(this.schema.fields?this.schema.fields:this.schema));const i=this.getBlacklist().concat(this.schema?this.schema.blacklist:[]),a=Object.keys(l).filter(n=>!i.includes(n)),s=a.indexOf("comparator");s>-1&&a.splice(s,1);const r={fields:[]},d={};return a.forEach(n=>{this.buildFormSchema(l[n],n,l,d,r,t)}),r.fields.sort((n,o)=>(n.order=n.order||0,o.order=o.order||0,n.order-o.order)),{schema:r,model:d,options:{noneSelectedText:"Nothing Selected...",helpAsHtml:!0}}},buildFormSchema(e,t,l,i,a,s){const r=c(e);return i[t]=r?e.default:null,e.id=t,e.model=t,e.fields&&e.type==="record"?this.handleFieldRecord(e,t,l,i,a,s):(l[t]=e,this.fieldSchemaHandler(e,i),s&&s[t]&&this.mergeFrontendSchema(l[t],s[t]),a.fields.push(e)),l},mergeFrontendSchema(e,t){return t&&(Object.assign(e,t),t.label&&(e.label=t.label)),e},unsetNullForeignKey(e,t){["service.id","route.id","consumer.id"].indexOf(e)>-1&&t[e]===null&&(delete t[e],t[e.replace(".id","")]=null)},fieldSchemaHandler(e,t){switch(this.handleCustomFields(e,t),e.type){case"foreign":this.handleFieldForeign(e,t);break;case"number":this.handleFieldNumber(e),e.attributes={step:"any"};break;case"integer":this.handleFieldNumber(e);break;case"string":this.handleFieldString(e);break;case"set":this.handleFieldSet(e);break;case"boolean":this.handleFieldBoolean(e);break;case"map":this.handleFieldMap(e);break}e.label=f(e,e.model)},handleFieldForeign(e,t){e.type="input",e.inputType="hidden",e.styleClasses="d-none";const l=this.entityId&&this.entityId.split(",")[0]||this.$route.params.id;t[e.model]=l?{id:l}:null},handleFieldNumber(e){e.type="input",e.inputType="number",e.between&&e.between.length===2&&(e.min=e.between[0],e.max=e.between[1])},handleFieldString(e){Object.prototype.hasOwnProperty.call(e,"one_of")?(e.type="select",e.values=e.one_of,e.selectOptions={hideNoneSelectedText:!0}):(e.type="input",e.inputType="text")},handleFieldSet(e){e.type="input",e.inputType="text",e.valueType="array",e.valueArrayType="string"},handleFieldBoolean(e){e.type="checkbox",e.default=!0,e.required=!1},handleFieldMap(e){if(e.type="object-advanced",e.values.type==="array"){const{type:t}=e.values.elements||{};e.schema={fields:[{schema:{fields:[{...u,model:e.model,valueArrayType:t==="integer"?"number":t||"string",inputAttributes:{...u.inputAttributes,type:t==="integer"?"number":"text",inputMode:t==="integer"?"numeric":"text"}}]}}]}}else e.values.fields&&(e.schema={fields:[{type:"object",model:"object",schema:{fields:e.values.fields.map(t=>{const l=Object.keys(t)[0];return{model:l,type:"input",label:g(l),placeholder:l,inputType:t[l].type}})}}]})},handleFieldRecord(e,t,l,i,a,s){e.fields.forEach(r=>{Object.keys(r).forEach(d=>{const n=r[d];l=this.buildFormSchema(n,t+"-"+d,l,i,a,s)})})},handleCustomFields(e,t){if(!m.includes(e.model))return;const l=y(e);m.forEach(i=>{Object.keys(l).forEach(a=>{const s=c(l[a]);t[a]=s?l[a].default:null}),delete t[i]})}}}});export{p as E,w as __tla};
