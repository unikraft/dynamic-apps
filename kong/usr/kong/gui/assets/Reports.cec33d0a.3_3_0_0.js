/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{C as S,_ as ne,D as ie,H as ue,S as oe,M as de,B as v,ak as w,aP as ce,Z as me,r as o,c as pe,b as _,w as T,a as d,l as k,h as x,g as ve,o as E,t as be,aF as he,y as ye,d as W,__tla as Se}from"./index.84d84090.3_3_0_0.js";import{T as _e,__tla as ge}from"./TimeFramePicker.465b75eb.3_3_0_0.js";import{u as fe,__tla as Ee}from"./StateMachine.4e8149cb.3_3_0_0.js";import{o as Te}from"./ExtendedTimeFrames.6fe12cf6.3_3_0_0.js";import{__tla as ke}from"./monaco-editor.90904fcf.3_3_0_0.js";let X,H,O,L,P,F,Fe=Promise.all([(()=>{try{return Se}catch{}})(),(()=>{try{return ge}catch{}})(),(()=>{try{return Ee}catch{}})(),(()=>{try{return ke}catch{}})()]).then(async()=>{let j,K,M,D,$,B,U,J,q,z,A,G,N,Z;j=t=>{const a=S(()=>`kong-${`${t.entity.value}${t.entityId.value==="all"?"s":"-"+t.entityId.value}`}-export-${new Date().toISOString()}.csv`),r=S(()=>{if(!t.data.value)return"";const e=t.headers.value.map(b=>b.key),c=t.data.value.map(b=>e.map(m=>b[m]));let g="data:application/csv;charset=utf-8,";return g+=e.join`,`+`
`,g+=c.join`\n`,encodeURI(g)});return{csvFilename:a,csvContent:r}},F=t=>ie(t.replace(/_/g," ")),K=t=>he(t)?t.split("-")[0].trim():t,L=(t=[])=>[{label:"Time",key:"id"},...t.map(a=>({label:F(a),key:a}))],H=(t=[],a)=>[{label:F(a+"_id"),key:"id"},...t.map(r=>({label:F(r),key:r}))],O=t=>Object.keys(t).map(a=>({...t[a],id:a})),P=t=>Object.keys(t).map(a=>({...t[a],id:new Date(a*1e3).toISOString()})).reverse(),M={name:"VitalsReports",components:{PageHeader:ue,TimeFramePicker:_e,SupportText:oe},setup(){const{currentState:t,transition:a}=fe(de({id:"refetchMachine",initial:"pending",states:{pending:{on:{RESOLVE:"success",REJECT:"error"}},success:{on:{REFETCH:"pending"}},error:{on:{REFETCH:"pending"}}}})),r=v({}),e=S(()=>{const s=Math.trunc(Date.now()/1e3);return Math.floor(s/r.value.stepSize)*r.value.stepSize-r.value.timeFrameLength}),c=v("weeks");w(c,()=>{a("REFETCH")});const g=[{interval:"seconds",duration:1},{interval:"minutes",duration:1*60},{interval:"hours",duration:1*60*60},{interval:"days",duration:1*60*60*24},{interval:"weeks",duration:1*60*60*24*7}],b=1500,m=S(()=>g.filter(s=>r.value.timeFrameLength/s.duration<b).map(s=>s.interval).reverse()),V=(s,i)=>{s==="timeFrame"&&r.value.timeFrameLength!==i.timeFrameLength&&(c.value=m.value[0],a("REFETCH"),r.value=i)},u="all",p={id:u,label:u},n=v(u),f=S(()=>n.value===u),h=v([p]);w(n,()=>{f.value||(c.value=m.value[0],a("REFETCH"))});const y=v("consumer");w(y,()=>{n.value=u,a("REFETCH")});const l=v(null),R=v([]),I=v([]),ee=S(()=>f.value?{start_ts:e.value}:{start_ts:e.value,entity_id:n.value,interval:c.value??m.value[0]}),ae=ye("api");ce(()=>{!r.value.timeFrameLength||ae.getVitals(`reports/${y.value}`,ee.value,null).then(s=>s.data).then(s=>{const i=s&&s.stats,Q=s&&s.meta&&s.meta.stat_labels;i&&Object.keys(i).length?(a("RESOLVE"),f.value?(h.value=[p,...Object.keys(i).map(C=>({id:C,label:i[C].app_name||i[C].name||K(C)}))],R.value=H(Q,y.value),I.value=O(i)):(R.value=L(Q),I.value=P(i))):(a("REJECT"),l.value="No data in this timeframe",n.value=u,h.value=[p])}).catch(s=>{a("REJECT"),l.value=ve(s),n.value=u,h.value=[p]})});const{csvFilename:te,csvContent:le}=j({entity:y,entityId:n,headers:R,data:I}),se=me(),re=S(()=>se.info.configuration.vitals_strategy==="influxdb");return{csvContent:le,csvFilename:te,currentState:t,errorMessage:l,intervals:m,isAllScope:f,isInfluxStrategy:re,scopes:h,selectedInterval:c,selectedReport:y,selectedScope:n,headers:R,data:I,timeFrameOptions:Te,updateTimeframe:V,breadcrumbs:[{key:"vitals",text:"Vitals",to:{path:"/vitals"}}],reports:[{name:"consumer",label:"Consumer Requests"},{name:"service",label:"Gateway Service Requests"},{name:"hostname",label:"Cluster Latency"}]}}},D=W(" Export "),$={class:"form-group"},B=d("label",null,"Report Type",-1),U={class:"row"},J={class:"col form-group"},q=d("label",null,"Scope",-1),z={class:"col form-group"},A=d("label",null,"Interval",-1),G=W(" Press the Export button above to see more than 5 rows "),N=d("h5",{class:"mb-0"}," InfluxDB is disabled ",-1),Z={class:"mb-0"};function Y(t,a,r,e,c,g){const b=o("KBreadcrumbs"),m=o("TimeFramePicker"),V=o("KButton"),u=o("PageHeader"),p=o("KSelect"),n=o("KTable"),f=o("SupportText"),h=o("KEmptyState"),y=o("KSkeleton");return E(),pe("div",null,[_(b,{items:e.breadcrumbs},null,8,["items"]),_(u,null,{default:T(()=>[_(m,{"show-utc":!1,"is-disabled":!e.isInfluxStrategy,"update-controls":e.updateTimeframe,options:e.timeFrameOptions},null,8,["is-disabled","update-controls","options"]),_(V,{disabled:e.currentState.value!=="success",href:e.currentState.value==="success"&&e.csvContent,download:e.csvFilename,appearance:"primary",to:"download",class:"ml-2 mb-2"},{default:T(()=>[D]),_:1},8,["disabled","href","download"])]),_:1}),d("div",$,[B,_(p,{id:"selectedReport",modelValue:e.selectedReport,"onUpdate:modelValue":a[0]||(a[0]=l=>e.selectedReport=l),disabled:!e.isInfluxStrategy,appearance:"select",width:"100%",items:e.reports.map(l=>({value:l.name,label:l.label}))},null,8,["modelValue","disabled","items"])]),d("div",U,[d("div",J,[q,_(p,{id:"selectedScope",modelValue:e.selectedScope,"onUpdate:modelValue":a[1]||(a[1]=l=>e.selectedScope=l),disabled:!e.isInfluxStrategy,appearance:"select",width:"100%",items:e.scopes.map(l=>({value:l.id,label:l.label}))},null,8,["modelValue","disabled","items"])]),d("div",z,[A,_(p,{id:"selectedInterval",modelValue:e.selectedInterval,"onUpdate:modelValue":a[2]||(a[2]=l=>e.selectedInterval=l),disabled:e.isAllScope,appearance:"select",width:"100%",items:e.intervals.map(l=>({value:l,label:l}))},null,8,["modelValue","disabled","items"])])]),e.currentState.value==="success"?(E(),k(n,{key:0,headers:e.headers,fetcher:()=>({data:e.data.slice(0,5)}),"disable-pagination":!0},null,8,["headers","fetcher"])):x("",!0),e.currentState.value==="success"&&e.data.length>5?(E(),k(f,{key:1,class:"mt-2"},{default:T(()=>[G]),_:1})):x("",!0),e.isInfluxStrategy?e.currentState.value==="error"?(E(),k(h,{key:3,"cta-is-hidden":"","is-error":""},{message:T(()=>[d("h5",Z,be(e.errorMessage),1)]),_:1})):x("",!0):(E(),k(h,{key:2,"cta-is-hidden":"","is-error":""},{message:T(()=>[N]),_:1})),e.currentState.value==="pending"?(E(),k(y,{key:4,type:"table"})):x("",!0)])}X=ne(M,[["render",Y]])});export{Fe as __tla,X as default,H as entityHeaders,O as entityStatsToTable,L as timeseriesHeaders,P as timeseriesStatsToTable,F as uppercaseHeader};
