/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as x,r as f,o as r,l as v,w as _,a as l,h as s,H as dt,N as st,M as nt,z as ct,Q as mt,Y as pt,aF as ut,m as ht,n as ft,aJ as bt,a8 as w,g as gt,c as d,b as m,E,d as p,t as n,k as h,aK as y,aL as M,V as S,aM as Et,R as k,U as T,p as yt,e as vt,__tla as _t}from"./index.84d84090.3_3_0_0.js";import{C as kt,__tla as Mt}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{E as Ct,__tla as St}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{F as Tt,__tla as Dt}from"./FormActions.1911524f.3_3_0_0.js";import{F as xt,__tla as wt}from"./FormPage.4b74a91a.3_3_0_0.js";import{E as $t,__tla as It}from"./EntityMixin.2764673d.3_3_0_0.js";import{s as Rt}from"./Service.872611d7.3_3_0_0.js";import{R as Vt}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as Lt}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as Ot}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as Ut}from"./EntityFilter.bf4158bc.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";let $,Ft=Promise.all([(()=>{try{return _t}catch{}})(),(()=>{try{return Mt}catch{}})(),(()=>{try{return St}catch{}})(),(()=>{try{return Dt}catch{}})(),(()=>{try{return wt}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Ot}catch{}})(),(()=>{try{return Ut}catch{}})()]).then(async()=>{const I={name:"ServiceFormHelpTooltip",props:{helpText:{type:String,default:null}}},R=l("div",{tabindex:"0",role:"button",class:"help"},[l("i",{class:"icon"})],-1),V=["innerHTML"];function L(i,o,c,g,e,a){const C=f("KTooltip");return c.helpText?(r(),v(C,{key:0,"max-width":"300",placement:"top"},{content:_(()=>[l("div",{innerHTML:c.helpText},null,8,V)]),default:_(()=>[R]),_:1})):s("",!0)}const O=x(I,[["render",L]]),U={name:"ServiceForm",components:{PageHeader:dt,FormActions:Tt,ConfirmModalDialog:kt,EntityDeleteModal:Ct,FormHelpTooltip:O},mixins:[xt,st,$t,Vt],i18nOptions:{namespaces:["Service"],keyPrefix:"form"},props:{hideServiceName:{type:Boolean,default:!1},hideBreadcrumbs:{type:Boolean,required:!1,default:!1},hidePageTitle:{type:Boolean,required:!1,default:!1},hideSubmit:{type:Boolean,required:!1,default:!1},redirectRouteNames:{type:Object,default:()=>({})},redirectOnSubmit:{type:Boolean,required:!1,default:!0}},emits:["model-updated","clicked-submit"],data(){const i=this.parseSchema(Rt),o=this.buildFieldSchema(i.schema.fields),c=this.$route.params.id?"edit":"create";return{formType:c,resourceEndpoint:"services",isOpen:!1,checkedGroup:"url",updatable:!1,errorText:null,schema:o,originalModel:{...i.model},formModel:i.model,machine:nt({id:"serviceMachine",initial:c,states:{edit:{initial:"idle",states:{idle:{on:{FETCH:"pending",CLICK_SUBMIT:"confirmSubmit",CLICK_DELETE:"confirmDelete"}},pending:{on:{RESOLVE:"idle",REJECT:"error"}},submitting:{on:{RESOLVE:"idle",REJECT:"error"}},deleting:{on:{RESOLVE:"idle",REJECT:"error"}},error:{on:{CLICK_SUBMIT:"confirmSubmit",CLICK_DELETE:"confirm"}},success:{type:"final"},confirmSubmit:{on:{CLICK_CONFIRM:"submitting",CANCEL:"idle",REJECT:"error"}},confirmDelete:{on:{CLICK_CONFIRM:"deleting",CANCEL:"idle",REJECT:"error"}}}},create:{initial:"idle",states:{idle:{on:{CLICK_SUBMIT:"submitting"}},submitting:{on:{RESOLVE:"success",REJECT:"error",REDIRECT:"redirecting"}},redirecting:{on:{RESOLVE:"success",REJECT:"error"}},success:{type:"final"},error:{type:"final"}}}}})}},computed:{...ct(mt,{getSupportDocs:"entityDoc"}),formRef(){return this.$refs.serviceForm},docsLink(){return this.getSupportDocs("service")},id(){return this.$route.params.id},buttonText(){const i={idle:this.isEditing?"Save":"Create",confirmSubmit:"Update Gateway Service",confirmDelete:"Delete Gateway Service",pending:"Loading...",submitting:"Submitting...",deleting:"Deleting..."};return i[this.currentState]||i.idle},disabled(){return["pending","submitting","deleting","redirecting"].includes(this.currentState)},isEditing(){return!!this.id},title(){if(!this.isEditing)return this.$t("createService");let i=pt(this.originalModel,"services");return i?(ut(i)&&(i=i.split("-")[0].trim()),this.$t("editServiceWithName",{name:i})):this.$t("editService")},openClass(){return this.isOpen||this.isEditing?"open":"closed"},advancedFieldsTitle(){return`${this.isOpen?"Hide":"View"} ${this.schema.advanced.fields.length} Advanced Fields`},isAllowedToDelete(){return this.$rbac.isAllowed(this.perms,[{path:`/${this.resourceEndpoint}/${this.id||"*"}`,actions:["delete"]}],this.workspace)},isAllowedToCreate(){return this.$rbac.isAllowed(this.perms,[{path:`/${this.resourceEndpoint}`,actions:["create"]}],this.workspace)},isAllowedToUpdate(){return this.$rbac.isAllowed(this.perms,[{path:`/${this.resourceEndpoint}/${this.id||"*"}`,actions:["update"]}],this.workspace)},setPathAllowed(){return!["tcp","tls","grpc","grpcs"].includes(this.formModel.protocol)},deleteModalModel(){return["confirmDelete","deleting"].includes(this.currentState)?{record:this.originalModel}:null},fieldInputDisabled(){return this.isEditing?!this.isAllowedToUpdate:!this.isAllowedToCreate}},watch:{formModel:{handler:function(){this.updatable=this.compareModels(this.formModel,this.originalModel),Object.keys(this.formModel).forEach(i=>{this.formModel[i]===""&&(this.formModel[i]=null)}),this.$emit("model-updated",this.formModel)},deep:!0}},mounted(){this.isEditing?this.fetchService():this.transition("RESOLVE")},methods:{...ht(ft,["notify"]),handleAdvancedClick(){this.isOpen=!this.isOpen},compareModels(i,o){return JSON.stringify(i)===JSON.stringify(o)},buildFieldSchema(i){return i.reduce((o,c)=>({...o,[c.model]:c}),{})},fetchService(){this.transition("FETCH"),this.$api.findRecord("services",this.id).then(i=>{this.transition("RESOLVE");const o=i.data;o.client_certificate=o.client_certificate&&o.client_certificate.id,delete o.created_at,this.formModel=o,this.originalModel={...o}}).catch(this.handleError)},confirm(){!this.$refs.serviceForm.reportValidity()||(this.transition("CLICK_SUBMIT"),this.isEditing||this.submit())},confirmDelete(){this.transition("CLICK_DELETE")},getEntityRedirectRoute(i,o){return this.redirectPath?{path:this.redirectPath}:{path:`/${this.resourceEndpoint}/${o.id}`}},submit(){const i={...this.formModel},o=this.redirectPath||this.$route.params.returnLink||this.getEntityRedirectRoute,c=this.isEditing?"updated":"created";if(this.isEditing||(this.checkedGroup==="url"?(delete i.protocol,delete i.host,delete i.path):this.checkedGroup!=="url"&&delete i.url),this.setPathAllowed||(i.path=null),i.client_certificate&&(i.client_certificate={id:i.client_certificate}),i.ca_certificates&&typeof i.ca_certificates=="string"&&(i.ca_certificates=i.ca_certificates.split(",").map(g=>g.trim())),i.tags&&typeof i.tags=="string"&&(i.tags=i.tags.split(",").map(g=>g.trim())),this.transition("CLICK_CONFIRM"),this.hideSubmit)return this.$emit("clicked-submit",{data:i,submitAction:this.onFormSubmit});this.onFormSubmit(i,o).then(g=>this.handleSuccess(c,g)).catch(g=>this.handleError(g))},onDismissModal(){this.transition("CANCEL")},handleCancel(){this.redirectPath?this.$router.push({path:this.redirectPath}):this.$router.go(-1)},handleSuccess(i,o){const c=bt(["name","id"],[o,this.originalModel,this.formModel]);w.trackEvent(w.EVENTS.SERVICE_ADDED),this.transition(this.isEditing?"RESOLVE":"REDIRECT"),this.notify({message:`Gateway Service ${c} is successfully ${i}!`,type:"success"})},handleError(i){this.transition("REJECT",{errorText:gt(i)}),this.scrollToBottom()}}},F=i=>(yt("data-v-4004d545"),i=i(),vt(),i),A={key:2,ref:"serviceForm",class:"service-form vue-form-generator"},G={key:0,class:"mb-4 top-border bottom-border"},K={key:1,class:"form-group"},B={for:"name"},N=["disabled"],P={class:"mb-4 text-sm"},q={class:"font-bold mb-2"},H={style:{color:"var(--black-45)"}},J={class:"mb-4 semiOptional-group-check"},j={key:0,class:"option"},z={class:"form-group mb-0"},Q={class:"form-check-label"},W=["disabled"],Y=p(" Using URL "),X={class:"form-group"},Z={for:"url"},ee=["disabled"],te={class:"option"},ie={key:0,class:"form-group mb-0"},le={"data-testid":"service-protocol-label",class:"form-check-label"},ae=["disabled"],oe=p(" Using protocol, host and path "),re={key:1,class:"option-field"},de={class:"form-group"},se={for:"protocol"},ne=["name","required"],ce=["label"],me=["value"],pe={class:"form-group"},ue={for:"host"},he=["disabled"],fe={key:0,class:"form-group"},be={for:"path"},ge=["disabled"],Ee={class:"form-group"},ye={for:"port"},ve=F(()=>l("small",null,"Optional",-1)),_e=["disabled"],ke={class:"form-group"},Me={for:"tags"},Ce={key:0},Se=["disabled"],Te={key:0,class:"hint"},De={class:"advanced-field-dropdown-wrapper","data-testid":"advanced-field-dropdown-wrapper"},xe={class:"material-icons"},we=["for"],$e={key:0},Ie=["id","onUpdate:modelValue","disabled"],Re={key:0,class:"hint"},Ve=["for"],Le={key:0},Oe=["id"],Ue={class:"field-checkbox"},Fe=["id","onUpdate:modelValue"],Ae=["for"],Ge={class:"field-checkbox"},Ke=["id","onUpdate:modelValue"],Be=["for"],Ne={class:"field-checkbox"},Pe=["id","onUpdate:modelValue"],qe=["for"],He=["for"],Je={key:0},je=["id","onUpdate:modelValue","disabled","onInput"],ze={key:0,class:"hint"},Qe={key:2,class:"form-buttons mt-4","data-testid":"form-footer-actions"},We=p(" Cancel "),Ye=p(" Delete ");function Xe(i,o,c,g,e,a){const C=f("KExternalLink"),Ze=f("FormActions"),et=f("PageHeader"),tt=f("KSkeleton"),it=f("KInputSwitch"),b=f("FormHelpTooltip"),lt=f("KAlert"),at=f("EntityButton"),D=f("KButton"),ot=f("ConfirmModalDialog"),rt=f("EntityDeleteModal");return r(),d("section",{class:S([{"edit-form":a.isEditing},"form-container"])},[c.hidePageTitle?s("",!0):(r(),v(et,{key:0,title:a.title},{default:_(()=>[m(C,{href:a.docsLink},{default:_(()=>[p(n(i.$t("Global:viewDoc")),1)]),_:1},8,["href"]),a.isEditing?(r(),v(Ze,{key:0,"primary-disabled":a.isEditing?e.updatable:a.disabled,onSave:a.confirm,onCancel:a.handleCancel},null,8,["primary-disabled","onSave","onCancel"])):s("",!0)]),_:1},8,["title"])),i.currentState==="pending"?(r(),v(tt,{key:1,type:"form"})):(r(),d("form",A,[a.isEditing?(r(),d("div",G,[m(it,E(e.schema.enabled,{modelValue:e.formModel.enabled,"onUpdate:modelValue":o[0]||(o[0]=t=>e.formModel.enabled=t),"enabled-icon":!1,label:`This Gateway Service is ${e.formModel.enabled?"enabled":"disabled"}`,class:"service-enable-switch"}),null,16,["modelValue","label"])])):s("",!0),c.hideServiceName?s("",!0):(r(),d("div",K,[l("label",B,[p(n(e.schema.name.label)+" ",1),m(b,{"help-text":e.schema.name.help},null,8,["help-text"])]),h(l("input",E(e.schema.name,{id:"name","onUpdate:modelValue":o[1]||(o[1]=t=>e.formModel.name=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,N),[[y,e.formModel.name]])])),l("div",P,[l("div",q,n(i.$t("serviceEndpoint")),1),l("div",H,n(i.$t("serviceEndpointDesc")),1)]),l("div",J,[a.isEditing?s("",!0):(r(),d("div",j,[l("div",z,[l("label",Q,[h(l("input",{"onUpdate:modelValue":o[2]||(o[2]=t=>e.checkedGroup=t),disabled:a.fieldInputDisabled,checkedGroup:"url",type:"radio",value:"url",class:"k-input"},null,8,W),[[M,e.checkedGroup]]),Y])]),e.checkedGroup==="url"?(r(),d("div",{key:0,class:S([e.checkedGroup==="url"?"mb-4":"mb-0","option-field"])},[l("div",X,[l("label",Z,[p(n(e.schema.url.label)+" ",1),m(b,{"help-text":e.schema.url.help},null,8,["help-text"])]),h(l("input",E(e.schema.url,{id:"url","onUpdate:modelValue":o[3]||(o[3]=t=>e.formModel.url=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,ee),[[y,e.formModel.url]])])],2)):s("",!0)])),l("div",te,[a.isEditing?s("",!0):(r(),d("div",ie,[l("label",le,[h(l("input",{"onUpdate:modelValue":o[4]||(o[4]=t=>e.checkedGroup=t),disabled:a.fieldInputDisabled,checkedGroup:"protocol",type:"radio",value:"protocol",class:"k-input"},null,8,ae),[[M,e.checkedGroup]]),oe])])),e.checkedGroup==="protocol"||a.isEditing?(r(),d("div",re,[l("div",de,[l("label",se,[p(n(e.schema.protocol.label)+" ",1),m(b,{"help-text":e.schema.protocol.help},null,8,["help-text"])]),h(l("select",{id:"protocol","onUpdate:modelValue":o[5]||(o[5]=t=>e.formModel.protocol=t),name:e.schema.protocol.name,required:e.schema.protocol.required,class:"form-control"},[(r(!0),d(k,null,T(e.schema.protocol.values,t=>(r(),d("optgroup",{key:t.label,label:t.label},[(r(!0),d(k,null,T(t.value,u=>(r(),d("option",{key:u.id,value:u.id},n(u.name),9,me))),128))],8,ce))),128))],8,ne),[[Et,e.formModel.protocol]])]),l("div",pe,[l("label",ue,[p(n(e.schema.host.label)+" ",1),m(b,{"help-text":e.schema.host.help},null,8,["help-text"])]),h(l("input",E(e.schema.host,{id:"host","onUpdate:modelValue":o[6]||(o[6]=t=>e.formModel.host=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,he),[[y,e.formModel.host]])]),a.setPathAllowed?(r(),d("div",fe,[l("label",be,[p(n(e.schema.path.label)+" ",1),m(b,{"help-text":e.schema.path.help},null,8,["help-text"])]),h(l("input",E(e.schema.path,{id:"path","onUpdate:modelValue":o[7]||(o[7]=t=>e.formModel.path=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,ge),[[y,e.formModel.path]])])):s("",!0),l("div",Ee,[l("label",ye,[p(n(e.schema.port.label)+" ",1),m(b,{"help-text":e.schema.port.help},null,8,["help-text"]),ve]),h(l("input",E(e.schema.port,{id:"port","onUpdate:modelValue":o[8]||(o[8]=t=>e.formModel.port=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,_e),[[y,e.formModel.port,void 0,{number:!0}]])])])):s("",!0)])]),l("div",ke,[l("label",Me,[p(n(e.schema.tags.label)+" ",1),m(b,{"help-text":e.schema.tags.help},null,8,["help-text"]),e.schema.tags.required?s("",!0):(r(),d("small",Ce,"Optional"))]),h(l("input",E(e.schema.tags,{id:"tags","onUpdate:modelValue":o[9]||(o[9]=t=>e.formModel.tags=t),disabled:a.fieldInputDisabled,class:"form-control"}),null,16,Se),[[y,e.formModel.tags]]),e.schema.tags.hint?(r(),d("p",Te,n(e.schema.tags.hint),1)):s("",!0)]),l("div",De,[a.isEditing?s("",!0):(r(),d("button",{key:0,type:"button",class:"advanced-field-title non-visual-button",onClick:o[10]||(o[10]=(...t)=>a.handleAdvancedClick&&a.handleAdvancedClick(...t))},[l("i",xe,n(e.isOpen?"keyboard_arrow_up":"keyboard_arrow_right"),1),l("span",null,n(a.advancedFieldsTitle),1)])),l("div",{ref:"advancedFields",class:S([a.openClass,"advanced-field-dropdown"])},[(r(!0),d(k,null,T(e.schema.advanced.fields,t=>(r(),d("div",{key:t.model,class:"form-group"},[t.model==="ca_certificates"?(r(),d(k,{key:0},[l("label",{for:t.model},[p(n(t.label)+" ",1),m(b,{"help-text":t.help},null,8,["help-text"]),t.required?s("",!0):(r(),d("small",$e,"Optional"))],8,we),h(l("input",E(t,{id:t.model,"onUpdate:modelValue":u=>e.formModel[t.model]=u,disabled:a.fieldInputDisabled,class:"form-control"}),null,16,Ie),[[y,e.formModel[t.model]]]),t.hint?(r(),d("p",Re,n(t.hint),1)):s("",!0)],64)):t.model==="tls_verify"?(r(),d(k,{key:1},[l("label",{for:t.model},[p(n(t.label)+" ",1),m(b,{"help-text":t.help},null,8,["help-text"]),t.required?s("",!0):(r(),d("small",Le,"Optional"))],8,Ve),l("div",{id:t.model,class:"form-group"},[l("div",Ue,[h(l("input",{id:`${t.model}_default`,"onUpdate:modelValue":u=>e.formModel[t.model]=u,type:"radio",value:null},null,8,Fe),[[M,e.formModel[t.model]]]),l("label",{for:`${t.model}_default`}," Use default system setting ",8,Ae)]),l("div",Ge,[h(l("input",{id:`${t.model}_on`,"onUpdate:modelValue":u=>e.formModel[t.model]=u,type:"radio",value:!0},null,8,Ke),[[M,e.formModel[t.model]]]),l("label",{for:`${t.model}_on`}," On ",8,Be)]),l("div",Ne,[h(l("input",{id:`${t.model}_off`,"onUpdate:modelValue":u=>e.formModel[t.model]=u,type:"radio",value:!1},null,8,Pe),[[M,e.formModel[t.model]]]),l("label",{for:`${t.model}_off`}," Off ",8,qe)])],8,Oe)],64)):(r(),d(k,{key:2},[l("label",{for:t.model},[p(n(t.label)+" ",1),m(b,{"help-text":t.help},null,8,["help-text"]),t.required?s("",!0):(r(),d("small",Je,"Optional"))],8,He),h(l("input",E(t,{id:t.model,"onUpdate:modelValue":u=>e.formModel[t.model]=u,disabled:a.fieldInputDisabled,class:"form-control",onInput:u=>t.type==="number"&&(e.formModel[t.model]=parseFloat(e.formModel[t.model]))}),null,16,je),[[y,e.formModel[t.model]]]),t.hint?(r(),d("p",ze,n(t.hint),1)):s("",!0)],64))]))),128))],2)]),c.hideSubmit?s("",!0):(r(),d("div",Qe,[e.errorText&&i.currentState==="error"?(r(),v(lt,{key:0,"alert-message":e.errorText,class:"my-4",appearance:"danger"},null,8,["alert-message"])):s("",!0),m(at,{workspace:i.workspace,"restricted-actions":[a.isEditing?"update":"create"],entity:`${e.resourceEndpoint}${a.isEditing?`/${a.id}`:""}`,text:a.isEditing?"Save":a.buttonText,"button-props":{disabled:a.isEditing?e.updatable:a.disabled,appearance:"primary",class:"mr-2"},"is-loading":i.currentState==="submitting"&&!a.isEditing,onClick:a.confirm},null,8,["workspace","restricted-actions","entity","text","button-props","is-loading","onClick"]),m(D,{"data-testid":"form-footer-action-cancel",type:"button",appearance:"outline",onClick:a.handleCancel},{default:_(()=>[We]),_:1},8,["onClick"]),a.isEditing&&a.isAllowedToDelete?(r(),v(D,{key:1,type:"button",class:"float-right",appearance:"danger",onClick:a.confirmDelete},{default:_(()=>[Ye]),_:1},8,["onClick"])):s("",!0)]))],512)),m(ot,{visible:a.isEditing&&["confirmSubmit","submitting"].includes(i.currentState),"proceed-text":a.buttonText,disabled:a.disabled,"is-loading":i.currentState==="submitting","entity-name":"service",text:"Are you sure you want to update the Gateway Service?",title:"Update Gateway Service",class:"update-confirmation",action:"primary",onOk:a.submit,onCancel:a.onDismissModal},null,8,["visible","proceed-text","disabled","is-loading","onOk","onCancel"]),m(rt,{"model-value":a.deleteModalModel,"redirect-route":{name:"services"},disabled:a.disabled,loading:i.currentState==="deleting",entity:"services","entity-name":"Gateway Service",class:"defaultModal",onDelete:o[11]||(o[11]=t=>i.transition("CLICK_CONFIRM")),onAfterDelete:o[12]||(o[12]=t=>i.transition("RESOLVE")),onError:a.handleError,onDismiss:a.onDismissModal},null,8,["model-value","disabled","loading","onError","onDismiss"])],2)}$=x(U,[["render",Xe],["__scopeId","data-v-4004d545"]])});export{Ft as __tla,$ as default};
