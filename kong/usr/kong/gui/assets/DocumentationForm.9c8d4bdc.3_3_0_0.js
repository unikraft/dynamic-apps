/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as E,H as U,z as D,Q as M,m as q,n as R,a4 as A,r as o,c as G,b as n,w as l,o as L,a as r,t as N,d as T,p as k,e as H,__tla as I}from"./index.84d84090.3_3_0_0.js";import{N as V,__tla as C}from"./NativeEntityForm.f002aa47.3_3_0_0.js";import{F as j,__tla as z}from"./FormPage.4b74a91a.3_3_0_0.js";import{R as B}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as K}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as O}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{__tla as Q}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{__tla as W}from"./EntityMixin.2764673d.3_3_0_0.js";import{__tla as Y}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as J}from"./EntityFilter.bf4158bc.3_3_0_0.js";let u,X=Promise.all([(()=>{try{return I}catch{}})(),(()=>{try{return C}catch{}})(),(()=>{try{return z}catch{}})(),(()=>{try{return K}catch{}})(),(()=>{try{return O}catch{}})(),(()=>{try{return Q}catch{}})(),(()=>{try{return W}catch{}})(),(()=>{try{return Y}catch{}})(),(()=>{try{return J}catch{}})()]).then(async()=>{const h={fields:[{"service-id":{label:"Gateway Service",placeholder:"Select a Gateway Service",type:"AutoSuggest",valueType:"object-expand",required:!0,entity:"services",inputValues:{fields:["name","id"]}}},{path:{label:"Document Spec Path",placeholder:"Select a spec from Portal",type:"AutoSuggest",valueType:"string",required:!0,entity:"files?type=spec",returnKey:"path",inputValues:{fields:["path"]}}}]},m={name:"DocumentationForm",components:{NativeEntityForm:V,PageHeader:U},mixins:[j,B],emits:["error"],data(){const e=this.$route.params.fields;return{serviceId:this.$route&&this.$route.query&&this.$route.query.entity_id&&this.$route.query.entity_id.split(",")[0],fields:e||{},originalModel:null,schema:h,file:{name:null,text:null}}},computed:{...D(M,{portalDocs:"docsPortal"}),documentDocsUrl(){return`${this.portalDocs.url}/applications/managing-applications/#add-a-document-to-your-service`},id(){return this.$route.params.id},resourceEndpoint(){return"document_objects"},title(){return this.$route.query.replace?"Replace document in Gateway Service":"Add document to Gateway Service"},returnLink(){return this.redirectPath?this.redirectPath:this.serviceId?`/services/${this.serviceId}`:"/services"},displayName(){return this.file.name||"No File Chosen"},buttonText(){return this.$route.query.replace?"Replace":"Add"}},watch:{"file.text"(){if(!this.file.name||!this.file.text)return;const e="specs/"+this.file.name;this.$api.createRecord("files",{path:e,contents:this.file.text}).then(()=>{this.notify({message:`Documentation ${this.file.name} uploaded. Adding to Gateway Service`,type:"success"}),this.createRecord({service:{id:this.serviceId},path:e})}).catch(t=>{this.errorHandler(t),this.resetFileUpload()})}},methods:{...q(R,["notify"]),createRecord(e){return this.$api.createRecord(this.resourceEndpoint,e).then(t=>{this.redirectPath||this.returnLink?this.$router.push({path:this.redirectPath||this.returnLink}):A(this.$router,201,{name:"services"})(t)})},handleModelUpdate(e,t){this.originalModel=t},loadFile(e){const t=e.target.files[0];if(!t)return;if(t.size>1024**2){this.$emit("error","File is too large. Pick a file smaller than 1MB."),this.resetFileUpload();return}this.file={name:t.name,...t};const c=this,i=new FileReader;i.addEventListener("load",()=>{c.file.text=i.result},!1),i.readAsText(t)},resetFileUpload(){this.file={name:"",text:null}},errorHandler(e){e.message.includes("409")&&(e="There is already a documention with this name."),this.notify({message:e,type:"danger"})}}},s=e=>(k("data-v-8615db88"),e=e(),H(),e),p={class:"route-form form-container"},f=T(" View documentation "),_={class:"mb-6"},y=s(()=>r("label",{class:"upload-label"}," Or upload a new spec instead... (Max 1MB)",-1)),g={class:"file-upload form-control"},v=s(()=>r("i",{class:"material-icons"},"attach_file",-1)),b={class:"text-muted truncate"},x=s(()=>r("span",{class:"hint"},"Uploading a new spec will expose this spec on Portal and add it to this Gateway Service",-1));function w(e,t,c,i,d,a){const F=o("KExternalLink"),$=o("PageHeader"),P=o("NativeEntityForm");return L(),G("section",p,[n($,{title:a.title},{default:l(()=>[n(F,{href:a.documentDocsUrl},{default:l(()=>[f]),_:1},8,["href"])]),_:1},8,["title"]),n(P,{"is-editing":e.isEditing,"show-confirmation-dialog":e.isEditing,"prevent-submission-before-change":e.isEditing,schema:d.schema,fields:d.fields,"button-text":a.buttonText,"on-load":e.onFormLoad,"on-submit":e.onFormSubmit,"on-delete":e.onDeleteWhenEditing,"resource-endpoint":a.resourceEndpoint,"entity-name":"Documentation",onModelUpdated:a.handleModelUpdate},{afterFormContainer:l(()=>[r("div",_,[y,r("label",g,[v,r("input",{type:"file",onChange:t[0]||(t[0]=(...S)=>a.loadFile&&a.loadFile(...S))},null,32),r("span",b,N(a.displayName),1)]),x])]),_:1},8,["is-editing","show-confirmation-dialog","prevent-submission-before-change","schema","fields","button-text","on-load","on-submit","on-delete","resource-endpoint","onModelUpdated"])])}u=E(m,[["render",w],["__scopeId","data-v-8615db88"]])});export{X as __tla,u as default};
