/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as te,aw as ea,B as g,C as h,ak as de,ax as Ie,r as R,o as I,c as F,b as w,O as me,ay as r,w as i,d as z,t as S,h as Y,k as pe,ah as fe,l as J,a as M,R as Se,U as ve,i as ta,G as ne,az as Ke,aA as Ue,aB as aa,n as oa,q as ra,y as sa,aD as na,__tla as la}from"./index.84d84090.3_3_0_0.js";import{a as ia,u as ua,b as ye,__tla as ca}from"./useRbacPermission.15766885.3_3_0_0.js";import{u as da,__tla as ma}from"./useRedirect.ccdc1330.3_3_0_0.js";import{__tla as pa}from"./monaco-editor.90904fcf.3_3_0_0.js";let Ne,fa=Promise.all([(()=>{try{return la}catch{}})(),(()=>{try{return ca}catch{}})(),(()=>{try{return ma}catch{}})(),(()=>{try{return pa}catch{}})()]).then(async()=>{const Oe={list:{table_headers:{username:"Username",custom_id:"Custom ID",tags:"Tags",id:"ID"},empty_state:{title:"Configure a New Consumer",description:"Consumers are the end users of a service.",title_for_consumer_group:"Configure a New Consumer"},toolbar_actions:{new_consumer:"New Consumer"}},title:"Consumers",search:{placeholder:"Filter by exact username or ID"},actions:{add_consumer:"Add Consumer",create:"New Consumer",copy_id:"Copy ID",copy_json:"Copy JSON",edit:"Edit",delete:"Delete",remove:"Remove",view:"View Details"},delete:{title:"Delete a Consumer",description:"Deleting this consumer will also remove this consumer from any associated consumer group. This action cannot be reversed."},consumer_groups:{add:{title:"Add Consumers",ctaText:"Add consumers to this group",consumers_label:"Consumers",consumer_placeholder:"Add consumer",footer:"Search by exact name or ID to find consumers not included in the list"},remove:{title:"Remove a Consumer",confirmation:"Are you sure you want to remove this consumer {consumer} from consumer group {consumerGroup}?",confirmationNoCG:"Are you sure you want to remove this consumer {consumer} from this consumer group?",description:"Removing this consumer from the group could change the rate limit policy applied to this consumer."}},errors:{general:"Consumers could not be retrieved",delete:"The consumer could not be deleted at this time.",copy:"Failed to copy to clipboard",add:"Some consumers could not be added at this time.",already_added:"This consumer has already been added to the consumer group"},copy:{success:"Copied {val} to clipboard",success_brief:"Successfully copied to clipboard"},form:{title:"Consumer Identification",info:{title:"General Information",description:"General information will help identify and manage added consumer."},consumer_identification:{title:"Consumer Identification",description:"A consumer can have both unique username and unique custom ID or one of them."}},fields:{username:{label:"Username",placeholder:"Enter a unique username",tooltip:"The unique username of the Consumer. You must send either this field or `custom_id` with the request."},custom_id:{label:"Custom ID",placeholder:"Enter a unique custom ID",tooltip:"Field for storing an existing unique ID for the Consumer - useful for mapping Kong with users in your existing database. You must send either this field or `username` with the request."},tags:{label:"Tags",placeholder:"Enter a list of tags seperated by comma",help:"e.g. tag1, tag2. tag3",tooltip:"An optional set of strings associated with the Consumer for grouping and filtering."}}},je={consumers:Oe};function De(){const e=Ke("en-us",je);return{i18n:e,i18nT:Ue(e)}}const Te={useI18n:De},ae="/api/runtime_groups/{controlPlaneId}",oe="/{workspace}",ie={list:{konnect:{all:`${ae}/consumers`,forConsumerGroup:`${ae}/consumer_groups/{consumerGroupId}/consumers`,oneForConsumerGroup:`${ae}/consumer_groups/{consumerGroupId}/consumers/{consumerId}`},kongManager:{all:`${oe}/consumers`,forConsumerGroup:`${oe}/consumer_groups/{consumerGroupId}/consumers`,oneForConsumerGroup:`${oe}/consumer_groups/{consumerGroupId}/consumers/{consumerId}`}},form:{konnect:{validate:`${ae}/v1/schemas/json/consumer/validate`,create:`${ae}/consumers`,edit:`${ae}/consumers/{id}`},kongManager:{validate:`${oe}/schemas/consumers/validate`,create:`${oe}/consumers`,edit:`${oe}/consumers/{id}`}}};function ge(e={}){return{axiosInstance:aa.create({withCredentials:!0,timeout:3e4,...e})}}function Fe(e,s){const a=r(s),t=h(()=>e.apiBaseUrl.startsWith("/")?new URL(`${window.location.origin}${a}`):new URL(a));return t.value.search="",l=>`${t.value.href}/${l}`}const Le={message:"Are you sure you want to delete this {entityType}?",messageWithName:"Are you sure you want to delete this {entityType} {entityName}?"},He={actions:{save:"Save",cancel:"Cancel",back:"Back"},errors:{edit:"The entity could not be edited at this time."}},ze={emptyState:{noSearchResultsTitle:"No results found",noSearchResultsMessage:"Please adjust the criteria and try again.",noSearchResultsCtaText:"Clear"}},Je={filterButtonText:"Filter",fieldLabel:"Filter by:",inputPlaceholder:"Enter a value",selectPlaceholder:"Select an item",applyButtonText:"Apply",clearButtonText:"Clear",clearAllButtonText:"Clear all filters"},Qe={errors:{fetch:"Could not fetch available items",invalid:"Please select a valid value"}},We={unexpected:"An unexpected error has occurred"},Ye={enable:{title:"Enable {entityType}",message:"Are you sure you want to enable the {entityType} {entityName}?",confirmText:"Yes, enable"},disable:{title:"Disable {entityType}",message:"Are you sure you want to disable the {entityType} {entityName}?",confirmText:"Yes, disable"}},Xe={deleteModal:Le,baseForm:He,baseTable:ze,filter:Je,debouncedFilter:Qe,errors:We,toggleModal:Ye};function he(){const e=Ke("en-us",Xe);return{i18n:e,i18nT:Ue(e)}}function Ze(){const{i18n:{t:e}}=he();return{getMessageFromError:s=>{var a,t,l;if(!s)return e("errors.unexpected");if((a=s==null?void 0:s.response)!=null&&a.data){if(s.response.data.detail)return s.response.data.detail;if((t=s.response.data.details)!=null&&t.length)return s.response.data.details.map(o=>{let f=e("errors.unexpected");return o.messages&&typeof o.messages=="object"&&o.messages.length&&(f=o.messages.join(", ")),o.field?`${o.field} - ${f}`:f}).join("; ");if(s.response.data.message){const{message:o}=s.response.data;return Array.isArray(o)?(l=o[0])!=null&&l.constraints?Object.values(o[0].constraints)[0]:o[0]:o}if(typeof s.response.data=="string")return s.response.data;if(typeof s.response.data=="object")return Object.keys(s.response.data).map(o=>`${o} ${s.response.data[o]}`).join(", ")}return s.message||e("errors.unexpected")}}}function $e(e,s){const a=g(r(e)),t=g(r(s)),l=h(()=>!!(a.value.app==="konnect"||a.value.isExactMatch)),o=h(()=>t.value.startsWith("/")?new URL(`${window.location.origin}${t.value}`):new URL(t.value));return f=>{const{page:A,pageSize:y,offset:u,sortColumnKey:T,sortColumnOrder:b,query:E}=f;try{let x=new URL(o.value.href);return l.value&&E?(x.search="",x=new URL(`${x.href}/${E}/`)):(l.value||new URLSearchParams(E).forEach((q,d)=>{x.searchParams.append(d,q)}),T&&x.searchParams.append("sort_by",T),b==="desc"&&x.searchParams.append("sort_desc","1"),x.searchParams.append("size",String(y))),u&&A!==1&&x.searchParams.append("offset",String(u)),x.href}catch(x){return console.error("RouteList(fetcher)",x),t.value}}}function et(){return{debounce:(e,s)=>{let a;return(...t)=>{clearTimeout(a),a=window==null?void 0:window.setTimeout(()=>{e(...t)},s)}}}}const be="khcp-user-table-preferences",tt={pageSize:30,sortColumnKey:void 0,sortColumnOrder:void 0};function at(){const e=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(t){console.error("useTablePreferences(tryParseJson)",t);return}},s=()=>{const a=e(localStorage.getItem(be));return!a||!Object.keys(a).length?new Map:new Map(Object.entries(a))};return{setTablePreferences:(a,t)=>{try{const l=s();l.set(a,t),localStorage.setItem(be,JSON.stringify(Object.fromEntries(l.entries())))}catch(l){console.error("useTablePreferences(setTablePreferences)",l)}},getTablePreferences:a=>{const t=s();return(t==null?void 0:t.get(a))||void 0||tt},deleteAllTablePreferences:()=>{localStorage.removeItem(be)}}}function ot(e,s,a,t={fetchedItemsKey:"data",searchKeys:["id"]}){a||(a="100");const{axiosInstance:l}=ge({headers:e.requestHeaders}),{i18n:{t:o}}=he(),{debounce:f}=et(),A=f(async m=>{await v(m)},200),y=g(!1),u=g(""),T=g(""),b=g([]),E=g(void 0),x=r(s);let q=`${e.apiBaseUrl}${x}`;e.app==="konnect"?q=q.replace(/{controlPlaneId}/gi,(e==null?void 0:e.controlPlaneId)||""):e.app==="kongManager"&&(q=q.replace(/{workspace}/gi,(e==null?void 0:e.workspace)||""));const d=async()=>{try{y.value=!0;const{data:m}=await l.get(`${q}?size=${a}`);m!=null&&m.next||(E.value=t.fetchedItemsKey in m?m[t.fetchedItemsKey]:[]),b.value=t.fetchedItemsKey in m?m[t.fetchedItemsKey]:[]}catch{b.value=[],u.value=o("debouncedFilter.errors.fetch")}finally{y.value=!1}},p=g(""),v=async m=>{var G,V;if(p.value!==m)if(p.value=m||"",E.value===void 0)try{y.value=!0,u.value="",T.value="";let c=q+"";m&&(c+=`/${m}`);const{data:k}=await l.get(`${c}?size=${a}`);t.fetchedItemsKey in k?b.value=k[t.fetchedItemsKey]:k!=null&&k.id?b.value=[k]:b.value=[]}catch(c){((G=c==null?void 0:c.response)==null?void 0:G.status)===404?T.value=o("debouncedFilter.errors.invalid"):(b.value=[],u.value=o("debouncedFilter.errors.fetch"))}finally{y.value=!1}else y.value=!0,T.value="",m?(b.value=(V=E.value)==null?void 0:V.filter(c=>{var k;let C=!1;for(const j of t.searchKeys){const Q=typeof c[j]=="string"?(k=c[j])==null?void 0:k.toLowerCase():c[j];Q!=null&&Q.includes(m.toLowerCase())&&(C=!0)}return C}),(!b.value||!b.value.length)&&(T.value=o("debouncedFilter.errors.invalid"))):b.value=E.value,y.value=!1};return{loading:y,error:u,validationError:T,results:b,allRecords:E,loadItems:d,debouncedQueryChange:A}}var xe=(e=>(e.GatewayService="service",e.Route="route",e.Consumer="consumer",e.ConsumerGroup="consumer group",e.Plugin="plugin",e.Upstream="upstream",e.Certificate="certificate",e.CACertificate="ca certificate",e.SNI="SNI",e.Key="key",e.KeySet="key set",e.Vault="vault",e.Application="application",e.Developer="developer",e.acls="ACL Credential",e["basic-auth"]="Basic Auth Credential",e["key-auth"]="Key Auth Credential",e["key-auth-enc"]="Key Auth Encrypted Credential",e.oauth2="OAuth 2.0 Credential",e["hmac-auth"]="HMAC Credential",e.jwt="JWT Credential",e.Target="target",e))(xe||{}),X=(e=>(e[e.Loading=0]="Loading",e[e.Idle=1]="Idle",e[e.NoResults=2]="NoResults",e[e.Error=3]="Error",e))(X||{});function rt(e,s,a="data"){const t=r(s),{axiosInstance:l}=ge({headers:e.requestHeaders}),o=$e(e,t),f=g({status:X.Idle});return{fetcher:async A=>{try{f.value={status:X.Loading};const y=o(A),{data:u}=await l.get(y),T=a&&a.replace(/[^\w-_]/gi,"");let b;u[T]&&Array.isArray(u[T])?b=u[T]:b=Object.keys(u).length?[u]:[];const E={data:b,total:b.length,...u.offset?{pagination:{offset:u.offset}}:null};return f.value={status:X.Idle,response:E},E}catch(y){const u={data:[],total:0};return A.query&&y.response.status===404?(f.value={status:X.NoResults,response:u,error:y},u):(f.value={status:X.Error,response:u,error:y},u)}},fetcherState:f}}const ue={useAxios:ge,useDeleteUrlBuilder:Fe,useErrors:Ze,useFetchUrlBuilder:$e,useDebouncedFilter:ot,useFetcher:rt,useI18n:he},_e=(e,s)=>{const a=e.__vccOpts||e;for(const[t,l]of s)a[t]=l;return a},st={class:"toolbar-container"},nt={key:0,class:"toolbar-button-container"},lt=["data-testid"],it=te({__name:"EntityBaseTable",props:{tableHeaders:{type:Object,required:!0,default:()=>({})},fetcher:{type:Function,required:!0,default:async()=>({data:[],total:0})},initialFetcherParams:{type:Object,default:null},fetcherCacheKey:{type:Number,default:1},isLoading:{type:Boolean,default:!1},query:{type:String,default:""},enableClientSort:{type:Boolean,default:!1},enableEntityActions:{type:Boolean,default:!0},emptyStateOptions:{type:Object,default:()=>({})},errorMessage:{type:String,default:""},disablePaginationPageJump:{type:Boolean,default:void 0},disableSorting:{type:Boolean,default:void 0},paginationType:{type:String,default:void 0},cellAttributes:{type:Function,default:()=>({})},rowAttributes:{type:Function,default:()=>({})},preferencesStorageKey:{type:String,default:"",required:!0},dropdownMenuWidth:{type:String,default:"",required:!1}},emits:["click:row","sort","clear-search-input","empty-state-cta-clicked"],setup(e,{emit:s}){const a=e,{i18n:{t}}=ue.useI18n(),l=h(()=>{const d=[];return Object.keys(a.tableHeaders).forEach(p=>{const v=a.tableHeaders[p];d.push({label:v.label??p,key:p,sortable:v.sortable??!1})}),a.enableEntityActions&&d.push({key:"actions",hideLabel:!0}),d}),o=d=>({"data-rowid":d.id,"data-testid":d.name,...a.rowAttributes(d)}),f=d=>({"data-testid":d.headerKey,...a.cellAttributes(d)}),A=()=>{s("empty-state-cta-clicked"),y()},y=()=>{s("clear-search-input")},u=(d,p)=>{s("click:row",p)},T=d=>{s("sort",d)},{setTablePreferences:b,getTablePreferences:E}=at(),x=h(()=>{const d=E(a.preferencesStorageKey);return{...a.initialFetcherParams,...d}}),q=d=>{a.preferencesStorageKey&&b(a.preferencesStorageKey,d)};return(d,p)=>{const v=R("KIcon"),m=R("KButton"),G=R("KDropdownMenu"),V=R("KTable"),c=R("KCard");return I(),J(c,{class:"kong-ui-entity-base-table"},{body:i(()=>[w(V,{"cell-attrs":f,"disable-pagination-page-jump":e.disablePaginationPageJump,"disable-sorting":e.disableSorting,"empty-state-action-button-icon":e.query?"":"plus","empty-state-action-message":e.query?r(t)("baseTable.emptyState.noSearchResultsCtaText"):e.emptyStateOptions.ctaText,"empty-state-action-route":e.query?"":e.emptyStateOptions.ctaPath,"empty-state-icon":e.query?"stateNoSearchResults":"stateGruceo","empty-state-icon-size":"96","empty-state-message":e.query?r(t)("baseTable.emptyState.noSearchResultsMessage"):e.emptyStateOptions.message,"empty-state-title":e.query?r(t)("baseTable.emptyState.noSearchResultsTitle"):e.emptyStateOptions.title,"enable-client-sort":e.enableClientSort,"error-state-title":e.errorMessage,fetcher:e.fetcher,"fetcher-cache-key":String(e.fetcherCacheKey),"has-error":!!e.errorMessage,headers:r(l),"hide-pagination-when-optional":"","initial-fetcher-params":r(x),"is-loading":e.isLoading,"pagination-type":e.paginationType,"row-attrs":o,"search-input":e.query,onKtableEmptyStateCtaClicked:A,"onRow:click":u,onSort:T,"onUpdate:tablePreferences":q},me({toolbar:i(()=>[M("div",st,[ne(d.$slots,"toolbar-filter",{},void 0,!0),d.$slots["toolbar-button"]?(I(),F("div",nt,[ne(d.$slots,"toolbar-button",{},void 0,!0)])):Y("",!0)])]),actions:i(({row:k,rowKey:C,rowValue:j})=>[M("div",{class:"actions-container","data-testid":k.name},[w(G,{"kpop-attributes":{placement:"bottomEnd"},width:e.dropdownMenuWidth},{items:i(()=>[ne(d.$slots,"actions",{row:k,rowKey:C,rowValue:j},void 0,!0)]),default:i(()=>[w(m,{class:"non-visual-button","data-testid":"overflow-actions-button",size:"small"},{icon:i(()=>[w(v,{color:"var(--black-400, #3c4557)",icon:"more",size:"16"})]),_:1})]),_:2},1032,["width"])],8,lt)]),_:2},[ve(e.tableHeaders,(k,C)=>({name:C,fn:i(({row:j,rowKey:Q,rowValue:N})=>[ne(d.$slots,C,{row:j,rowKey:Q,rowValue:N},void 0,!0)])}))]),1032,["disable-pagination-page-jump","disable-sorting","empty-state-action-button-icon","empty-state-action-message","empty-state-action-route","empty-state-icon","empty-state-message","empty-state-title","enable-client-sort","error-state-title","fetcher","fetcher-cache-key","has-error","headers","initial-fetcher-params","is-loading","pagination-type","search-input"])]),_:3})}}}),ut=_e(it,[["__scopeId","data-v-6eab8cd1"]]),ct={key:0,class:"kong-ui-entity-delete-error"},dt={key:1,class:"description"},mt=te({__name:"EntityDeleteModal",props:{visible:{type:Boolean,required:!0,default:!1},title:{type:String,default:"Delete"},entityType:{type:String,required:!0},entityName:{type:String,default:""},needConfirm:{type:Boolean,default:!0},description:{type:String,default:""},actionPending:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["cancel","proceed"],setup(e,{emit:s}){const a=e,{i18nT:t}=ue.useI18n(),l=h(()=>a.needConfirm?a.entityName:""),o=()=>{s("cancel")},f=()=>{s("proceed")};return(A,y)=>{const u=R("KAlert"),T=R("KPrompt");return I(),J(T,{"action-button-text":"Yes, delete","action-pending":e.actionPending,class:"kong-ui-entity-delete-modal","confirmation-text":r(l),"is-visible":e.visible,title:e.title,type:"danger",onCanceled:o,onProceed:f},{"body-content":i(()=>[e.error?(I(),F("div",ct,[w(u,{appearance:"danger"},{alertMessage:i(()=>[z(S(e.error),1)]),_:1})])):Y("",!0),w(r(t),{class:"message",keypath:a.entityName?"deleteModal.messageWithName":"deleteModal.message",tag:"p"},me({entityType:i(()=>[z(S(a.entityType),1)]),_:2},[a.entityName?{name:"entityName",fn:i(()=>[M("strong",null,S(a.entityName),1)]),key:"0"}:void 0]),1032,["keypath"]),a.description||A.$slots.description?(I(),F("div",dt,[ne(A.$slots,"description",{},()=>[M("p",null,S(a.description),1)],!0)])):Y("",!0)]),_:3},8,["action-pending","confirmation-text","is-visible","title"])}}}),pt=_e(mt,[["__scopeId","data-v-3513e33b"]]),ft={fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},vt={id:"mask0_180_20349",height:"20",maskUnits:"userSpaceOnUse",style:{"mask-type":"alpha"},width:"20",x:"0",y:"0"},yt=["fill"],gt={mask:"url(#mask0_180_20349)"},ht=["fill"],bt=te({__name:"IconFilter",props:{color:{type:String,default:"var(--kong-ui-entity-filter-color, var(--blue-500, #1155cb))"}},setup(e){return(s,a)=>(I(),F("svg",ft,[M("mask",vt,[M("rect",{fill:e.color,height:"20",width:"20"},null,8,yt)]),M("g",gt,[M("path",{d:"M8 14.5V13H12V14.5H8ZM5 10.75V9.25H15V10.75H5ZM3 7V5.5H17V7H3Z",fill:e.color},null,8,ht)])]))}}),_t={key:1,class:"kong-ui-entity-filter"},kt={class:"menu-item-title"},Ct={class:"menu-item-indicator"},wt={class:"menu-item-body"},It=["for"],St={class:"menu-item-buttons"},Tt=te({__name:"EntityFilter",props:{config:{type:Object,required:!0,default:()=>({isExactMatch:!0,placeholder:""})},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:s}){const a=e,{i18n:{t}}=ue.useI18n(),l=g(!1),o=g({}),f=h(()=>{const p=[];return new URLSearchParams(a.modelValue).forEach((v,m)=>{v!==""&&p.push(m)}),p}),A=h(()=>{const p=a.config.fields;return Object.keys(p).filter(v=>p[v].searchable).map(v=>({label:p[v].label||v,value:v}))});de(()=>a.modelValue,p=>{o.value={},new URLSearchParams(p).forEach((v,m)=>{o.value[m]=v})});const y=()=>{l.value=!l.value},u=p=>{s("update:modelValue",p)},T=p=>`filter-${p}`,b=p=>{var v,m;return(((m=(v=a.config.schema)==null?void 0:v[p])==null?void 0:m.values)??[]).map(G=>({value:G,label:G}))},E=p=>{var v,m;return((m=(v=a.config.schema)==null?void 0:v[p])==null?void 0:m.type)??"text"},x=p=>{o.value={...o.value,[p]:""},d()},q=()=>{o.value={},d(!0)},d=(p=!1)=>{const v=Object.keys(o.value).reduce((m,G)=>(o.value[G]&&(m[G]=`${o.value[G]}`),m),{});p&&(l.value=!1),s("update:modelValue",new URLSearchParams(v).toString())};return(p,v)=>{const m=R("KInput"),G=R("KButton"),V=R("KSelect"),c=R("KMenuItem"),k=R("KMenu");return e.config.isExactMatch?(I(),J(m,{key:0,autocomplete:"off",class:"kong-ui-entity-filter-input","data-testid":"search-input","model-value":e.modelValue,placeholder:e.config.placeholder,"onUpdate:modelValue":u},{icon:i(()=>[w(bt)]),_:1},8,["model-value","placeholder"])):(I(),F("div",_t,[w(G,{appearance:"btn-link","data-testid":"filter-button",icon:"filter",onClick:y},{default:i(()=>[z(S(r(t)("filter.filterButtonText"))+" "+S(r(f).length>0?`(${r(f).length})`:""),1)]),_:1}),pe(M("div",{class:"kong-ui-entity-filter-backdrop",onClick:y},null,512),[[fe,l.value]]),pe(w(k,{class:"kong-ui-entity-filter-menu"},{body:i(()=>[(I(!0),F(Se,null,ve(r(A),(C,j)=>(I(),J(c,{key:C.value,"data-testid":C.value,expandable:"","last-menu-item":j===r(A).length-1},{itemTitle:i(()=>[M("span",kt,[z(S(C.label)+" ",1),pe(M("span",Ct,null,512),[[fe,r(f).includes(C.value)]])])]),itemBody:i(()=>{var Q,N;return[M("div",wt,[M("label",{class:"menu-item-label",for:T(C.value)},S(r(t)("filter.fieldLabel")),9,It),((N=(Q=e.config.schema)==null?void 0:Q[C.value])==null?void 0:N.type)==="select"?(I(),J(V,{key:0,id:T(C.value),modelValue:o.value[C.value],"onUpdate:modelValue":Z=>o.value[C.value]=Z,appearance:"select",items:b(C.value),placeholder:r(t)("filter.selectPlaceholder")},null,8,["id","modelValue","onUpdate:modelValue","items","placeholder"])):(I(),J(m,{key:1,id:T(C.value),modelValue:o.value[C.value],"onUpdate:modelValue":Z=>o.value[C.value]=Z,autocomplete:"off",placeholder:r(t)("filter.inputPlaceholder"),size:"small",type:E(C.value)},null,8,["id","modelValue","onUpdate:modelValue","placeholder","type"]))]),M("div",St,[w(G,{appearance:"btn-link","data-testid":"apply-filter",size:"small",onClick:v[0]||(v[0]=Z=>d(!0))},{default:i(()=>[z(S(r(t)("filter.applyButtonText")),1)]),_:1}),w(G,{appearance:"btn-link","data-testid":"clear-filter",size:"small",onClick:Z=>x(C.value)},{default:i(()=>[z(S(r(t)("filter.clearButtonText")),1)]),_:2},1032,["onClick"])])]}),_:2},1032,["data-testid","last-menu-item"]))),128))]),actionButton:i(()=>[w(G,{onClick:q},{default:i(()=>[z(S(r(t)("filter.clearAllButtonText")),1)]),_:1})]),_:1},512),[[fe,l.value]])]))}}}),$t=_e(Tt,[["__scopeId","data-v-fcf9a8f1"]]),ce=te({__name:"PermissionsWrapper",props:{authFunction:{type:Function,required:!0,default:async()=>!0},forceShow:{type:Boolean,default:!1}},setup(e){const s=e,a=g(void 0),t=h(()=>a.value===!0||a.value!==void 0&&s.forceShow===!0);return Ie(async()=>{a.value=await s.authFunction()}),(l,o)=>r(t)?ne(l.$slots,"default",{key:0,isAllowed:a.value}):Y("",!0)}}),{useAxios:Ge,useDeleteUrlBuilder:xt,useErrors:va,useFetchUrlBuilder:ya,useFetcher:Gt,useDebouncedFilter:Pt}=ue,Et={class:"add-consumer-form-container"},Mt={class:"mt-0"},At={class:"select-item-label"},Bt={key:0,class:"select-item-desc"},Rt={key:0,class:"kong-ui-entity-add-consumers-error"},qt={key:0},Vt=te({__name:"AddConsumerModal",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.consumerGroupId)},visible:{type:Boolean,required:!0,default:!1}},emits:["cancel","add:success","add:partial-success","error"],setup(e,{emit:s}){var a;const t=e,{i18n:{t:l}}=Te.useI18n(),{axiosInstance:o}=Ge({headers:(a=t.config)==null?void 0:a.requestHeaders}),f=g([]),{debouncedQueryChange:A,loading:y,allRecords:u,error:T,loadItems:b,results:E}=Pt(t.config,ie.list[t.config.app].all,"",{fetchedItemsKey:"data",searchKeys:["username","id"]}),x=$=>$,q=h(()=>T.value?l("consumers.errors.general"):""),d=g(0),p=h(()=>u.value===void 0),v=h(()=>E.value.map($=>({label:$.username||$.customId,value:$.id,selected:f.value.includes($.id),data:$}))),m=$=>{var K;const B=p.value?E.value.find(U=>U.id===$):(K=u.value)==null?void 0:K.find(U=>U.id===$);return B?B.username||B.custom_id:$},G=()=>{k.value="",V.value=[],N.value=[],s("cancel")},V=g([]),c=g(!1),k=g(""),C=async()=>{if(!f.value.length){k.value="",N.value=[],s("cancel");return}c.value=!0,k.value="",V.value=[],N.value=[];try{const $=f.value.map(U=>Q(U)),K=await Promise.allSettled($);let B=!0;K.forEach(U=>{U.status!=="fulfilled"&&(B=!1)}),B?(V.value=[],N.value=[],s("add:success",f.value),f.value=[]):(V.value.length&&s("add:partial-success",V.value),f.value=[],Z(K))}catch{k.value=l("consumers.errors.add"),s("error",k.value)}finally{c.value=!1}},j=h(()=>{var $,K,B,U;let O=`${t.config.apiBaseUrl}${ie.list[t.config.app].forConsumerGroup}`;return t.config.app==="konnect"?O=O.replace(/{controlPlaneId}/gi,(($=t.config)==null?void 0:$.controlPlaneId)||"").replace(/{consumerGroupId}/gi,((K=t.config)==null?void 0:K.consumerGroupId)||""):t.config.app==="kongManager"&&(O=O.replace(/{workspace}/gi,((B=t.config)==null?void 0:B.workspace)||"").replace(/{consumerGroupId}/gi,((U=t.config)==null?void 0:U.consumerGroupId)||"")),O}),Q=async $=>{const K={consumer:$};try{const B=await o.post(j.value,K);return V.value.push($),B}catch(B){let U=`${m($)} - ${B.message}`;return B.response.status===409&&(U=`${m($)} - ${l("consumers.errors.already_added")}`),Promise.reject(Error(U))}},N=g([]),Z=$=>{N.value=$.map(K=>{var B;return(B=K.reason)==null?void 0:B.message}).filter(Boolean)};return de(v,()=>{d.value++},{immediate:!0,deep:!0}),Ie(async()=>{await b()}),($,K)=>{const B=R("KMultiselect"),U=R("KAlert"),O=R("KPrompt");return I(),J(O,{"action-pending":c.value,class:"kong-ui-entities-add-consumers-modal","data-testid":"add-consumer-modal","is-visible":e.visible,title:r(l)("consumers.consumer_groups.add.title"),onCanceled:G,onProceed:C},{"body-content":i(()=>[M("div",Et,[M("p",Mt,S(r(l)("consumers.consumer_groups.add.ctaText")),1),w(B,{modelValue:f.value,"onUpdate:modelValue":K[0]||(K[0]=L=>f.value=L),autosuggest:"","data-testid":"add-consumers-multiselect","dropdown-footer-text":r(p)?r(l)("consumers.consumer_groups.add.footer"):void 0,items:r(v),label:r(l)("consumers.consumer_groups.add.consumers_label"),loading:r(y),placeholder:r(l)("consumers.consumer_groups.add.consumer_placeholder"),readonly:c.value,required:"",width:"100%",onQueryChange:r(A)},{"item-template":i(({item:L})=>[M("div",At,S(L.label),1),x(L).data.username&&x(L).data.custom_id?(I(),F("div",Bt,S(x(L).data.custom_id),1)):Y("",!0)]),_:1},8,["modelValue","dropdown-footer-text","items","label","loading","placeholder","readonly","onQueryChange"]),k.value||r(q)||N.value.length?(I(),F("div",Rt,[w(U,{appearance:"danger"},{alertMessage:i(()=>[M("p",null,S(r(l)("consumers.errors.add")),1),N.value.length?(I(),F("ul",qt,[(I(!0),F(Se,null,ve(N.value,(L,re)=>(I(),F("li",{key:re},S(L),1))),128))])):Y("",!0),M("div",null,S(k.value||r(q)),1)]),_:1})])):Y("",!0)])]),_:1},8,["action-pending","is-visible","title"])}}}),Pe=(e,s)=>{const a=e.__vccOpts||e;for(const[t,l]of s)a[t]=l;return a},Kt=Pe(Vt,[["__scopeId","data-v-3b59f40e"]]),Ut={class:"kong-ui-entities-consumers-list"},Nt={key:1},Ot=te({__name:"ConsumerList",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.createRoute||!e.getViewRoute||!e.getEditRoute||e.app==="kongManager"&&!e.isExactMatch&&!e.filterSchema)},canCreate:{type:Function,required:!1,default:async()=>!0},canDelete:{type:Function,required:!1,default:async()=>!0},canEdit:{type:Function,required:!1,default:async()=>!0},canRetrieve:{type:Function,required:!1,default:async()=>!0}},emits:["error","loading","copy:success","copy:error","delete:success","add:success","remove:success"],setup(e,{emit:s}){var a;const t=e,{i18nT:l,i18n:{t:o}}=Te.useI18n(),f=ea(),{axiosInstance:A}=Ge({headers:(a=t.config)==null?void 0:a.requestHeaders}),y=g(1),u=h(()=>!!t.config.consumerGroupId),T=h(()=>t.config.app!=="kongManager"||!!t.config.disableSorting),b={username:{label:o("consumers.list.table_headers.username"),searchable:!0,sortable:!0},custom_id:{label:o("consumers.list.table_headers.custom_id"),searchable:!0,sortable:!0},tags:{label:o("consumers.list.table_headers.tags"),sortable:!1}},E=b,x=n=>({"data-testid":n.username??n.custom_id??n.id}),q=h(()=>{var n,_,D,W;let H=`${t.config.apiBaseUrl}${ie.list[t.config.app][u.value?"forConsumerGroup":"all"]}`;return t.config.app==="konnect"?H=H.replace(/{controlPlaneId}/gi,((n=t.config)==null?void 0:n.controlPlaneId)||"").replace(/{consumerGroupId}/gi,((_=t.config)==null?void 0:_.consumerGroupId)||""):t.config.app==="kongManager"&&(H=H.replace(/{workspace}/gi,((D=t.config)==null?void 0:D.workspace)||"").replace(/{consumerGroupId}/gi,((W=t.config)==null?void 0:W.consumerGroupId)||"")),H}),d=g(""),p=h(()=>{const n=t.config.app==="konnect"||t.config.isExactMatch;return n?{isExactMatch:n,placeholder:o("consumers.search.placeholder")}:{isExactMatch:n,fields:{username:b.username,custom_id:b.custom_id},schema:t.config.filterSchema}}),v=h(()=>u.value?"consumers":void 0),{fetcher:m,fetcherState:G}=Gt(t.config,q.value,v.value),V=()=>{d.value=""},c=()=>{y.value++},k=n=>n??"-",C=g(""),j=h(()=>G.value.status===X.Loading),Q=h(()=>{var n;return G.value.status===X.Idle&&!!((n=G.value.response)!=null&&n.data.length)}),N=h(()=>!j.value&&(Q.value||!!d.value)),Z=(n,_)=>{const D=n.id;if(!_(D)){s("copy:error",{entity:n,field:"id",message:o("consumers.errors.copy")});return}s("copy:success",{entity:n,field:"id",message:o("consumers.copy.success",{val:D})})},$=(n,_)=>{const D=JSON.stringify(n);if(!_(D)){s("copy:error",{entity:n,message:o("consumers.errors.copy")});return}s("copy:success",{entity:n,message:o("consumers.copy.success_brief")})},K=async n=>{var _;await((_=t.canRetrieve)==null?void 0:_.call(t,n))&&f.push(t.config.getViewRoute(n.id))},B=n=>({label:o("consumers.actions.view"),to:t.config.getViewRoute(n)}),U=n=>({label:o("consumers.actions.edit"),to:t.config.getEditRoute(n)}),O=g(void 0),L=g(!1),re=g(!1),Ee=g(""),Dt=xt(t.config,q.value),Ft=n=>{O.value=n,L.value=!0},Lt=()=>{L.value=!1},Ht=async()=>{var n,_,D;if((n=O.value)!=null&&n.id){re.value=!0;try{await A.delete(Dt(O.value.id)),re.value=!1,L.value=!1,y.value++,s("delete:success",O.value)}catch(W){Ee.value=((D=(_=W.response)==null?void 0:_.data)==null?void 0:D.message)||W.message||o("consumers.errors.delete"),s("error",W)}finally{re.value=!1}}},ke=g(!1),Me=()=>{ke.value=!0},Ae=()=>{ke.value=!1},Be=(n,_)=>{_||Ae(),y.value++,s("add:success",n)},zt=()=>{u.value&&Me()},ee=g(void 0),Ce=g(!1),Jt=g(""),Qt=n=>{ee.value=n,Ce.value=!0},Re=()=>{Ce.value=!1,ee.value=void 0},Wt=h(()=>{var n,_,D,W;let H=`${t.config.apiBaseUrl}${ie.list[t.config.app].oneForConsumerGroup}`;return t.config.app==="konnect"?H=H.replace(/{controlPlaneId}/gi,((n=t.config)==null?void 0:n.controlPlaneId)||"").replace(/{consumerGroupId}/gi,((_=t.config)==null?void 0:_.consumerGroupId)||""):t.config.app==="kongManager"&&(H=H.replace(/{workspace}/gi,((D=t.config)==null?void 0:D.workspace)||"").replace(/{consumerGroupId}/gi,((W=t.config)==null?void 0:W.consumerGroupId)||"")),H}),qe=g(!1),Yt=async()=>{if(ee.value){qe.value=!0;try{const n=Wt.value.replace(/{consumerId}/gi,ee.value.id);await A.delete(n),s("remove:success",ee.value),Re(),y.value++}catch(n){Jt.value=n.message||o("consumers.errors.delete"),s("error",n)}finally{qe.value=!1}}};de(j,n=>{s("loading",n)},{immediate:!0}),de(G,n=>{if(n.status===X.Error){C.value=o("consumers.errors.general"),s("error",n.error);return}C.value=""});const we=g({ctaPath:u.value?void 0:t.config.createRoute,ctaText:void 0,message:o("consumers.list.empty_state.description"),title:o("consumers.title")});return Ie(async()=>{await t.canCreate()&&(we.value.title=u.value?o("consumers.list.empty_state.title_for_consumer_group"):o("consumers.list.empty_state.title"),we.value.ctaText=u.value?o("consumers.actions.add_consumer"):o("consumers.actions.create"))}),(n,_)=>{const D=R("KButton"),W=R("KBadge"),H=R("KTruncate"),le=R("KDropdownItem"),Ve=R("KClipboardProvider"),Xt=R("KPrompt");return I(),F("div",Ut,[w(r(ut),{"disable-pagination":r(u),"disable-pagination-page-jump":"","disable-sorting":r(T),"empty-state-options":we.value,"enable-entity-actions":"","error-message":C.value,fetcher:r(m),"fetcher-cache-key":y.value,"is-loading":r(j),"pagination-type":"offset","preferences-storage-key":"kong-ui-entities-consumers-list",query:d.value,"row-attributes":x,"table-headers":r(E),onClearSearchInput:V,"onClick:row":_[3]||(_[3]=P=>K(P)),onEmptyStateCtaClicked:zt,onSort:c},me({"toolbar-filter":i(()=>[r(u)?Y("",!0):pe((I(),J(r($t),{key:0,modelValue:d.value,"onUpdate:modelValue":_[0]||(_[0]=P=>d.value=P),config:r(p)},null,8,["modelValue","config"])),[[fe,r(N)]])]),username:i(({rowValue:P})=>[M("b",null,S(k(P)),1)]),custom_id:i(({rowValue:P})=>[z(S(k(P)),1)]),tags:i(({rowValue:P})=>[P&&P.length>0?(I(),J(H,{key:0},{default:i(()=>[(I(!0),F(Se,null,ve(P,se=>(I(),J(W,{key:se,onClick:_[2]||(_[2]=ta(()=>{},["stop"]))},{default:i(()=>[z(S(se),1)]),_:2},1024))),128))]),_:2},1024)):(I(),F("span",Nt,"-"))]),actions:i(({row:P})=>[w(Ve,null,{default:i(({copyToClipboard:se})=>[w(le,{"data-testid":"action-entity-copy-id",onClick:Zt=>Z(P,se)},{default:i(()=>[z(S(r(o)("consumers.actions.copy_id")),1)]),_:2},1032,["onClick"])]),_:2},1024),w(Ve,null,{default:i(({copyToClipboard:se})=>[w(le,{"data-testid":"action-entity-copy-json",onClick:Zt=>$(P,se)},{default:i(()=>[z(S(r(o)("consumers.actions.copy_json")),1)]),_:2},1032,["onClick"])]),_:2},1024),w(r(ce),{"auth-function":()=>e.canRetrieve(P)},{default:i(()=>[w(le,{"data-testid":"action-entity-view","has-divider":"",item:B(P.id)},null,8,["item"])]),_:2},1032,["auth-function"]),w(r(ce),{"auth-function":()=>e.canEdit(P)},{default:i(()=>[w(le,{"data-testid":"action-entity-edit",item:U(P.id)},null,8,["item"])]),_:2},1032,["auth-function"]),w(r(ce),{"auth-function":()=>e.canDelete(P)},{default:i(()=>[w(le,{"data-testid":"action-entity-delete","has-divider":"","is-dangerous":"",onClick:()=>e.config.consumerGroupId?Qt(P):Ft(P)},{default:i(()=>[z(S(e.config.consumerGroupId?r(o)("consumers.actions.remove"):r(o)("consumers.actions.delete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["auth-function"])]),_:2},[r(N)?{name:"toolbar-button",fn:i(()=>[w(r(ce),{"auth-function":()=>e.canCreate()},{default:i(()=>[w(D,{appearance:"primary","data-testid":"toolbar-add-consumer",icon:"plus",to:e.config.consumerGroupId?void 0:e.config.createRoute,onClick:_[1]||(_[1]=()=>e.config.consumerGroupId?Me():void 0)},{default:i(()=>[z(S(e.config.consumerGroupId?r(o)("consumers.actions.add_consumer"):r(o)("consumers.list.toolbar_actions.new_consumer")),1)]),_:1},8,["to"])]),_:1},8,["auth-function"])]),key:"0"}:void 0]),1032,["disable-pagination","disable-sorting","empty-state-options","error-message","fetcher","fetcher-cache-key","is-loading","query","table-headers"]),w(r(pt),{"action-pending":re.value,"data-testid":"delete-consumer-modal",description:r(o)("consumers.delete.description"),"entity-name":O.value&&(O.value.username||O.value.custom_id||O.value.id),"entity-type":r(xe).Consumer,error:Ee.value,title:r(o)("consumers.delete.title"),visible:L.value,onCancel:Lt,onProceed:Ht},null,8,["action-pending","description","entity-name","entity-type","error","title","visible"]),e.config.consumerGroupId?(I(),J(Kt,{key:0,config:e.config,"data-testid":"add-consumer-modal",visible:ke.value,"onAdd:partialSuccess":_[4]||(_[4]=P=>Be(P,!0)),"onAdd:success":_[5]||(_[5]=P=>Be(P)),onCancel:Ae},null,8,["config","visible"])):Y("",!0),e.config.consumerGroupId&&ee.value?(I(),J(Xt,{key:1,"data-testid":"remove-consumer-modal","is-visible":Ce.value,title:r(o)("consumers.consumer_groups.remove.title"),type:"danger",onCanceled:Re,onProceed:Yt},{"body-content":i(()=>[w(r(l),{class:"message mt-0",keypath:e.config.consumerGroupName?"consumers.consumer_groups.remove.confirmation":"consumers.consumer_groups.remove.confirmationNoCG",tag:"p"},me({consumer:i(()=>[M("strong",null,S(ee.value.username||ee.value.custom_id||ee.value.id),1)]),_:2},[e.config.consumerGroupName?{name:"consumerGroup",fn:i(()=>[M("strong",null,S(e.config.consumerGroupName),1)]),key:"0"}:void 0]),1032,["keypath"]),M("p",null,S(r(o)("consumers.consumer_groups.remove.description")),1)]),_:1},8,["is-visible","title"])):Y("",!0)])}}}),jt=Pe(Ot,[["__scopeId","data-v-af37c24e"]]);Ne=te({__name:"List",props:{consumerGroupId:{type:String,required:!1,default:""}},setup(e){const s=e,a=sa("rbac"),t=na(),{createRedirectRouteQuery:l}=da(),o=oa(),{onCopySuccess:f,onCopyError:A}=ia(),y=h(()=>t.name!=="consumers"),u=h(()=>y.value?`consumer_groups/${s.consumerGroupId}/consumers`:"consumers"),T=h(()=>({username:{type:"text"},custom_id:{type:"text"}})),b=h(()=>c=>({name:"show-consumer",params:{id:c},query:{...l()}})),E=h(()=>c=>({name:"update-consumer",params:{id:c},query:{...l()}})),x=ra({...ua(),consumerGroupId:s.consumerGroupId,createRoute:{name:"create-consumer"},getViewRoute:b,getEditRoute:E,filterSchema:T}),q=h(()=>()=>ye(a,{path:`${u.value}`,action:"create"})),d=h(()=>c=>ye(a,{path:`${u.value}/${c.id}`,action:"read"})),p=h(()=>c=>ye(a,{path:`${u.value}/${c.id}`,action:"update"})),v=h(()=>c=>ye(a,{path:`${u.value}/${c.id}`,action:"delete"})),m=c=>{const k=c.length;o.notify({message:`${k} ${k===1?"consumer":"consumers"} successfully added to group!`,type:"success"})},G=c=>{o.notify({message:`${c.username??c.custom_id??c.id} Consumer successfully deleted!`,type:"success"})},V=c=>{o.notify({message:`${c.username??c.custom_id??c.id} Consumer successfully removed from group!`,type:"success"})};return(c,k)=>(I(),J(r(jt),{config:x,"can-create":r(q),"can-delete":r(v),"can-edit":r(p),"can-retrieve":r(d),"onCopy:success":r(f),"onCopy:error":r(A),"onAdd:success":m,"onDelete:success":G,"onRemove:success":V},null,8,["config","can-create","can-delete","can-edit","can-retrieve","onCopy:success","onCopy:error"]))}})});export{fa as __tla,Ne as default};
