/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as G,aw as Bt,B as P,C as E,ak as fe,ax as Ce,r as $,o as v,c as V,b as g,O as ve,ay as s,w as l,d as A,t as I,k as le,ah as se,a as M,R as Y,U as Q,l as B,i as te,E as qt,G as X,h as ne,az as Te,aA as Se,aB as Nt,Z as Ut,Q as Lt,n as jt,aC as Fe,q as Ht,H as zt,y as Jt,aD as Wt,S as Gt,__tla as Qt}from"./index.84d84090.3_3_0_0.js";import{b as xe}from"./buildRoute.1ddadad0.3_3_0_0.js";import{u as Zt,a as Yt,b as ie,__tla as Xt}from"./useRbacPermission.15766885.3_3_0_0.js";import{u as ea,__tla as ta}from"./useRedirect.ccdc1330.3_3_0_0.js";import{__tla as aa}from"./monaco-editor.90904fcf.3_3_0_0.js";let Re,oa=Promise.all([(()=>{try{return Qt}catch{}})(),(()=>{try{return Xt}catch{}})(),(()=>{try{return ta}catch{}})(),(()=>{try{return aa}catch{}})()]).then(async()=>{const Ie={create:"New Route",copy_id:"Copy ID",copy_json:"Copy JSON",edit:"Edit",delete:"Delete",clear:"Clear",view:"View Details"},Pe={placeholder:"Filter by exact name or ID"},Ee={title:"Routes",list:{toolbar_actions:{new_route:"New Route"},table_headers:{name:"Name",protocols:"Protocols",hosts:"Hosts",methods:"Methods",paths:"Paths",expression:"Expression",id:"ID",tags:"Tags"},empty_state:{title:"Configure a New Route",description:"Routes proxy requests to an associated Service."}}},$e={general:"Routes could not be retrieved",delete:"The route could not be deleted at this time.",copy:"Failed to copy to clipboard"},Ae={success:"Copied {val} to clipboard",success_brief:"Successfully copied to clipboard"},Ve={actions:Ie,search:Pe,routes:Ee,delete:{title:"Delete a Route",description:"Deleting this route will also remove any associated plugins. This action cannot be reversed."},errors:$e,copy:Ae};function De(){const e=Te("en-us",Ve);return{i18n:e,i18nT:Se(e)}}const Me={useI18n:De},Ke={list:{konnect:{all:"/api/runtime_groups/{controlPlaneId}/routes",forGatewayService:"/api/runtime_groups/{controlPlaneId}/services/{serviceId}/routes"},kongManager:{all:"/{workspace}/routes",forGatewayService:"/{workspace}/services/{serviceId}/routes"}}},ge={GET:{color:"#0364AC",backgroundColor:"#F2F6FE"},DELETE:{color:"#922021",backgroundColor:"#FFDEDE"},POST:{color:"#13755E",backgroundColor:"#E8F8F5"},PATCH:{color:"#006E9D",backgroundColor:"#CDF1FE"},PUT:{color:"#A05604",backgroundColor:"#FFF3D8"},OPTIONS:{color:"#273C61",backgroundColor:"#DAE3F2"},HEAD:{color:"#A05604",backgroundColor:"#FFE6BA"},CONNECT:{color:"#473CFB",backgroundColor:"#D7D8FE"},TRACE:{color:"#FFFFFF",backgroundColor:"#5C7299"},DEFAULT:{color:"#FFFFFF",backgroundColor:"#5C7299"}},Oe=e=>ge[e]??ge.DEFAULT;function ce(e={}){return{axiosInstance:Nt.create({withCredentials:!0,timeout:3e4,...e})}}function Be(e,o){const a=s(o),t=E(()=>e.apiBaseUrl.startsWith("/")?new URL(`${window.location.origin}${a}`):new URL(a));return t.value.search="",r=>`${t.value.href}/${r}`}const qe={message:"Are you sure you want to delete this {entityType}?",messageWithName:"Are you sure you want to delete this {entityType} {entityName}?"},Ne={actions:{save:"Save",cancel:"Cancel",back:"Back"},errors:{edit:"The entity could not be edited at this time."}},Ue={emptyState:{noSearchResultsTitle:"No results found",noSearchResultsMessage:"Please adjust the criteria and try again.",noSearchResultsCtaText:"Clear"}},Le={filterButtonText:"Filter",fieldLabel:"Filter by:",inputPlaceholder:"Enter a value",selectPlaceholder:"Select an item",applyButtonText:"Apply",clearButtonText:"Clear",clearAllButtonText:"Clear all filters"},je={errors:{fetch:"Could not fetch available items",invalid:"Please select a valid value"}},He={unexpected:"An unexpected error has occurred"},ze={enable:{title:"Enable {entityType}",message:"Are you sure you want to enable the {entityType} {entityName}?",confirmText:"Yes, enable"},disable:{title:"Disable {entityType}",message:"Are you sure you want to disable the {entityType} {entityName}?",confirmText:"Yes, disable"}},Je={deleteModal:qe,baseForm:Ne,baseTable:Ue,filter:Le,debouncedFilter:je,errors:He,toggleModal:ze};function ue(){const e=Te("en-us",Je);return{i18n:e,i18nT:Se(e)}}function We(){const{i18n:{t:e}}=ue();return{getMessageFromError:o=>{var a,t,r;if(!o)return e("errors.unexpected");if((a=o==null?void 0:o.response)!=null&&a.data){if(o.response.data.detail)return o.response.data.detail;if((t=o.response.data.details)!=null&&t.length)return o.response.data.details.map(i=>{let w=e("errors.unexpected");return i.messages&&typeof i.messages=="object"&&i.messages.length&&(w=i.messages.join(", ")),i.field?`${i.field} - ${w}`:w}).join("; ");if(o.response.data.message){const{message:i}=o.response.data;return Array.isArray(i)?(r=i[0])!=null&&r.constraints?Object.values(i[0].constraints)[0]:i[0]:i}if(typeof o.response.data=="string")return o.response.data;if(typeof o.response.data=="object")return Object.keys(o.response.data).map(i=>`${i} ${o.response.data[i]}`).join(", ")}return o.message||e("errors.unexpected")}}}function me(e,o){const a=P(s(e)),t=P(s(o)),r=E(()=>!!(a.value.app==="konnect"||a.value.isExactMatch)),i=E(()=>t.value.startsWith("/")?new URL(`${window.location.origin}${t.value}`):new URL(t.value));return w=>{const{page:k,pageSize:T,offset:y,sortColumnKey:f,sortColumnOrder:S,query:R}=w;try{let h=new URL(i.value.href);return r.value&&R?(h.search="",h=new URL(`${h.href}/${R}/`)):(r.value||new URLSearchParams(R).forEach((q,c)=>{h.searchParams.append(c,q)}),f&&h.searchParams.append("sort_by",f),S==="desc"&&h.searchParams.append("sort_desc","1"),h.searchParams.append("size",String(T))),y&&k!==1&&h.searchParams.append("offset",String(y)),h.href}catch(h){return console.error("RouteList(fetcher)",h),t.value}}}function Ge(){return{debounce:(e,o)=>{let a;return(...t)=>{clearTimeout(a),a=window==null?void 0:window.setTimeout(()=>{e(...t)},o)}}}}const de="khcp-user-table-preferences",Qe={pageSize:30,sortColumnKey:void 0,sortColumnOrder:void 0};function Ze(){const e=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch(t){console.error("useTablePreferences(tryParseJson)",t);return}},o=()=>{const a=e(localStorage.getItem(de));return!a||!Object.keys(a).length?new Map:new Map(Object.entries(a))};return{setTablePreferences:(a,t)=>{try{const r=o();r.set(a,t),localStorage.setItem(de,JSON.stringify(Object.fromEntries(r.entries())))}catch(r){console.error("useTablePreferences(setTablePreferences)",r)}},getTablePreferences:a=>{const t=o();return(t==null?void 0:t.get(a))||void 0||Qe},deleteAllTablePreferences:()=>{localStorage.removeItem(de)}}}function Ye(e,o,a){a||(a="100");const{axiosInstance:t}=ce({headers:e.requestHeaders}),{i18n:{t:r}}=ue(),{debounce:i}=Ge(),w=i(async n=>{await p(n)},200),k=P(!1),T=P(""),y=P(""),f=P([]),S=P(void 0),R=s(o);let h=`${e.apiBaseUrl}${R}`;e.app==="konnect"?h=h.replace(/{controlPlaneId}/gi,(e==null?void 0:e.controlPlaneId)||""):e.app==="kongManager"&&(h=h.replace(/{workspace}/gi,(e==null?void 0:e.workspace)||""));const q=async()=>{try{k.value=!0;const{data:n}=await t.get(`${h}?size=${a}`);n!=null&&n.next||(S.value=n.data),n!=null&&n.data&&(f.value=n.data)}catch{f.value=[],T.value=r("debouncedFilter.errors.fetch")}finally{k.value=!1}},c=P(""),p=async n=>{var _,F;if(c.value!==n)if(c.value=n||"",S.value===void 0)try{k.value=!0,T.value="",y.value="";let D=h+"";n&&(D+=`/${n}`);const{data:K}=await t.get(`${D}?size=${a}`);K!=null&&K.data?f.value=K.data:K!=null&&K.id?f.value=[K]:f.value=[]}catch(D){((_=D==null?void 0:D.response)==null?void 0:_.status)===404?y.value=r("debouncedFilter.errors.invalid"):(f.value=[],T.value=r("debouncedFilter.errors.fetch"))}finally{k.value=!1}else k.value=!0,y.value="",n?(f.value=(F=S.value)==null?void 0:F.filter(D=>D.id.includes(n)),(!f.value||!f.value.length)&&(y.value=r("debouncedFilter.errors.invalid"))):f.value=S.value,k.value=!1};return{loading:k,error:T,validationError:y,results:f,allRecords:S,loadItems:q,debouncedQueryChange:w}}var he=(e=>(e.GatewayService="service",e.Route="route",e.Consumer="consumer",e.ConsumerGroup="consumer group",e.Plugin="plugin",e.Upstream="upstream",e.Certificate="certificate",e.CACertificate="ca certificate",e.SNI="SNI",e.Key="key",e.KeySet="key set",e.Vault="vault",e.Application="application",e.Developer="developer",e.acls="ACL Credential",e["basic-auth"]="Basic Auth Credential",e["key-auth"]="Key Auth Credential",e["key-auth-enc"]="Key Auth Encrypted Credential",e.oauth2="OAuth 2.0 Credential",e["hmac-auth"]="HMAC Credential",e.jwt="JWT Credential",e.Target="target",e))(he||{}),L=(e=>(e[e.Loading=0]="Loading",e[e.Idle=1]="Idle",e[e.NoResults=2]="NoResults",e[e.Error=3]="Error",e))(L||{});function Xe(e,o,a="data"){const t=s(o),{axiosInstance:r}=ce({headers:e.requestHeaders}),i=me(e,t),w=P({status:L.Idle});return{fetcher:async k=>{try{w.value={status:L.Loading};const T=i(k),{data:y}=await r.get(T),f=a&&a.replace(/[^\w-_]/gi,"");let S;y[f]&&Array.isArray(y[f])?S=y[f]:S=Object.keys(y).length?[y]:[];const R={data:S,total:S.length,...y.offset?{pagination:{offset:y.offset}}:null};return w.value={status:L.Idle,response:R},R}catch(T){const y={data:[],total:0};return k.query&&T.response.status===404?(w.value={status:L.NoResults,response:y,error:T},y):(w.value={status:L.Error,response:y,error:T},y)}},fetcherState:w}}const ae={useAxios:ce,useDeleteUrlBuilder:Be,useErrors:We,useFetchUrlBuilder:me,useDebouncedFilter:Ye,useFetcher:Xe,useI18n:ue},pe=(e,o)=>{const a=e.__vccOpts||e;for(const[t,r]of o)a[t]=r;return a},et={class:"toolbar-container"},tt={key:0,class:"toolbar-button-container"},at=["data-testid"],ot=G({__name:"EntityBaseTable",props:{tableHeaders:{type:Object,required:!0,default:()=>({})},fetcher:{type:Function,required:!0,default:async()=>({data:[],total:0})},initialFetcherParams:{type:Object,default:null},fetcherCacheKey:{type:Number,default:1},isLoading:{type:Boolean,default:!1},query:{type:String,default:""},enableClientSort:{type:Boolean,default:!1},enableEntityActions:{type:Boolean,default:!0},emptyStateOptions:{type:Object,default:()=>({})},errorMessage:{type:String,default:""},disablePaginationPageJump:{type:Boolean,default:void 0},disableSorting:{type:Boolean,default:void 0},paginationType:{type:String,default:void 0},cellAttributes:{type:Function,default:()=>({})},rowAttributes:{type:Function,default:()=>({})},preferencesStorageKey:{type:String,default:"",required:!0},dropdownMenuWidth:{type:String,default:"",required:!1}},emits:["click:row","sort","clear-search-input","empty-state-cta-clicked"],setup(e,{emit:o}){const a=e,{i18n:{t}}=ae.useI18n(),r=E(()=>{const c=[];return Object.keys(a.tableHeaders).forEach(p=>{const n=a.tableHeaders[p];c.push({label:n.label??p,key:p,sortable:n.sortable??!1})}),a.enableEntityActions&&c.push({key:"actions",hideLabel:!0}),c}),i=c=>({"data-rowid":c.id,"data-testid":c.name,...a.rowAttributes(c)}),w=c=>({"data-testid":c.headerKey,...a.cellAttributes(c)}),k=()=>{o("empty-state-cta-clicked"),T()},T=()=>{o("clear-search-input")},y=(c,p)=>{o("click:row",p)},f=c=>{o("sort",c)},{setTablePreferences:S,getTablePreferences:R}=Ze(),h=E(()=>{const c=R(a.preferencesStorageKey);return{...a.initialFetcherParams,...c}}),q=c=>{a.preferencesStorageKey&&S(a.preferencesStorageKey,c)};return(c,p)=>{const n=$("KIcon"),_=$("KButton"),F=$("KDropdownMenu"),D=$("KTable"),K=$("KCard");return v(),B(K,{class:"kong-ui-entity-base-table"},{body:l(()=>[g(D,{"cell-attrs":w,"disable-pagination-page-jump":e.disablePaginationPageJump,"disable-sorting":e.disableSorting,"empty-state-action-button-icon":e.query?"":"plus","empty-state-action-message":e.query?s(t)("baseTable.emptyState.noSearchResultsCtaText"):e.emptyStateOptions.ctaText,"empty-state-action-route":e.query?"":e.emptyStateOptions.ctaPath,"empty-state-icon":e.query?"stateNoSearchResults":"stateGruceo","empty-state-icon-size":"96","empty-state-message":e.query?s(t)("baseTable.emptyState.noSearchResultsMessage"):e.emptyStateOptions.message,"empty-state-title":e.query?s(t)("baseTable.emptyState.noSearchResultsTitle"):e.emptyStateOptions.title,"enable-client-sort":e.enableClientSort,"error-state-title":e.errorMessage,fetcher:e.fetcher,"fetcher-cache-key":String(e.fetcherCacheKey),"has-error":!!e.errorMessage,headers:s(r),"hide-pagination-when-optional":"","initial-fetcher-params":s(h),"is-loading":e.isLoading,"pagination-type":e.paginationType,"row-attrs":i,"search-input":e.query,onKtableEmptyStateCtaClicked:k,"onRow:click":y,onSort:f,"onUpdate:tablePreferences":q},ve({toolbar:l(()=>[M("div",et,[X(c.$slots,"toolbar-filter",{},void 0,!0),c.$slots["toolbar-button"]?(v(),V("div",tt,[X(c.$slots,"toolbar-button",{},void 0,!0)])):ne("",!0)])]),actions:l(({row:j,rowKey:C,rowValue:H})=>[M("div",{class:"actions-container","data-testid":j.name},[g(F,{"kpop-attributes":{placement:"bottomEnd"},width:e.dropdownMenuWidth},{items:l(()=>[X(c.$slots,"actions",{row:j,rowKey:C,rowValue:H},void 0,!0)]),default:l(()=>[g(_,{class:"non-visual-button","data-testid":"overflow-actions-button",size:"small"},{icon:l(()=>[g(n,{color:"var(--black-400, #3c4557)",icon:"more",size:"16"})]),_:1})]),_:2},1032,["width"])],8,at)]),_:2},[Q(e.tableHeaders,(j,C)=>({name:C,fn:l(({row:H,rowKey:z,rowValue:J})=>[X(c.$slots,C,{row:H,rowKey:z,rowValue:J},void 0,!0)])}))]),1032,["disable-pagination-page-jump","disable-sorting","empty-state-action-button-icon","empty-state-action-message","empty-state-action-route","empty-state-icon","empty-state-message","empty-state-title","enable-client-sort","error-state-title","fetcher","fetcher-cache-key","has-error","headers","initial-fetcher-params","is-loading","pagination-type","search-input"])]),_:3})}}}),rt=pe(ot,[["__scopeId","data-v-6eab8cd1"]]),lt={key:0,class:"kong-ui-entity-delete-error"},st={key:1,class:"description"},nt=G({__name:"EntityDeleteModal",props:{visible:{type:Boolean,required:!0,default:!1},title:{type:String,default:"Delete"},entityType:{type:String,required:!0},entityName:{type:String,default:""},needConfirm:{type:Boolean,default:!0},description:{type:String,default:""},actionPending:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["cancel","proceed"],setup(e,{emit:o}){const a=e,{i18nT:t}=ae.useI18n(),r=E(()=>a.needConfirm?a.entityName:""),i=()=>{o("cancel")},w=()=>{o("proceed")};return(k,T)=>{const y=$("KAlert"),f=$("KPrompt");return v(),B(f,{"action-button-text":"Yes, delete","action-pending":e.actionPending,class:"kong-ui-entity-delete-modal","confirmation-text":s(r),"is-visible":e.visible,title:e.title,type:"danger",onCanceled:i,onProceed:w},{"body-content":l(()=>[e.error?(v(),V("div",lt,[g(y,{appearance:"danger"},{alertMessage:l(()=>[A(I(e.error),1)]),_:1})])):ne("",!0),g(s(t),{class:"message",keypath:a.entityName?"deleteModal.messageWithName":"deleteModal.message",tag:"p"},ve({entityType:l(()=>[A(I(a.entityType),1)]),_:2},[a.entityName?{name:"entityName",fn:l(()=>[M("strong",null,I(a.entityName),1)]),key:"0"}:void 0]),1032,["keypath"]),a.description||k.$slots.description?(v(),V("div",st,[X(k.$slots,"description",{},()=>[M("p",null,I(a.description),1)],!0)])):ne("",!0)]),_:3},8,["action-pending","confirmation-text","is-visible","title"])}}}),it=pe(nt,[["__scopeId","data-v-3513e33b"]]),ct={fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},ut={id:"mask0_180_20349",height:"20",maskUnits:"userSpaceOnUse",style:{"mask-type":"alpha"},width:"20",x:"0",y:"0"},dt=["fill"],pt={mask:"url(#mask0_180_20349)"},yt=["fill"],ft=G({__name:"IconFilter",props:{color:{type:String,default:"var(--kong-ui-entity-filter-color, var(--blue-500, #1155cb))"}},setup(e){return(o,a)=>(v(),V("svg",ct,[M("mask",ut,[M("rect",{fill:e.color,height:"20",width:"20"},null,8,dt)]),M("g",pt,[M("path",{d:"M8 14.5V13H12V14.5H8ZM5 10.75V9.25H15V10.75H5ZM3 7V5.5H17V7H3Z",fill:e.color},null,8,yt)])]))}}),vt={key:1,class:"kong-ui-entity-filter"},gt={class:"menu-item-title"},mt={class:"menu-item-indicator"},ht={class:"menu-item-body"},bt=["for"],kt={class:"menu-item-buttons"},_t=G({__name:"EntityFilter",props:{config:{type:Object,required:!0,default:()=>({isExactMatch:!0,placeholder:""})},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:o}){const a=e,{i18n:{t}}=ae.useI18n(),r=P(!1),i=P({}),w=E(()=>{const p=[];return new URLSearchParams(a.modelValue).forEach((n,_)=>{n!==""&&p.push(_)}),p}),k=E(()=>{const p=a.config.fields;return Object.keys(p).filter(n=>p[n].searchable).map(n=>({label:p[n].label||n,value:n}))});fe(()=>a.modelValue,p=>{i.value={},new URLSearchParams(p).forEach((n,_)=>{i.value[_]=n})});const T=()=>{r.value=!r.value},y=p=>{o("update:modelValue",p)},f=p=>`filter-${p}`,S=p=>{var n,_;return(((_=(n=a.config.schema)==null?void 0:n[p])==null?void 0:_.values)??[]).map(F=>({value:F,label:F}))},R=p=>{var n,_;return((_=(n=a.config.schema)==null?void 0:n[p])==null?void 0:_.type)??"text"},h=p=>{i.value={...i.value,[p]:""},c()},q=()=>{i.value={},c(!0)},c=(p=!1)=>{const n=Object.keys(i.value).reduce((_,F)=>(i.value[F]&&(_[F]=`${i.value[F]}`),_),{});p&&(r.value=!1),o("update:modelValue",new URLSearchParams(n).toString())};return(p,n)=>{const _=$("KInput"),F=$("KButton"),D=$("KSelect"),K=$("KMenuItem"),j=$("KMenu");return e.config.isExactMatch?(v(),B(_,{key:0,autocomplete:"off",class:"kong-ui-entity-filter-input","data-testid":"search-input","model-value":e.modelValue,placeholder:e.config.placeholder,"onUpdate:modelValue":y},{icon:l(()=>[g(ft)]),_:1},8,["model-value","placeholder"])):(v(),V("div",vt,[g(F,{appearance:"btn-link","data-testid":"filter-button",icon:"filter",onClick:T},{default:l(()=>[A(I(s(t)("filter.filterButtonText"))+" "+I(s(w).length>0?`(${s(w).length})`:""),1)]),_:1}),le(M("div",{class:"kong-ui-entity-filter-backdrop",onClick:T},null,512),[[se,r.value]]),le(g(j,{class:"kong-ui-entity-filter-menu"},{body:l(()=>[(v(!0),V(Y,null,Q(s(k),(C,H)=>(v(),B(K,{key:C.value,"data-testid":C.value,expandable:"","last-menu-item":H===s(k).length-1},{itemTitle:l(()=>[M("span",gt,[A(I(C.label)+" ",1),le(M("span",mt,null,512),[[se,s(w).includes(C.value)]])])]),itemBody:l(()=>{var z,J;return[M("div",ht,[M("label",{class:"menu-item-label",for:f(C.value)},I(s(t)("filter.fieldLabel")),9,bt),((J=(z=e.config.schema)==null?void 0:z[C.value])==null?void 0:J.type)==="select"?(v(),B(D,{key:0,id:f(C.value),modelValue:i.value[C.value],"onUpdate:modelValue":b=>i.value[C.value]=b,appearance:"select",items:S(C.value),placeholder:s(t)("filter.selectPlaceholder")},null,8,["id","modelValue","onUpdate:modelValue","items","placeholder"])):(v(),B(_,{key:1,id:f(C.value),modelValue:i.value[C.value],"onUpdate:modelValue":b=>i.value[C.value]=b,autocomplete:"off",placeholder:s(t)("filter.inputPlaceholder"),size:"small",type:R(C.value)},null,8,["id","modelValue","onUpdate:modelValue","placeholder","type"]))]),M("div",kt,[g(F,{appearance:"btn-link","data-testid":"apply-filter",size:"small",onClick:n[0]||(n[0]=b=>c(!0))},{default:l(()=>[A(I(s(t)("filter.applyButtonText")),1)]),_:1}),g(F,{appearance:"btn-link","data-testid":"clear-filter",size:"small",onClick:b=>h(C.value)},{default:l(()=>[A(I(s(t)("filter.clearButtonText")),1)]),_:2},1032,["onClick"])])]}),_:2},1032,["data-testid","last-menu-item"]))),128))]),actionButton:l(()=>[g(F,{onClick:q},{default:l(()=>[A(I(s(t)("filter.clearAllButtonText")),1)]),_:1})]),_:1},512),[[se,r.value]])]))}}}),wt=pe(_t,[["__scopeId","data-v-fcf9a8f1"]]),oe=G({__name:"PermissionsWrapper",props:{authFunction:{type:Function,required:!0,default:async()=>!0},forceShow:{type:Boolean,default:!1}},setup(e){const o=e,a=P(void 0),t=E(()=>a.value===!0||a.value!==void 0&&o.forceShow===!0);return Ce(async()=>{a.value=await o.authFunction()}),(r,i)=>s(t)?X(r.$slots,"default",{key:0,isAllowed:a.value}):ne("",!0)}}),{useAxios:Ct,useDeleteUrlBuilder:Tt,useErrors:ra,useFetchUrlBuilder:la,useFetcher:St,useDebouncedFilter:sa}=ae,Ft={class:"kong-ui-entities-routes-list"},xt={key:1},Rt={key:1},It={key:1},Pt={key:1},Et=G({__name:"RouteList",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.createRoute||!e.getViewRoute||!e.getEditRoute||e.app==="kongManager"&&!e.isExactMatch&&!e.filterSchema)},canCreate:{type:Function,required:!1,default:async()=>!0},canDelete:{type:Function,required:!1,default:async()=>!0},canEdit:{type:Function,required:!1,default:async()=>!0},canRetrieve:{type:Function,required:!1,default:async()=>!0}},emits:["error","loading","copy:success","copy:error","delete:success"],setup(e,{emit:o}){var a;const t=e,{i18n:{t:r}}=Me.useI18n(),i=Bt(),{axiosInstance:w}=Ct({headers:(a=t.config)==null?void 0:a.requestHeaders}),k=P(1),T=E(()=>t.config.app!=="kongManager"||!!t.config.disableSorting),y={name:{label:r("routes.list.table_headers.name"),searchable:!0,sortable:!0},protocols:{label:r("routes.list.table_headers.protocols"),searchable:!0},...t.config.useExpression?{expression:{label:r("routes.list.table_headers.expression")}}:{hosts:{label:r("routes.list.table_headers.hosts"),searchable:!0},methods:{label:r("routes.list.table_headers.methods"),searchable:!0},paths:{label:r("routes.list.table_headers.paths"),searchable:!0}},tags:{label:r("routes.list.table_headers.tags"),sortable:!1}},f=y,S=E(()=>{var d,m,O,N;let U=`${t.config.apiBaseUrl}${Ke.list[t.config.app][t.config.serviceId?"forGatewayService":"all"]}`;return t.config.app==="konnect"?U=U.replace(/{controlPlaneId}/gi,((d=t.config)==null?void 0:d.controlPlaneId)||"").replace(/{serviceId}/gi,((m=t.config)==null?void 0:m.serviceId)||""):t.config.app==="kongManager"&&(U=U.replace(/{workspace}/gi,((O=t.config)==null?void 0:O.workspace)||"").replace(/{serviceId}/gi,((N=t.config)==null?void 0:N.serviceId)||"")),U}),R=P(""),h=E(()=>{const d=t.config.app==="konnect"||t.config.isExactMatch;if(d)return{isExactMatch:d,placeholder:r("search.placeholder")};const{name:m,protocols:O,hosts:N,methods:U,paths:W,expression:re}=y,u=t.config.useExpression?{name:m,protocols:O,expression:re}:{name:m,protocols:O,hosts:N,methods:U,paths:W};return{isExactMatch:d,fields:u,schema:t.config.filterSchema}}),{fetcher:q,fetcherState:c}=St(t.config,S.value),p=()=>{R.value=""},n=()=>{k.value++},_=P(""),F=E(()=>c.value.status===L.Loading),D=E(()=>{var d;return c.value.status===L.Idle&&!!((d=c.value.response)!=null&&d.data.length)}),K=E(()=>!F.value&&(D.value||!!R.value)),j=(d,m)=>{const O=d.id;if(!m(O)){o("copy:error",{entity:d,field:"id",message:r("errors.copy")});return}o("copy:success",{entity:d,field:"id",message:r("copy.success",{val:O})})},C=(d,m)=>{const O=JSON.stringify(d);if(!m(O)){o("copy:error",{entity:d,message:r("errors.copy")});return}o("copy:success",{entity:d,message:r("copy.success_brief")})},H=async d=>{var m;await((m=t.canRetrieve)==null?void 0:m.call(t,d))&&i.push(t.config.getViewRoute(d.id))},z=d=>({label:r("actions.view"),to:t.config.getViewRoute(d)}),J=d=>({label:r("actions.edit"),to:t.config.getEditRoute(d)}),b=P(void 0),ee=P(!1),Z=P(!1),we=P(""),Vt=Tt(t.config,S.value),Dt=d=>{b.value=d,ee.value=!0},Mt=()=>{ee.value=!1},Kt=async()=>{var d,m,O;if((d=b.value)!=null&&d.id){Z.value=!0;try{await w.delete(Vt(b.value.id)),Z.value=!1,ee.value=!1,k.value++,o("delete:success",b.value)}catch(N){we.value=((O=(m=N.response)==null?void 0:m.data)==null?void 0:O.message)||N.message||r("errors.delete"),o("error",N)}finally{Z.value=!1}}};fe(F,d=>{o("loading",d)},{immediate:!0}),fe(c,d=>{if(d.status===L.Error){_.value=r("errors.general"),o("error",d.error);return}_.value=""});const ye=P({ctaPath:t.config.createRoute,ctaText:void 0,message:r("routes.list.empty_state.description"),title:r("routes.title")});return Ce(async()=>{await t.canCreate()&&(ye.value.title=r("routes.list.empty_state.title"),ye.value.ctaText=r("actions.create"))}),(d,m)=>{const O=$("KButton"),N=$("KBadge"),U=$("KTruncate"),W=$("KDropdownItem"),re=$("KClipboardProvider");return v(),V("div",Ft,[g(s(rt),{"disable-pagination-page-jump":"","disable-sorting":s(T),"empty-state-options":ye.value,"enable-entity-actions":"","error-message":_.value,fetcher:s(q),"fetcher-cache-key":k.value,"is-loading":s(F),"pagination-type":"offset","preferences-storage-key":"kong-ui-entities-routes-list",query:R.value,"table-headers":s(f),onClearSearchInput:p,"onClick:row":m[6]||(m[6]=u=>H(u)),onSort:n},ve({"toolbar-filter":l(()=>[le(g(s(wt),{modelValue:R.value,"onUpdate:modelValue":m[0]||(m[0]=u=>R.value=u),config:s(h)},null,8,["modelValue","config"]),[[se,s(K)]])]),name:l(({rowValue:u})=>[M("b",null,I(u??"-"),1)]),protocols:l(({rowValue:u})=>[g(U,null,{default:l(()=>[(v(!0),V(Y,null,Q(u,x=>(v(),B(N,{key:x,"background-color":"var(--grey-200, #f1f1f5)",color:"var(--grey-500, #6F7787)",onClick:m[1]||(m[1]=te(()=>{},["stop"]))},{default:l(()=>[A(I(x),1)]),_:2},1024))),128))]),_:2},1024)]),hosts:l(({rowValue:u})=>[(u==null?void 0:u.length)>0?(v(),B(U,{key:0},{default:l(()=>[(v(!0),V(Y,null,Q(u,x=>(v(),B(N,{key:x,"background-color":"var(--grey-200, #f1f1f5)",color:"var(--grey-500, #6f7787)","truncation-tooltip":x,onClick:m[2]||(m[2]=te(()=>{},["stop"]))},{default:l(()=>[A(I(x),1)]),_:2},1032,["truncation-tooltip"]))),128))]),_:2},1024)):(v(),V("span",xt,"-"))]),methods:l(({rowValue:u})=>[(u==null?void 0:u.length)>0?(v(),B(U,{key:0},{default:l(()=>[(v(!0),V(Y,null,Q(u,x=>(v(),B(N,qt({key:x},s(Oe)(x),{onClick:m[3]||(m[3]=te(()=>{},["stop"]))}),{default:l(()=>[A(I(x),1)]),_:2},1040))),128))]),_:2},1024)):(v(),V("span",Rt,"-"))]),paths:l(({rowValue:u})=>[(u==null?void 0:u.length)>0?(v(),B(U,{key:0},{default:l(()=>[(v(!0),V(Y,null,Q(u,x=>(v(),B(N,{key:x,"background-color":"var(--grey-200, #f1f1f5)",color:"var(--grey-500, #6f7787)","truncation-tooltip":x,onClick:m[4]||(m[4]=te(()=>{},["stop"]))},{default:l(()=>[A(I(x),1)]),_:2},1032,["truncation-tooltip"]))),128))]),_:2},1024)):(v(),V("span",It,"-"))]),tags:l(({rowValue:u})=>[(u==null?void 0:u.length)>0?(v(),B(U,{key:0},{default:l(()=>[(v(!0),V(Y,null,Q(u,x=>(v(),B(N,{key:x,onClick:m[5]||(m[5]=te(()=>{},["stop"]))},{default:l(()=>[A(I(x),1)]),_:2},1024))),128))]),_:2},1024)):(v(),V("span",Pt,"-"))]),actions:l(({row:u})=>[g(re,null,{default:l(({copyToClipboard:x})=>[g(W,{"data-testid":"action-entity-copy-id",onClick:Ot=>j(u,x)},{default:l(()=>[A(I(s(r)("actions.copy_id")),1)]),_:2},1032,["onClick"])]),_:2},1024),g(re,null,{default:l(({copyToClipboard:x})=>[g(W,{"data-testid":"action-entity-copy-json",onClick:Ot=>C(u,x)},{default:l(()=>[A(I(s(r)("actions.copy_json")),1)]),_:2},1032,["onClick"])]),_:2},1024),g(s(oe),{"auth-function":()=>e.canRetrieve(u)},{default:l(()=>[g(W,{"data-testid":"action-entity-view","has-divider":"",item:z(u.id)},null,8,["item"])]),_:2},1032,["auth-function"]),g(s(oe),{"auth-function":()=>e.canEdit(u)},{default:l(()=>[g(W,{"data-testid":"action-entity-edit",item:J(u.id)},null,8,["item"])]),_:2},1032,["auth-function"]),g(s(oe),{"auth-function":()=>e.canDelete(u)},{default:l(()=>[g(W,{"data-testid":"action-entity-delete","has-divider":"","is-dangerous":"",onClick:x=>Dt(u)},{default:l(()=>[A(I(s(r)("actions.delete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["auth-function"])]),_:2},[s(K)?{name:"toolbar-button",fn:l(()=>[g(s(oe),{"auth-function":()=>e.canCreate()},{default:l(()=>[g(O,{appearance:"primary","data-testid":"toolbar-add-route",icon:"plus",to:e.config.createRoute},{default:l(()=>[A(I(s(r)("routes.list.toolbar_actions.new_route")),1)]),_:1},8,["to"])]),_:1},8,["auth-function"])]),key:"0"}:void 0]),1032,["disable-sorting","empty-state-options","error-message","fetcher","fetcher-cache-key","is-loading","query","table-headers"]),g(s(it),{"action-pending":Z.value,description:s(r)("delete.description"),"entity-name":b.value&&(b.value.name||b.value.id),"entity-type":s(he).Route,error:we.value,title:s(r)("delete.title"),visible:ee.value,onCancel:Mt,onProceed:Kt},null,8,["action-pending","description","entity-name","entity-type","error","title","visible"])])}}}),$t=(e,o)=>{const a=e.__vccOpts||e;for(const[t,r]of o)a[t]=r;return a},At=$t(Et,[["__scopeId","data-v-4e1f6293"]]);let be,ke,_e;be={class:"routes-listing"},ke=A(" A Route defines rules to match client requests, and is associated with a Service. "),_e=A(" Learn more "),Re=G({__name:"List",props:{serviceId:{type:String,required:!1,default:""},createRouteQuery:{type:Object,required:!1,default:()=>({})}},setup(e){const o=e,a=Jt("rbac"),t=Wt(),r=Ut(),i=Lt(),w=jt(),{infoConfig:k}=Fe(r),{entityDoc:T}=Fe(i),y=T.value("route"),{createRedirectRouteQuery:f,createPostDeleteRouteQuery:S,redirectPath:R}=ea(),h=E(()=>t.name!=="routes"),q=E(()=>h.value?`services/${o.serviceId}/routes`:"routes"),c={name:{type:"text"},protocols:{type:"select",values:["http","https","tcp","tls","udp","tls_passthrough","grpc","grpcs"]},methods:{type:"text"},hosts:{type:"text"},paths:{type:"text"}},p=E(()=>h.value?xe({$route:t,path:`/${t.params.workspace}/routes/create`,query:{...o.createRouteQuery,...f()},redirect:R,fields:{service_id:o.serviceId}}):{name:"create-route"}),n=b=>h.value?xe({$route:t,path:`/${t.params.workspace}/services/${o.serviceId}/routes/${b}`,query:{...f(),...S()},redirect:R}):{name:"show-route",params:{id:b}},_=b=>({name:"update-route",params:{workspace:t.params.workspace,id:b},...h.value?{query:{...f(),...S(),serviceId:o.serviceId}}:null}),F=Ht({...Zt(),serviceId:o.serviceId,useExpression:k.value.router_flavor==="expressions",createRoute:p,getViewRoute:n,getEditRoute:_,filterSchema:c}),D=()=>ie(a,{path:q.value,action:"create"}),K=b=>ie(a,{path:`${q.value}/${b.id}`,action:"delete"}),j=b=>ie(a,{path:`${q.value}/${b.id}`,action:"update"}),C=b=>ie(a,{path:`${q.value}/${b.id}`,action:"read"}),{onCopySuccess:H,onCopyError:z}=Yt(),J=b=>{w.notify({message:`${b.name} Route successfully deleted!`,type:"success"})};return(b,ee)=>{const Z=$("KExternalLink");return v(),V("section",be,[g(zt,null,{"below-title":l(()=>[g(Gt,null,{default:l(()=>[M("p",null,[ke,g(Z,{href:s(y)},{default:l(()=>[_e]),_:1},8,["href"])])]),_:1})]),_:1}),g(s(At),{config:F,"can-create":D,"can-delete":K,"can-edit":j,"can-retrieve":C,"onCopy:success":s(H),"onCopy:error":s(z),"onDelete:success":J},null,8,["config","onCopy:success","onCopy:error"])])}}})});export{oa as __tla,Re as default};
