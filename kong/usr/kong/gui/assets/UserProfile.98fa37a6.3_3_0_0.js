/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as h,n as v,q as A,M as I,x as M,r as d,o as c,c as f,a,t as _,l as y,h as E,b as o,w as C,d as g,y as P,p as fe,e as Ee,i as Ce,g as Se,z as ge,u as be,__tla as he}from"./index.84d84090.3_3_0_0.js";import{u as U,__tla as _e}from"./StateMachine.4e8149cb.3_3_0_0.js";import{C as ye,__tla as Re}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{__tla as ke}from"./monaco-editor.90904fcf.3_3_0_0.js";let V,ve=Promise.all([(()=>{try{return he}catch{}})(),(()=>{try{return _e}catch{}})(),(()=>{try{return Re}catch{}})(),(()=>{try{return ke}catch{}})()]).then(async()=>{const K={name:"RbacReset",components:{ConfirmModalDialog:ye},setup(r){const s=P("api"),m=v(),e=A({adminUsername:r.adminUsername||null,userToken:null,lang:{DESCRIPTION:"Your RBAC Token is used to make Admin API requests when RBAC is enabled.",WARNING:"Are you sure you want to reset your Token? All applications using your current token will no longer work and will need to be updated.",SUCCESS:"Be sure to save it, you won\u2019t be able to see it again.",ERROR:"There was an error, please try again.",RESET_SUCCESS_TOASTER:"RBAC Token successfully reset!"},machine:I({id:"userMachine",initial:"idle",states:{idle:{on:{CLICK_RESET_TOKEN:"resettingToken"}},resettingToken:{on:{CANCEL:"idle",RESOLVE:"success",REJECT:"error"}},error:{on:{CLICK_RESET_TOKEN:"resettingToken"}},success:{on:{CLICK_RESET_TOKEN:"resettingToken"}}}})}),{currentState:p,transition:n,fetchMachine:l}=U(e.machine);function u(w){e.userToken=w.data.token,n("RESOLVE"),m.notify({message:e.lang.RESET_SUCCESS_TOASTER,type:"success"})}function i(){e.userToken=null,n("REJECT")}function t(){return n("CLICK_RESET_TOKEN"),s.resetAdminToken().then(u).catch(i)}function S(w){if(!w(this.userToken))return m.notify("error","Failed to copy id to clipboard");m.notify({message:"Copied to clipboard",type:"success"})}return{...M(e),resetToken:t,copyIdToClipboard:S,handleSuccess:u,handleError:i,currentState:p,transition:n,fetchMachine:l}}},b=r=>(fe("data-v-7932821a"),r=r(),Ee(),r),O={class:"form-group rbac-reset"},B=b(()=>a("h5",null,"Reset RBAC Token",-1)),N={class:"pb-0"},x=g(" Reset Token "),L={key:2},H=b(()=>a("strong",null,"Your token has been reset!",-1)),D=b(()=>a("br",null,null,-1)),q={class:"input-group mb-2 mr-sm-2 mb-sm-0"},J=g(" Copy ");function G(r,s,m,e,p,n){const l=d("KAlert"),u=d("KButton"),i=d("ConfirmModalDialog"),t=d("KToggle"),S=d("KSkeleton"),w=d("KInput"),Te=d("KClipboardProvider");return c(),f("div",O,[B,a("p",null,_(r.lang.DESCRIPTION),1),e.currentState.value==="error"?(c(),y(l,{key:0,"alert-message":r.lang.ERROR,appearance:"danger",class:"mb-4"},null,8,["alert-message"])):E("",!0),o(t,null,{default:C(({toggle:T,isToggled:k})=>[a("div",N,[o(u,{disabled:e.currentState.value==="resettingToken",appearance:"danger",onClick:T},{default:C(()=>[x]),_:2},1032,["disabled","onClick"]),o(i,{visible:k.value,text:r.lang.WARNING,"alert-type":"warning","proceed-text":"Reset and Generate New Token",title:"Reset RBAC Token",action:"delete",onOk:()=>e.resetToken().then(T()),onCancel:T},null,8,["visible","text","onOk","onCancel"])])]),_:1}),e.currentState.value==="resettingToken"?(c(),y(S,{key:1,class:"mt-4"})):E("",!0),e.currentState.value==="success"?(c(),f("div",L,[o(l,{appearance:"info",class:"my-4"},{alertMessage:C(()=>[H,D,g(" "+_(r.lang.SUCCESS),1)]),_:1}),a("div",q,[o(w,{modelValue:r.userToken,"onUpdate:modelValue":s[0]||(s[0]=T=>r.userToken=T),type:"text",class:"success-input","data-testid":"success-input",readonly:""},null,8,["modelValue"]),o(Te,null,{default:C(({copyToClipboard:T})=>[o(u,{"data-testid":"copy-to-clipboard",class:"input-group-addon",appearance:"outline",onClick:k=>e.copyIdToClipboard(T)},{default:C(()=>[J]),_:2},1032,["onClick"])]),_:1})])])):E("",!0)])}const W=h(K,[["render",G],["__scopeId","data-v-7932821a"]]),R={old:"",new:"",confirm:""},Y={name:"PasswordReset",setup(r){const s=P("api"),m=v(),e=A({adminID:r.adminId||null,password:{...R},errorText:null,machine:I({id:"userMachine",initial:"idle",states:{idle:{on:{MATCH:"canSubmit",MISMATCH:"passwordError",REJECT:"formError"}},pending:{on:{RESOLVE:"idle",REJECT:"formError"}},canSubmit:{on:{SUBMIT:"pending",MISMATCH:"passwordError"}},passwordError:{on:{MATCH:"canSubmit"}},formError:{on:{MATCH:"canSubmit",MISMATCH:"passwordError"}}}})}),{currentState:p,transition:n,fetchMachine:l}=U(e.machine,e);function u(){e.password.new.length>0&&e.password.confirm.length>0&&(e.password.new===e.password.confirm?n("MATCH"):n("MISMATCH"))}function i(){e.password={...R},n("RESOLVE"),m.notify({message:"Password successfully reset!",type:"success"})}function t(w){n("REJECT",{errorText:Se(w)})}function S(){p.value.value==="canSubmit"&&(n("SUBMIT"),s.resetAdminPassword(e.password.old,e.password.new).then(i).catch(t))}return{...M(e),validatePasswords:u,resetPassword:S,handleSuccess:i,handleError:t,currentState:p,transition:n,fetchMachine:l}}},$=a("h5",null,"Reset Password",-1),z={class:"mb-4 old-password"},F=a("label",{for:"old-password"},"Old Password",-1),j={class:"mb-4 new-password"},Q=a("label",{for:"new-password"},"New Password",-1),X={class:"mb-4 confirm-password"},Z=a("label",{for:"confirm-password"},"Confirm New Password",-1);function ee(r,s,m,e,p,n){const l=d("KInput"),u=d("KAlert"),i=d("KButton");return c(),f("form",{class:"form-group password-reset",onSubmit:s[3]||(s[3]=Ce((...t)=>e.resetPassword&&e.resetPassword(...t),["prevent"]))},[$,a("div",z,[F,o(l,{id:"old-password",modelValue:r.password.old,"onUpdate:modelValue":s[0]||(s[0]=t=>r.password.old=t),name:"old-password",type:"password",required:"","data-testid":"old-password"},null,8,["modelValue"])]),a("div",j,[Q,o(l,{id:"new-password",modelValue:r.password.new,"onUpdate:modelValue":s[1]||(s[1]=t=>r.password.new=t),name:"new-password",type:"password",required:"","data-testid":"new-password",onBlur:e.validatePasswords},null,8,["modelValue","onBlur"])]),a("div",X,[Z,o(l,{id:"confirm-password",modelValue:r.password.confirm,"onUpdate:modelValue":s[2]||(s[2]=t=>r.password.confirm=t),name:"confirm-password",type:"password",required:"","has-error":e.currentState.value==="passwordError","error-message":"Passwords must match","data-testid":"confirm-password",onBlur:e.validatePasswords},null,8,["modelValue","has-error","onBlur"])]),e.currentState.value==="formError"?(c(),y(u,{key:0,"alert-message":r.errorText,appearance:"danger",class:"mb-4"},null,8,["alert-message"])):E("",!0),o(i,{appearance:"outline",type:"submit"},{default:C(()=>[g(_(e.currentState.value==="pending"?"Loading...":"Reset Password"),1)]),_:1})],32)}const re=h(Y,[["render",ee]]),ae={name:"UserProfile",components:{RbacReset:W,PasswordReset:re},computed:{...ge(be,["currentUser"]),authType(){return this.$root.$data.auth.enabled}}},se={class:"container col-10 col-md-8 col-lg-6"},te=a("h2",null,"User Profile",-1),ne={class:"my-4 user-profile-form"},oe={class:"form-group"},le=a("label",{for:"username"},"Username",-1),de={class:"form-group"},ue=a("label",{for:"custom_id"},"Custom ID",-1),ie={key:0},ce=a("hr",{class:"mb-4"},null,-1),me={key:1},pe=a("hr",{class:"mb-4"},null,-1);function we(r,s,m,e,p,n){const l=d("KInput"),u=d("PasswordReset"),i=d("RbacReset");return c(),f("div",se,[te,a("div",ne,[a("div",oe,[le,o(l,{modelValue:r.currentUser.username,"onUpdate:modelValue":s[0]||(s[0]=t=>r.currentUser.username=t),name:"username",type:"text",disabled:""},null,8,["modelValue"])]),a("div",de,[ue,o(l,{modelValue:r.currentUser.custom_id,"onUpdate:modelValue":s[1]||(s[1]=t=>r.currentUser.custom_id=t),name:"custom_id",type:"text",disabled:""},null,8,["modelValue"])]),n.authType==="basic-auth"?(c(),f("div",ie,[ce,o(u)])):E("",!0),r.currentUser.rbacTokenEnabled?(c(),f("div",me,[pe,o(i,{"admin-username":r.currentUser.username},null,8,["admin-username"])])):E("",!0)])])}V=h(ae,[["render",we]])});export{ve as __tla,V as default};
