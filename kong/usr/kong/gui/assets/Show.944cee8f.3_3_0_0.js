/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as G,n as W,Q as X,aC as tt,q as et,r as n,c as A,b as o,w as p,ay as h,o as y,d as T,y as b,_ as at,z as w,J as rt,u as st,Y as it,aF as nt,a4 as ot,a as C,l as ct,h as I,__tla as dt}from"./index.84d84090.3_3_0_0.js";import{B as lt,__tla as ut}from"./Breadcrumbs.6127883e.3_3_0_0.js";import{Z as mt,__tla as pt}from"./style.0137e55a.3_3_0_0.js";import{u as ht,a as yt,b as u,__tla as _t}from"./useRbacPermission.15766885.3_3_0_0.js";import{D as gt,T as ft,__tla as Rt}from"./TagsBlock.4b7d5635.3_3_0_0.js";import{D as $t,__tla as kt}from"./DetailContainer.85becad9.3_3_0_0.js";import{E as Dt,__tla as Mt}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{E as At,__tla as Ct}from"./EntityConfiguration.03651df4.3_3_0_0.js";import{c as Et}from"./Upstream.6ca36fba.3_3_0_0.js";import{R as Tt,__tla as bt}from"./RbacPermMixin.3a5f32ef.3_3_0_0.js";import{E as wt,__tla as It}from"./EntityMixin.2764673d.3_3_0_0.js";import{R as vt}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as Lt}from"./monaco-editor.90904fcf.3_3_0_0.js";import{__tla as Pt}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{__tla as Ut}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import"./icon-help.699f8c28.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";import{__tla as Ht}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as xt}from"./EntityFilter.bf4158bc.3_3_0_0.js";let v,Qt=Promise.all([(()=>{try{return dt}catch{}})(),(()=>{try{return ut}catch{}})(),(()=>{try{return pt}catch{}})(),(()=>{try{return _t}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return kt}catch{}})(),(()=>{try{return Mt}catch{}})(),(()=>{try{return Ct}catch{}})(),(()=>{try{return bt}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Lt}catch{}})(),(()=>{try{return Pt}catch{}})(),(()=>{try{return Ut}catch{}})(),(()=>{try{return Ht}catch{}})(),(()=>{try{return xt}catch{}})()]).then(async()=>{const L={class:"targets-listing"},P=T(" A target is an IP address/hostname with a port that identifies an instance of a backend service. "),U=T(" Learn more "),H=G({__name:"TargetList",props:{upstreamId:{type:String,default:""}},setup(s){const c=s,a=b("rbac"),i={route:"target",endpoint:`/upstreams/${c.upstreamId}/targets`},t=W(),d=X(),{entityDoc:_}=tt(d),g=_.value(i.route),f=e=>u(a,{path:`${i.endpoint}/${e.id}/healthy`,action:"update"}),R=e=>u(a,{path:`${i.endpoint}/${e.id}/unhealthy`,action:"update"}),$=et({...ht(),upstreamId:c.upstreamId,canMarkHealthy:f,canMarkUnhealthy:R}),k=()=>u(a,{path:i.endpoint,action:"create"}),D=e=>u(a,{path:`${i.endpoint}/${e.id}`,action:"update"}),M=e=>u(a,{path:`${i.endpoint}/${e.id}`,action:"delete"}),N=e=>u(a,{path:`${i.endpoint}/${e.id}`,action:"read"}),{onCopySuccess:z,onCopyError:F}=yt(),J=e=>{t.notify({message:`${e.target} Target successfully created!`,type:"success"})},K=e=>{t.notify({message:`${e.target} Target successfully updated!`,type:"success"})},O=e=>{t.notify({message:`${e.target} Target successfully deleted!`,type:"success"})},E=b("api"),Y=e=>E.makeHealthy(c.upstreamId,e.id).then(r=>{r.status===204?t.notify({message:"Target successfully marked healthy!",type:"success"}):t.notify({message:"An error has occurred, please try again",type:"danger"})}).catch(r=>{var l,m;t.notify({message:((m=(l=r.response)==null?void 0:l.data)==null?void 0:m.message)??r.message??"An error has occurred, please try again",type:"danger"})}),Z=e=>E.makeUnHealthy(c.upstreamId,e.id).then(r=>{r.status===204?t.notify({message:"Target successfully marked unhealthy!",type:"success"}):t.notify({message:"An error has occurred, please try again",type:"danger"})}).catch(r=>{var l,m;t.notify({message:((m=(l=r.response)==null?void 0:l.data)==null?void 0:m.message)??r.message??"An error has occurred, please try again",type:"danger"})});return(e,r)=>{const l=n("KExternalLink");return y(),A("section",L,[o(h(mt),{config:$,"can-create":k,"can-edit":D,"can-delete":M,"can-retrieve":N,"onCopy:success":h(z),"onCopy:error":h(F),"onCreate:target":J,"onUpdate:target":K,"onDelete:success":O,"onHealthActions:healthy":Y,"onHealthActions:unhealthy":Z},{"form-info":p(()=>[P,o(l,{href:h(g)},{default:p(()=>[U]),_:1},8,["href"])]),_:1},8,["config","onCopy:success","onCopy:error"])])}}}),x={name:"UpstreamView",components:{Breadcrumbs:lt,DetailsHeader:gt,DetailContainer:$t,TagsBlock:ft,EntityDeleteModal:Dt,TargetList:H,EntityConfiguration:At},mixins:[wt,vt,Tt],props:{entity:{type:Object,default:()=>({id:void 0,name:"Upstream",path:"upstream",rootPath:"upstreams",createRouteName:null})}},data(){return{configSchema:Et,record:{name:""},deleteModalModel:null,redirectRouteAfterDelete:{name:"upstreams"},navItems:[{key:"show-upstream",label:"Configuration"},{key:"upstream-targets",label:"Targets"}]}},computed:{...w(rt,["workspace"]),...w(st,{perms:"permissions"}),resourceEndpoint(){return this.entity.rootPath},id(){return this.record&&this.record.id||this.$route.params.id},isLoading(){return!this.record},title(){return this.isLoading?"Loading...":this.record.name},titleMapping(){let s=it(this.record,"upstreams")||this.id;return nt(s)&&(s=s.split("-")[0].trim()),{id:s}},entityId(){return this.id+","+(this.record&&this.record.name||"")},entityQuery(){return{entity_id:this.entityId,entity_type:"upstream_id"}},actions(){return[{name:"Edit configuration",testAction:"action-edit",isAllowed:this.hasUpdatePerm,handler:this.handleEdit},{name:"Delete",divider:this.hasUpdatePerm,testAction:"action-delete",isAllowed:this.hasDeletePerm,dangerous:!0,handler:this.confirmDelete}]},createRoute(){return{name:"create-target",params:{id:this.id},query:{...this.entityQuery,...this.createRedirectRouteQuery()}}},editRoute(){return{name:"update-upstream",params:{id:this.id,returnLink:`/upstreams/${this.id}`},query:this.createRedirectRouteQuery()}}},mounted(){return this.fetchRecord()},methods:{fetchSchema(){return this.$api.fetchSchema("upstreams")},fetchRecord(){return this.$api.findRecord("upstreams",this.id).then(s=>{this.record=s.data}).catch(ot(this.$router,404,"/404",{replace:!0}))},handleEdit(){this.$router.push({name:this.editRoute.name,params:this.editRoute.params||{id:this.record.id,returnLink:this.$route.fullPath},query:{...this.editRoute.query,...this.createRedirectRouteQuery(),...this.createPostDeleteRouteQuery()}})},confirmDelete(){this.deleteModalModel={record:this.record}}}},Q={class:"upstreams-view"},S={class:"upstream-details"},B={key:0,class:"flex flex-col gap-2 mt-4"},q={class:"flex items-center justify-between"},V={class:"targets-list"};function j(s,c,a,i,t,d){const _=n("Breadcrumbs"),g=n("TagsBlock"),f=n("DetailsHeader"),R=n("EntityConfiguration"),$=n("TargetList"),k=n("DetailContainer"),D=n("EntityDeleteModal");return y(),A("section",Q,[C("section",S,[o(_,{"title-mapping":d.titleMapping},null,8,["title-mapping"]),o(f,{title:d.title,record:t.record,entity:{...a.entity,id:d.id},actions:d.actions},{"below-title":p(()=>[t.record?(y(),A("div",B,[C("div",q,[t.record.tags&&t.record.tags.length?(y(),ct(g,{key:0,tags:t.record.tags},null,8,["tags"])):I("",!0)])])):I("",!0)]),_:1},8,["title","record","entity","actions"])]),o(k,{entity:a.entity,items:t.navItems,"entity-name":"upstream"},{"show-upstream":p(()=>[o(R,{record:t.record,"config-schema":t.configSchema,"edit-route":{name:"update-upstream"},entity:"upstreams","entity-name":"upstream","flatten-actions":""},null,8,["record","config-schema"])]),"upstream-targets":p(()=>[C("section",V,[o($,{"upstream-id":d.id},null,8,["upstream-id"])])]),_:1},8,["entity","items"]),o(D,{modelValue:t.deleteModalModel,"onUpdate:modelValue":c[0]||(c[0]=M=>t.deleteModalModel=M),entity:a.entity.rootPath,"redirect-route":t.redirectRouteAfterDelete,"entity-name":"Upstream",class:"defaultModal"},null,8,["modelValue","entity","redirect-route"])])}v=at(x,[["render",j]])});export{Qt as __tla,v as default};
