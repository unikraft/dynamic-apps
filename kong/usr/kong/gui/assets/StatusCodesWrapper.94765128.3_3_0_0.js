/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{_ as v,ad as Dt,r as m,o,c as l,a as i,t as u,b as g,d as w,h as b,af as T,V as y,j as V,R as x,U as Lt,l as k,E as _t,p as F,e as B,H as Tt,z as Vt,Q as Ft,m as Bt,Z as It,w as S,k as I,ah as P,G as Pt,__tla as Ot}from"./index.84d84090.3_3_0_0.js";import{C as zt,__tla as At}from"./ChartDataController.a765a4e0.3_3_0_0.js";import{C as $t,__tla as jt}from"./ChartHeader.0a2c695d.3_3_0_0.js";import{T as Rt,__tla as Et}from"./TimeFramePicker.465b75eb.3_3_0_0.js";import{o as Nt}from"./TimeFrames.25a2a20b.3_3_0_0.js";import{L as Ht,a as Ut,__tla as Wt}from"./VitalsDisabled.f093ed15.3_3_0_0.js";import{C as Kt,_ as Mt,__tla as qt}from"./LineChartWrapper.be3dd56e.3_3_0_0.js";import{a as O,c as Gt,i as Qt,h as Zt,A as Jt}from"./chartHelpers.1bf67333.3_3_0_0.js";let D,z,Xt=Promise.all([(()=>{try{return Ot}catch{}})(),(()=>{try{return At}catch{}})(),(()=>{try{return jt}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return Wt}catch{}})(),(()=>{try{return qt}catch{}})()]).then(async()=>{const A={name:"StatusCodesChart",components:{LineChart:Ht,ChartTooltip:Kt},extends:Mt,props:{entity:{type:Object,default:()=>({})},stacked:{type:Boolean,default:!0},chartBackgroundColor:{type:String,default:null},padding:{type:Object,default:()=>({top:0,bottom:0,right:0,left:0})}},data(){return{colors:{"1xx":{h:49,s:90,l:69},"2xx":{h:146,s:70,l:62},"3xx":{h:208,s:90,l:75},"4xx":{h:0,s:90,l:62},"5xx":{h:245,s:40,l:60},nonStandard:{h:0,s:0,l:75}},counters:{},options:{layout:{},hover:{mode:"index",intersect:!1,animationDuration:0},animation:{duration:0},plugins:{legend:{display:!1,position:"bottom"},tooltip:{enabled:!1,mode:"index",intersect:!1,titleFont:{size:8},bodyFont:{size:8},caretSize:0,caretPadding:0,xPadding:0,itemSort:(t,e)=>t.datasetIndex>e.datasetIndex?-1:t.datasetIndex<e.datasetIndex?1:0,external:this.drawTooltip,callbacks:{label:this.formatTooltipLabel}}},elements:{point:{radius:0,hitRadius:4,hoverRadius:4}},scales:{xAxes:[{grid:{display:!1,drawTicks:!1,drawBorder:!1},ticks:{callback:this.timeTicksFormat,padding:10,source:"labels",autoSkip:!1,display:!0},type:"time",time:{parser:this.timeParser,tooltipFormat:"h:mm:ss a",displayFormats:{second:"h:mm:ss a",minute:"h:mm:ss a"}}}],yAxes:[{ticks:{maxTicksLimit:5},id:"y-axis-main",stacked:!0,grid:{drawBorder:!1,display:!0,drawTicks:!1,lineWidth:function(t){return t.tick.value===0?2:1}}}]},responsive:!0,maintainAspectRatio:!1}}},computed:{stats(){return this.rawData&&this.rawData.stats&&this.rawData.stats.cluster?this.rawData.stats.cluster:{}},meta(){return this.rawData&&this.rawData.meta?this.rawData.meta:{}},formattedTotal(){return this.toCommaNumberStr(this.counters.total)},timestampKeys(){return Object.keys(this.stats)},chartAriaLabel(){var a,c,r,s;const t=["Line chart showing the number of requests",...this.entity?[`of ${this.entity.name} ${this.entity.id}`]:[]],e=(c=(a=this.timeFrame)==null?void 0:a.text)==null?void 0:c.toLowerCase();if(e){t.push(`in ${e}.`);const h=[];(s=(r=this.chartData)==null?void 0:r.datasets)==null||s.forEach(n=>{const p=n.data.reduce((f,C)=>{const d={...f};return(!d.min||d.min.y>C.y)&&(d.min=C),(!d.max||d.max.y<C.y)&&(d.max=C),d},{min:null,max:null});if(p.max){const f=Dt(p.max.x*1e3),C=this.isUtc?f.utc().format("LT UTC on LL"):f.format("LT on LL"),d=p.max.y%1===0?Number.parseInt(p.max.y):p.max.y;h.push(`As for ${n.label} statuses, the most recent maximum value ${d} appears at ${C}.`)}}),t.push(h.join(" "))}return t.join(" ")},chartCanvasAttrs(){return{role:"img","aria-label":this.chartAriaLabel,"aria-live":"polite"}}},mounted(){this.options.scales.yAxes[0].stacked=this.stacked,this.options.layout.padding=this.padding||{top:0,bottom:0,right:0,left:0}},methods:{toCommaNumberStr:O,getColor(t,e){const a=this.colors[`${t.charAt(0)}xx`]||this.colors.nonStandard;return this.getHslaFromColorObj(a,e)},formatTooltipLabel:Gt,isNonStandardClass:Qt,getChartData:Zt}},$={class:"row"},j={class:"col text-right mb-2"},R=w(" in the "),E=["data-codes-loaded"];function N(t,e,a,c,r,s){const h=m("LineChart"),n=m("ChartTooltip");return o(),l("section",null,[i("div",$,[i("div",j,[i("strong",null,u(s.formattedTotal),1),R,i("strong",null,u(t.timeFrame.text),1)])]),i("div",{"data-codes-loaded":s.formattedTotal,class:"row status-codes-chart"},[g(h,{"chart-background-color":a.chartBackgroundColor,height:t.height,"chart-data":t.chartData,"canvas-attrs":s.chartCanvasAttrs,options:r.options,class:"col-12 mb-2"},null,8,["chart-background-color","height","chart-data","canvas-attrs","options"]),g(n,{"tooltip-model":t.tooltipModel,title:"Status Codes"},null,8,["tooltip-model"])],8,E)])}const H=v(A,[["render",N]]),U={name:"PercentItem",props:{color:{type:String,default:null},title:{type:String,default:null},subTitle:{type:String,default:null},count:{type:Number,default:0},total:{type:Number,default:0}},data(){return{style:{}}},computed:{strCount(){return this.toCommaNumberStr(this.count)},percentStr(){let t="0.00";return this.count!==0&&this.total!==0&&(t=Number.parseFloat(this.count/this.total*100).toFixed(2)),`${t}%`}},watch:{percentStr:{handler:"setStyle",immediate:!0}},methods:{toCommaNumberStr:O,setStyle(){setTimeout(()=>{this.style={"--after-background":this.color,"--after-width":this.percentStr}},50)}}},W={class:"code"},K={class:"title"},M={key:0,class:"sub-title"},q={class:"count"},G={class:"percentage mr-4 text-muted"};function Q(t,e,a,c,r,s){return o(),l("tr",{style:T(r.style),class:"percent-item align-items-center"},[i("td",W,[i("span",K,u(a.title),1),a.subTitle?(o(),l("span",M,u(a.subTitle),1)):b("",!0)]),i("td",q,[w(u(s.strCount)+" ",1),i("span",G," ("+u(s.percentStr)+") ",1)])],4)}const Z={name:"PercentList",components:{PercentItem:v(U,[["render",Q],["__scopeId","data-v-0b24b21c"]])},props:{category:{type:Object,default:()=>({})},value:{type:Object,default:()=>({})},list:{type:Array,default:()=>[{}]},onClick:{type:Function,default:()=>{}},itemsAreLinks:{type:Boolean,default:!1}},data(){return{sortType:null,catSort:-1,valSort:1,sortFunction:()=>0}},computed:{percentItemClass(){return{"item-link":this.itemsAreLinks}},sortedList(){return[...this.list].sort(this.sortFunction).filter(t=>t&&t.title)},total(){return this.list.reduce((t,e)=>e?t+e.count:t,0)}},mounted(){this.sortList(this.value.key,"valSort")},methods:{sortWithPriority:Jt,sortClass(t){return{"inactive-sort":this.sortType!==t}},sortList(t,e){this[e]*=-1,this.sortType=e,this.sortFunction=(a,c)=>this[e]*this.sortWithPriority(a[t],c[t])}}},J={class:"percent-list"},X={class:"material-icons sort-icon"},Y={key:0},tt={key:1},et={class:"material-icons sort-icon"},at={key:0},st={key:1},it={key:0},rt={key:0,class:"empty-list"};function ot(t,e,a,c,r,s){const h=m("PercentItem");return o(),l(x,null,[i("table",J,[i("thead",null,[i("tr",null,[i("th",null,[i("div",{class:y([s.sortClass("catSort"),"mr-auto sort-toggle d-flex"]),role:"button",tabindex:"0",onKeyup:e[0]||(e[0]=V(n=>s.sortList(a.category.key,"catSort"),["enter"])),onClick:e[1]||(e[1]=n=>s.sortList(a.category.key,"catSort"))},[i("span",null,u(a.category.text),1),i("i",X,[r.catSort>0?(o(),l("span",Y,"\uE316")):(o(),l("span",tt,"\uE313"))])],34)]),i("th",null,[i("div",{class:y([s.sortClass("valSort"),"sort-toggle count d-flex"]),role:"button",tabindex:"0",onKeyup:e[2]||(e[2]=V(n=>s.sortList(a.value.key,"valSort"),["enter"])),onClick:e[3]||(e[3]=n=>s.sortList(a.value.key,"valSort"))},[i("span",null,u(a.value.text),1),i("i",et,[r.valSort>0?(o(),l("span",at,"\uE316")):(o(),l("span",st,"\uE313"))])],34)])])]),s.sortedList.length>0?(o(),l("tbody",it,[(o(!0),l(x,null,Lt(s.sortedList,n=>(o(),k(h,_t(n,{key:n.title,total:s.total,class:s.percentItemClass,onClick:p=>a.onClick(n)}),null,16,["total","class","onClick"]))),128))])):b("",!0)]),s.sortedList.length===0?(o(),l("div",rt," No data available ")):b("",!0)],64)}D=v(Z,[["render",ot],["__scopeId","data-v-9d17a840"]]);const lt={name:"VitalsViewSwitcher",props:{activeButton:{type:String,default:"percent",validator:t=>["percent","chart"].indexOf(t)!==-1},handleViewChange:{type:Function,required:!0}}},L=t=>(F("data-v-4d42c918"),t=t(),B(),t),nt={class:"vitals-view-switcher"},ct=L(()=>i("svg",{width:"16",height:"17",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M14.9 14c.2274282 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780107.3780107C15.9535872 14.6745401 16 14.8725718 16 15.1c0 .2274282-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780107.3780107C15.3254599 16.1535872 15.1274282 16.2 14.9 16.2H1.1c-.2274282 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780107-.3780107C.0464128 15.5254599 0 15.3274282 0 15.1c0-.2274282.0464128-.4254599.1335664-.5884229.0871535-.1629629.2150478-.2908572.3780107-.3780107C.6745401 14.0464128.8725718 14 1.1 14h13.8zm-3-4.6666667c.2274282 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780107.3780108.0871536.1629629.1335664.3609946.1335664.5884228 0 .2274283-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780107.3780108-.162963.0871535-.3609947.1335663-.5884229.1335663H1.1c-.2274282 0-.4254599-.0464128-.5884229-.1335663-.1629629-.0871536-.2908572-.2150479-.3780107-.3780108C.0464128 10.8587932 0 10.6607616 0 10.4333333c0-.2274282.0464128-.4254599.1335664-.5884228.0871535-.162963.2150478-.2908573.3780107-.3780108.162963-.0871536.3609947-.1335664.5884229-.1335664h10.8zm-5-4.6666666c.2274282 0 .4254599.0464128.5884229.1335663.1629629.0871536.2908572.2150479.3780107.3780108C7.9535872 5.3412068 8 5.5392384 8 5.7666667c0 .2274282-.0464128.4254599-.1335664.5884228-.0871535.162963-.2150478.2908573-.3780107.3780108-.162963.0871536-.3609947.1335664-.5884229.1335664H1.1c-.2274282 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780107-.3780108C.0464128 6.1921266 0 5.9940949 0 5.7666667c0-.2274283.0464128-.4254599.1335664-.5884229.0871535-.1629629.2150478-.2908572.3780107-.3780108.162963-.0871535.3609947-.1335663.5884229-.1335663h5.8zM14.9 0c.2274282 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780107.3780107C15.9535872.6745401 16 .8725718 16 1.1c0 .2274282-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780107.3780107C15.3254599 2.1535872 15.1274282 2.2 14.9 2.2H1.1c-.2274282 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780107-.3780107C.0464128 1.5254599 0 1.3274282 0 1.1 0 .8725718.0464128.6745401.1335664.5115771.2207199.3486142.3486142.2207199.5115771.1335664.6745401.0464128.8725718 0 1.1 0h13.8z",fill:"#B9B9B9","fill-rule":"nonzero"})],-1)),dt=[ct],ut=L(()=>i("svg",{width:"18",height:"17",xmlns:"http://www.w3.org/2000/svg"},[i("path",{d:"M14.9 1.2c0-.2274282.0464128-.4254599.1335664-.5884229.0871535-.1629629.2150478-.2908572.3780107-.3780107C15.5745401.1464128 15.7725718.1 16 .1c.2274282 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780107.3780107C17.0535872.7745401 17.1.9725718 17.1 1.2V15c0 .2274282-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780107.3780107C16.4254599 16.0535872 16.2274282 16.1 16 16.1c-.2274282 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780107-.3780107C14.9464128 15.4254599 14.9 15.2274282 14.9 15V1.2zm-4.6666667 3c0-.2274282.0464128-.4254599.1335664-.5884229.0871535-.1629629.2150478-.2908572.3780108-.3780107.1629629-.0871536.3609946-.1335664.5884228-.1335664.2274283 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780108.3780107.0871535.162963.1335663.3609947.1335663.5884229V15c0 .2274282-.0464128.4254599-.1335663.5884229-.0871536.1629629-.2150479.2908572-.3780108.3780107-.162963.0871536-.3609946.1335664-.5884229.1335664-.2274282 0-.4254599-.0464128-.5884228-.1335664-.162963-.0871535-.2908573-.2150478-.3780108-.3780107-.0871536-.162963-.1335664-.3609947-.1335664-.5884229V4.2zm-4.6666666 5c0-.2274282.0464128-.4254599.1335663-.5884229.0871536-.1629629.2150479-.2908572.3780108-.3780107C6.2412068 8.1464128 6.4392384 8.1 6.6666667 8.1c.2274282 0 .4254599.0464128.5884228.1335664.162963.0871535.2908573.2150478.3780108.3780107.0871536.162963.1335664.3609947.1335664.5884229V15c0 .2274282-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780108.3780107-.1629629.0871536-.3609946.1335664-.5884228.1335664-.2274283 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780108-.3780107-.0871535-.162963-.1335663-.3609947-.1335663-.5884229V9.2zM.9 13.2c0-.2274282.0464128-.4254599.1335664-.5884229.0871535-.1629629.2150478-.2908572.3780107-.3780107C1.5745401 12.1464128 1.7725718 12.1 2 12.1c.2274282 0 .4254599.0464128.5884229.1335664.1629629.0871535.2908572.2150478.3780107.3780107C3.0535872 12.7745401 3.1 12.9725718 3.1 13.2V15c0 .2274282-.0464128.4254599-.1335664.5884229-.0871535.1629629-.2150478.2908572-.3780107.3780107C2.4254599 16.0535872 2.2274282 16.1 2 16.1c-.2274282 0-.4254599-.0464128-.5884229-.1335664-.1629629-.0871535-.2908572-.2150478-.3780107-.3780107C.9464128 15.4254599.9 15.2274282.9 15v-1.8z",fill:"#B9B9B9","fill-rule":"nonzero"})],-1)),ht=[ut];function mt(t,e,a,c,r,s){return o(),l("div",nt,[i("button",{id:"percent-view",class:y([{active:a.activeButton==="percent"},"toggle"]),onClick:e[0]||(e[0]=h=>a.handleViewChange("percent"))},dt,2),i("button",{id:"chart-view",class:y([{active:a.activeButton==="chart"},"toggle"]),onClick:e[1]||(e[1]=h=>a.handleViewChange("chart"))},ht,2)])}const pt=v(lt,[["render",mt],["__scopeId","data-v-4d42c918"]]);function Ct(t){return localStorage.getItem(t)}function yt(t,e){return localStorage.setItem(t,e)}const gt={name:"StatusCodesWrapper",components:{ChartHeader:$t,PageHeader:Tt,TimeFramePicker:Rt,StatusCodesChart:H,VitalsDisabled:Ut,PercentList:D,VitalsViewSwitcher:pt},mixins:[zt],props:{entity:{type:Object,default:()=>({})},chartDataUrls:{type:Object,default:()=>({})},statusCodeDetailRoute:{type:String,default:""},infoTexts:{type:Object,default:()=>({})},isCardView:{type:Boolean,default:!1},title:{type:String,default:"Status Codes"},asDetailTabContent:{type:Boolean,default:!1}},data(){return{selectedView:null,timeFrameOptions:Nt,chartWrapperClass:null,percentListWrapperClass:null,chartBackgroundColor:null,height:250,stacked:!0,padding:{top:0,bottom:0,right:0,left:0},percentListOptions:{category:{text:"Status Code",key:"title"},value:{text:"Count",key:"count"}},statusCodesList:[],codeClassDescriptions:{"1xx":"Informational","2xx":"Success","3xx":"Redirection","4xx":"Client Errors","5xx":"Server Errors"},charts:{statusCodes:{url:null,rawData:null,chartData:null},codeDetail:{url:null,rawData:null}}}},computed:{statusCode(){return this.$route.params.statusCode},chartKeys(){return this.statusCode?["codeDetail"]:["statusCodes"]},infoText(){const t=this.infoTexts[this.chartKeys];return typeof t=="function"?t(this.statusCode):t},titleStyle(){return{cursor:this.statusCode?"pointer":"auto",marginBottom:"0"}},...Vt(Ft,{docsLink:"docsEnterprise"})},watch:{chartKeys:{handler(){this.fetchData()},deep:!0}},created(){this.handleResolve()},mounted(){this.chartDataUrls&&(this.charts.statusCodes.url=this.chartDataUrls.statusCodes,this.charts.codeDetail.url=this.chartDataUrls.codeDetail),this.selectedView=Ct("statusCodesView")||"percent"},methods:{...Bt(It,["getInfo"]),async handleResolve(){await this.getInfo()},backToStatusCodes(){!this.statusCode||(this.$router.replace({path:this.$route.path.replace(`/code/${this.statusCode}`,"")}),this.fetchData())},handleChartData(t){this.formatPercentList(t.datasets)},viewStatusCodeDetails({title:t}){this.statusCodeDetailRoute&&(this.$router.replace({name:this.statusCodeDetailRoute,params:{statusCode:t}}),this.fetchData())},formatPercentList(t){this.statusCodesList=t.map(e=>{const a={color:e.backgroundColor,title:e.label,count:e.data.reduce((c,{y:r})=>(c+=r,c),0)};return this.codeClassDescriptions[e.label]&&(a.subTitle=" \u2014 "+this.codeClassDescriptions[e.label]),a})},handleViewChange(t){this.selectedView=t,yt("statusCodesView",t)}}},_=t=>(F("data-v-267bcfca"),t=t(),B(),t),bt={key:0,class:"ml-2"},ft=_(()=>i("i",{class:"material-icons"},"\uE5CC",-1)),vt={key:0,class:"ml-2"},wt=_(()=>i("i",{class:"material-icons"},"\uE5CC",-1));function xt(t,e,a,c,r,s){const h=m("VitalsDisabled"),n=m("PageHeader"),p=m("TimeFramePicker"),f=m("VitalsViewSwitcher"),C=m("ChartHeader"),d=m("StatusCodesChart"),kt=m("PercentList");return o(),l("section",null,[g(h,{class:y({"mx-4":a.isCardView}),"vitals-enabled":t.vitalsEnabled},null,8,["class","vitals-enabled"]),g(C,{"info-text":s.infoText,"is-loading":t.vitalsLoading,class:"mb-4"},{title:S(()=>[a.asDetailTabContent?(o(),k(n,{key:1,title:a.title,"no-margin":""},{"title-logo":S(()=>[s.statusCode?(o(),l("span",vt,[wt,w(" "+u(s.statusCode),1)])):b("",!0)]),_:1},8,["title"])):(o(),l(x,{key:0},[i("h5",{style:T(s.titleStyle),onClick:e[0]||(e[0]=(...St)=>s.backToStatusCodes&&s.backToStatusCodes(...St))},u(a.title),5),s.statusCode?(o(),l("h5",bt,[ft,w(" "+u(s.statusCode),1)])):b("",!0)],64))]),"header-controls":S(()=>[g(p,{"show-utc":!s.statusCode,"update-controls":t.updateControls,"is-disabled":!t.vitalsEnabled,options:r.timeFrameOptions},null,8,["show-utc","update-controls","is-disabled","options"]),a.isCardView?(o(),k(f,{key:0,"active-button":r.selectedView,"handle-view-change":s.handleViewChange},null,8,["active-button","handle-view-change"])):b("",!0)]),_:1},8,["info-text","is-loading"]),s.statusCode?b("",!0):(o(),l("div",{key:0,class:y([{"card-view":a.isCardView},"row"])},[I(i("div",{class:y([r.chartWrapperClass,"col-12 mb-2"])},[g(d,{entity:a.entity,padding:r.padding,"chart-background-color":r.chartBackgroundColor,stacked:r.stacked,"vitals-enabled":t.vitalsEnabled,height:r.height,"time-frame":t.timeFrame,"is-utc":t.isUtc,"raw-data":r.charts.statusCodes.rawData,onChartData:s.handleChartData},null,8,["entity","padding","chart-background-color","stacked","vitals-enabled","height","time-frame","is-utc","raw-data","onChartData"])],2),[[P,!a.isCardView||r.selectedView==="chart"]]),I(i("div",{class:y([r.percentListWrapperClass,"col-12 mb-2"])},[g(kt,{"items-are-links":Boolean(a.statusCodeDetailRoute),"on-click":s.viewStatusCodeDetails,category:r.percentListOptions.category,value:r.percentListOptions.value,list:r.statusCodesList},null,8,["items-are-links","on-click","category","value","list"])],2),[[P,!a.isCardView||r.selectedView==="percent"]])],2)),Pt(t.$slots,"statusCodeDetail",{statusCode:s.statusCode,timeFrame:t.timeFrame,vitalsEnabled:t.vitalsEnabled,rawData:r.charts.codeDetail.rawData},void 0,!0)])}z=v(gt,[["render",xt],["__scopeId","data-v-267bcfca"]])});export{D as P,z as S,Xt as __tla};
