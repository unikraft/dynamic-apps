/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{T,__tla as q}from"./entities-plugins.es.44654093.3_3_0_0.js";import{B as F,__tla as G}from"./Breadcrumbs.6127883e.3_3_0_0.js";import{E as x,__tla as B}from"./EntityConfiguration.03651df4.3_3_0_0.js";import{L as O,a as A,__tla as M}from"./LeafFooter.1081afc2.3_3_0_0.js";import{E as z,__tla as H}from"./EntityMixin.2764673d.3_3_0_0.js";import{_ as K,Y as l,aF as j,a4 as d,r as a,c as v,a as N,b as n,l as h,K as Q,E as U,R as D,w as o,o as c,d as m,t as g,h as f,__tla as V}from"./index.84d84090.3_3_0_0.js";import{p as $,__tla as Y}from"./PluginMeta.6ce8b2b4.3_3_0_0.js";import{c as J,__tla as X}from"./CustomSchemas.0e5a07de.3_3_0_0.js";import{c as Z}from"./Plugin.35a28655.3_3_0_0.js";import{R as ee}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as te}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{__tla as re}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import{__tla as ie}from"./monaco-editor.90904fcf.3_3_0_0.js";import"./icon-help.699f8c28.3_3_0_0.js";import{__tla as se}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as ae}from"./EntityFilter.bf4158bc.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./index.6d4e40f9.3_3_0_0.js";import"./ArrayCardContainerFields.468b3825.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";let I,oe=Promise.all([(()=>{try{return q}catch{}})(),(()=>{try{return G}catch{}})(),(()=>{try{return B}catch{}})(),(()=>{try{return M}catch{}})(),(()=>{try{return H}catch{}})(),(()=>{try{return V}catch{}})(),(()=>{try{return Y}catch{}})(),(()=>{try{return X}catch{}})(),(()=>{try{return te}catch{}})(),(()=>{try{return re}catch{}})(),(()=>{try{return ie}catch{}})(),(()=>{try{return se}catch{}})(),(()=>{try{return ae}catch{}})()]).then(async()=>{const R={name:"LeafPagesPlugin",components:{Breadcrumbs:F,EntityConfiguration:x,LeafHeader:O,LeafFooter:A,PluginIcon:T},mixins:[z,ee],props:{updatePathName:{type:String,default:"update-plugin"},returnLinkPath:{type:String,default:""},disableUpdateEntities:{type:Array,default:()=>[]},isAppRegistrationPlugin:{type:Boolean,default:!1},consumerId:{type:String,required:!1,default:""},serviceId:{type:String,required:!1,default:""},routeId:{type:String,required:!1,default:""}},data(){const{plugin:e}=this.$route.params;return{record:null,service:null,route:null,consumer:null,configSchema:null,pluginConfigSchema:null,skeletonProps:{"table-rows":2,"table-columns":2,type:"table"},defaultFormSchema:{enabled:{type:"switch",model:"enabled",label:"Enabled",textOn:"This plugin is Enabled",textOff:"This plugin is Disabled",inputType:"hidden",styleClasses:"field-switch top-border bottom-border hide-label",default:!0},name:{default:e,type:"input",inputType:"hidden",styleClasses:"d-none"},selectionGroup:{type:this.hideForeign?"foreign":"selectionGroup",inputType:"hidden",styleClasses:"bottom-border",fields:[{label:"Global",description:"All Gateway Services, Routes, and Consumers"}]}}}},computed:{plugin(){const e=this.$route.params.plugin;return $[e]?$[e].name:e},resourceEndpoint(){return`plugins/${this.id}`},id(){return this.$route.params.pluginId},parentId(){return this.$route.params.id},parentRecord(){return this.$route.name.startsWith("service-")?this.service:this.$route.name.startsWith("route-")?this.route:this.$route.name.startsWith("consumer-")?this.consumer:null},generalConfig(){if(!this.record)return{};const{config:e,...i}=this.record;return i},pluginConfig(){return this.record?this.record.config:{}},isLoading(){return!this.record},title(){return this.isLoading?"Loading...":this.record.username},titleMapping(){let e;this.$route.name.startsWith("service-")?e="services":this.$route.name.startsWith("route-")?e="routes":this.$route.name.startsWith("consumer-")&&(e="consumers");let i=this.parentRecord?l(this.parentRecord,e):this.parentId;return j(i)&&(i=i.split("-")[0].trim()),{id:i,pluginId:this.$route.params.plugin}},viewRoute(){return{name:"view-plugin",params:{plugin:this.$route.params.plugin,id:this.$route.params.pluginId},query:{...this.createRedirectRouteQuery(),consumerId:this.consumerId,serviceId:this.serviceId,routeId:this.routeId}}},editRoute(){return{name:"update-plugin",params:{plugin:this.$route.params.plugin,id:this.$route.params.pluginId},query:{...this.createRedirectRouteQuery(),consumerId:this.consumerId,serviceId:this.serviceId,routeId:this.routeId}}},model(){return this.consumerId?`consumers/${this.consumerId}/plugins`:this.serviceId?`services/${this.serviceId}/plugins`:this.routeId?`routes/${this.routeId}/plugins`:"plugins"}},beforeMount(){this.getPluginSchema().then(e=>{const i=J[this.$route.params.plugin],_=this.parseSchema({...Z,...Object.assign({},...e.fields)});this.configSchema={..._.schema.fields.reduce((u,{model:r,...s})=>({...u,[r]:s}),{}),...i},this.pluginConfigSchema=Object.entries(this.configSchema).reduce((u,[r,s])=>(r.startsWith("config-")&&(u[r.substring(7)]=s),u),{})}).catch(e=>{this.error=e})},mounted(){this.fetchRecord().then(e=>(this.fetchParentRecords(),e))},methods:{fetchRecord(){return this.$api.findRecord(this.model,this.id).then(e=>{this.record=e.data}).catch(d(this.$router,404,"/404",{replace:!0}))},async fetchParentRecords(){this.record.service&&this.record.service.id&&(this.$route.name.startsWith("service-")&&this.parentId!==this.record.service.id&&this.$router.replace({path:"/404"}),this.$api.findRecord("services",this.record.service.id).then(e=>{this.service=e.data,this.record.service={id:this.record.service.id,name:l(this.service,"service")}}).catch(d(this.$router,404,"/404",{replace:!0}))),this.record.route&&this.record.route.id&&(this.$route.name.startsWith("route-")&&this.parentId!==this.record.route.id&&this.$router.replace({path:"/404"}),this.$api.findRecord("routes",this.record.route.id).then(e=>{this.route=e.data,this.record.route={id:this.record.route.id,name:l(this.route,"routes")}}).catch(d(this.$router,404,"/404",{replace:!0}))),this.record.consumer&&this.record.consumer.id&&(this.$route.name.startsWith("consumer-")&&this.parentId!==this.record.consumer.id&&this.$router.replace({path:"/404"}),this.$api.findRecord("consumers",this.record.consumer.id).then(e=>{this.consumer=e.data,this.record.consumer={id:this.record.consumer.id,name:l(this.consumer,"consumers")}}).catch(d(this.$router,404,"/404",{replace:!0})))},getPluginSchema(){return this.$api.findRecord("schemas/plugins",this.$route.params.plugin).then(e=>e.data).catch(d(this.$router,404,"/404",{replace:!0}))}}},b={class:"plugins-view plugins-details-wrapper"},w={class:"plugins-details"};function S(e,i,_,u,r,s){const k=a("Breadcrumbs"),P=a("KSkeleton"),C=a("PluginIcon"),W=a("LeafHeader"),p=a("router-link"),y=a("EntityConfiguration"),L=a("LeafFooter");return c(),v("article",b,[N("section",w,[n(k,{"title-mapping":s.titleMapping},null,8,["title-mapping"]),r.record?(c(),v(D,{key:1},[n(W,{record:r.record,"view-route":s.viewRoute,"edit-route":s.editRoute,entity:"plugins"},{icon:o(()=>[n(C,{name:e.$route.params.plugin,class:"plugin-icon"},null,8,["name"])]),_:1},8,["record","view-route","edit-route"]),n(y,{record:s.generalConfig,"config-schema":r.configSchema,"header-size":5,class:"plugin-general-config","header-title":"General configuration","hide-actions":"",entity:"plugins","entity-name":"plugin",onUpdateRecord:i[0]||(i[0]=(t,E)=>r.record[t]=E)},{service:o(({value:t})=>[t&&t.id?(c(),h(p,{key:0,to:{name:"show-service",params:{id:t.id,workspace:e.workspace}},"data-testid":"goto-service"},{default:o(()=>[m(g(t.name||t.id),1)]),_:2},1032,["to"])):f("",!0)]),route:o(({value:t})=>[t&&t.id?(c(),h(p,{key:0,to:{name:"show-route",params:{id:t.id,workspace:e.workspace}},"data-testid":"goto-route"},{default:o(()=>[m(g(t.name||t.id),1)]),_:2},1032,["to"])):f("",!0)]),consumer:o(({value:t})=>[t&&t.id?(c(),h(p,{key:0,to:{name:"show-consumer",params:{id:t.id,workspace:e.workspace}},"data-testid":"goto-consumer"},{default:o(()=>[m(g(t.name||t.id),1)]),_:2},1032,["to"])):f("",!0)]),_:1},8,["record","config-schema"]),n(y,{"config-schema":r.pluginConfigSchema,"header-size":5,record:s.pluginConfig,class:"plugin-specific-config","header-title":"Plugin specific configuration","hide-actions":"",entity:""},null,8,["config-schema","record"]),n(L,{record:r.record,"view-route":s.viewRoute,entity:"plugins"},null,8,["record","view-route"])],64)):(c(),h(P,Q(U({key:0},r.skeletonProps)),null,16))])])}I=K(R,[["render",S],["__scopeId","data-v-df843795"]])});export{oe as __tla,I as default};
