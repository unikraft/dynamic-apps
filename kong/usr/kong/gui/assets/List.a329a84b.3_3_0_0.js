/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{ag as ae,aw as Yt,B as h,C as A,ak as ce,ax as ke,r as M,o as T,c as D,b as k,O as de,ay as s,w as u,d as z,t as $,h as Z,k as pe,ah as me,l as H,a as B,R as Ie,U as ge,i as Zt,G as se,az as Re,aA as Ve,aB as Xt,n as ea,q as ta,y as aa,aD as oa,__tla as ra}from"./index.84d84090.3_3_0_0.js";import{u as sa,a as na,b as fe,__tla as la}from"./useRbacPermission.15766885.3_3_0_0.js";import{u as ua,__tla as ia}from"./useRedirect.ccdc1330.3_3_0_0.js";import{__tla as ca}from"./monaco-editor.90904fcf.3_3_0_0.js";let Fe,da=Promise.all([(()=>{try{return ra}catch{}})(),(()=>{try{return la}catch{}})(),(()=>{try{return ia}catch{}})(),(()=>{try{return ca}catch{}})()]).then(async()=>{const je={list:{table_headers:{name:"Name",consumers_count:"Consumers",tags:"Tags",id:"ID"},empty_state:{title:"Configure a New Consumer Group",description:"Use consumer groups to manage custom rate limiting configuration for subsets of consumers.",title_for_consumer:"Add to a Consumer Group"},toolbar_actions:{new_consumer_group:"New Consumer Group"}},title:"Consumer Groups",search:{placeholder:"Filter by exact name or ID"},actions:{add_to_group:"Add to Consumer Group",create:"New Consumer Group",copy_id:"Copy ID",copy_json:"Copy JSON",edit:"Edit",delete:"Delete",exit:"Exit",view:"View Details"},delete:{title:"Delete a Consumer Group",description:"Deleting this group will remove this group from all plugins and its rate limit configuration. This action cannot be reversed."},consumers:{add:{title:"Add To Consumer Groups",ctaText:"Add this consumer to consumer groups",consumer_groups_label:"Consumer Groups",consumer_group_placeholder:"Add to consumer groups",footer:"Search by exact name or ID to find consumer groups not included in the list"},exit:{title:"Exit from a Consumer Group",confirmation:"Are you sure you want to remove consumer {consumer} from consumer group {consumerGroup}?",confirmationNoUsername:"Are you sure you want this consumer to exit from consumer group {consumerGroup}?",description:"Exiting from the group could change the rate limit policy applied to this consumer."}},errors:{general:"Consumer Groups could not be retrieved",delete:"The consumer group could not be deleted at this time.",copy:"Failed to copy to clipboard",add:"The consumer could not be added to some groups at this time.",already_added:"The consumer is already in this consumer group",add_consumer:"An unexpected error occurred while adding consumers. Please try again.",remove_consumer:"An unexpected error occurred while removing consumers. Please try again."},copy:{success:"Copied {val} to clipboard",success_brief:"Successfully copied to clipboard"},form:{general_info:{title:"General Information",description:"General information will help identify and manage this consumer group."},consumers:{title:"Consumers",description:"Add or remove consumers from this group"},fields:{name:{label:"Name",placeholder:"Enter a unique name for this consumer group "},tags:{label:"Tags",placeholder:"Enter a list of tags seperated by comma",help:"e.g. tag1, tag2. tag3",tooltip:"An optional set of strings for grouping and filtering, separated by commas."},consumers:{label:"Consumers",placeholder:"Select one or more consumers"}},validation_errors:{name:"The name can be any string containing letters, numbers, or the following characters: ., -, _, or ~. Do not use spaces."}}},Ne={consumer_groups:je};function Oe(){const e=Re("en-us",Ne);return{i18n:e,i18nT:Ve(e)}}const Se={useI18n:Oe},J="/api/runtime_groups/{controlPlaneId}",Q="/{workspace}",le={list:{konnect:{all:`${J}/consumer_groups`,forConsumer:`${J}/consumers/{consumerId}/consumer_groups`,oneForConsumer:`${J}/consumers/{consumerId}/consumer_groups/{consumerGroupId}`},kongManager:{all:`${Q}/consumer_groups?counter=true`,forConsumer:`${Q}/consumers/{consumerId}/consumer_groups`,oneForConsumer:`${Q}/consumers/{consumerId}/consumer_groups/{consumerGroupId}`}},form:{konnect:{consumersList:`${J}/consumers`,create:`${J}/consumer_groups`,edit:`${J}/consumer_groups/{id}`,addConsumer:`${J}/consumer_groups/{id}/consumers`,removeConsumer:`${J}/consumer_groups/{id}/consumers/{consumerId}`,getConsumers:`${J}/consumer_groups/{id}/consumers`},kongManager:{consumersList:`${Q}/consumers`,create:`${Q}/consumer_groups`,edit:`${Q}/consumer_groups/{id}`,addConsumer:`${Q}/consumer_groups/{id}/consumers`,removeConsumer:`${Q}/consumer_groups/{id}/consumers/{consumerId}`,getConsumers:`${Q}/consumer_groups/{id}/consumers`}}};function ye(e={}){return{axiosInstance:Xt.create({withCredentials:!0,timeout:3e4,...e})}}function Le(e,r){const o=s(r),t=A(()=>e.apiBaseUrl.startsWith("/")?new URL(`${window.location.origin}${o}`):new URL(o));return t.value.search="",l=>`${t.value.href}/${l}`}const Ge={message:"Are you sure you want to delete this {entityType}?",messageWithName:"Are you sure you want to delete this {entityType} {entityName}?"},De={actions:{save:"Save",cancel:"Cancel",back:"Back"},errors:{edit:"The entity could not be edited at this time."}},ze={emptyState:{noSearchResultsTitle:"No results found",noSearchResultsMessage:"Please adjust the criteria and try again.",noSearchResultsCtaText:"Clear"}},He={filterButtonText:"Filter",fieldLabel:"Filter by:",inputPlaceholder:"Enter a value",selectPlaceholder:"Select an item",applyButtonText:"Apply",clearButtonText:"Clear",clearAllButtonText:"Clear all filters"},We={errors:{fetch:"Could not fetch available items",invalid:"Please select a valid value"}},Je={unexpected:"An unexpected error has occurred"},Qe={enable:{title:"Enable {entityType}",message:"Are you sure you want to enable the {entityType} {entityName}?",confirmText:"Yes, enable"},disable:{title:"Disable {entityType}",message:"Are you sure you want to disable the {entityType} {entityName}?",confirmText:"Yes, disable"}},Ye={deleteModal:Ge,baseForm:De,baseTable:ze,filter:He,debouncedFilter:We,errors:Je,toggleModal:Qe};function ve(){const e=Re("en-us",Ye);return{i18n:e,i18nT:Ve(e)}}function Ze(){const{i18n:{t:e}}=ve();return{getMessageFromError:r=>{var o,t,l;if(!r)return e("errors.unexpected");if((o=r==null?void 0:r.response)!=null&&o.data){if(r.response.data.detail)return r.response.data.detail;if((t=r.response.data.details)!=null&&t.length)return r.response.data.details.map(a=>{let g=e("errors.unexpected");return a.messages&&typeof a.messages=="object"&&a.messages.length&&(g=a.messages.join(", ")),a.field?`${a.field} - ${g}`:g}).join("; ");if(r.response.data.message){const{message:a}=r.response.data;return Array.isArray(a)?(l=a[0])!=null&&l.constraints?Object.values(a[0].constraints)[0]:a[0]:a}if(typeof r.response.data=="string")return r.response.data;if(typeof r.response.data=="object")return Object.keys(r.response.data).map(a=>`${a} ${r.response.data[a]}`).join(", ")}return r.message||e("errors.unexpected")}}}function Te(e,r){const o=h(s(e)),t=h(s(r)),l=A(()=>!!(o.value.app==="konnect"||o.value.isExactMatch)),a=A(()=>t.value.startsWith("/")?new URL(`${window.location.origin}${t.value}`):new URL(t.value));return g=>{const{page:P,pageSize:v,offset:d,sortColumnKey:I,sortColumnOrder:y,query:E}=g;try{let K=new URL(a.value.href);return l.value&&E?(K.search="",K=new URL(`${K.href}/${E}/`)):(l.value||new URLSearchParams(E).forEach((q,i)=>{K.searchParams.append(i,q)}),I&&K.searchParams.append("sort_by",I),y==="desc"&&K.searchParams.append("sort_desc","1"),K.searchParams.append("size",String(v))),d&&P!==1&&K.searchParams.append("offset",String(d)),K.href}catch(K){return console.error("RouteList(fetcher)",K),t.value}}}function Xe(){return{debounce:(e,r)=>{let o;return(...t)=>{clearTimeout(o),o=window==null?void 0:window.setTimeout(()=>{e(...t)},r)}}}}const he="khcp-user-table-preferences",et={pageSize:30,sortColumnKey:void 0,sortColumnOrder:void 0};function tt(){const e=o=>{if(typeof o=="string")try{return JSON.parse(o)}catch(t){console.error("useTablePreferences(tryParseJson)",t);return}},r=()=>{const o=e(localStorage.getItem(he));return!o||!Object.keys(o).length?new Map:new Map(Object.entries(o))};return{setTablePreferences:(o,t)=>{try{const l=r();l.set(o,t),localStorage.setItem(he,JSON.stringify(Object.fromEntries(l.entries())))}catch(l){console.error("useTablePreferences(setTablePreferences)",l)}},getTablePreferences:o=>{const t=r();return(t==null?void 0:t.get(o))||void 0||et},deleteAllTablePreferences:()=>{localStorage.removeItem(he)}}}function at(e,r,o,t={fetchedItemsKey:"data",searchKeys:["id"]}){o||(o="100");const{axiosInstance:l}=ye({headers:e.requestHeaders}),{i18n:{t:a}}=ve(),{debounce:g}=Xe(),P=g(async p=>{await f(p)},200),v=h(!1),d=h(""),I=h(""),y=h([]),E=h(void 0),K=s(r);let q=`${e.apiBaseUrl}${K}`;e.app==="konnect"?q=q.replace(/{controlPlaneId}/gi,(e==null?void 0:e.controlPlaneId)||""):e.app==="kongManager"&&(q=q.replace(/{workspace}/gi,(e==null?void 0:e.workspace)||""));const i=async()=>{try{v.value=!0;const{data:p}=await l.get(`${q}?size=${o}`);p!=null&&p.next||(E.value=t.fetchedItemsKey in p?p[t.fetchedItemsKey]:[]),y.value=t.fetchedItemsKey in p?p[t.fetchedItemsKey]:[]}catch{y.value=[],d.value=a("debouncedFilter.errors.fetch")}finally{v.value=!1}},m=h(""),f=async p=>{var b,j;if(m.value!==p)if(m.value=p||"",E.value===void 0)try{v.value=!0,d.value="",I.value="";let c=q+"";p&&(c+=`/${p}`);const{data:x}=await l.get(`${c}?size=${o}`);t.fetchedItemsKey in x?y.value=x[t.fetchedItemsKey]:x!=null&&x.id?y.value=[x]:y.value=[]}catch(c){((b=c==null?void 0:c.response)==null?void 0:b.status)===404?I.value=a("debouncedFilter.errors.invalid"):(y.value=[],d.value=a("debouncedFilter.errors.fetch"))}finally{v.value=!1}else v.value=!0,I.value="",p?(y.value=(j=E.value)==null?void 0:j.filter(c=>{var x;let w=!1;for(const L of t.searchKeys){const R=typeof c[L]=="string"?(x=c[L])==null?void 0:x.toLowerCase():c[L];R!=null&&R.includes(p.toLowerCase())&&(w=!0)}return w}),(!y.value||!y.value.length)&&(I.value=a("debouncedFilter.errors.invalid"))):y.value=E.value,v.value=!1};return{loading:v,error:d,validationError:I,results:y,allRecords:E,loadItems:i,debouncedQueryChange:P}}var $e=(e=>(e.GatewayService="service",e.Route="route",e.Consumer="consumer",e.ConsumerGroup="consumer group",e.Plugin="plugin",e.Upstream="upstream",e.Certificate="certificate",e.CACertificate="ca certificate",e.SNI="SNI",e.Key="key",e.KeySet="key set",e.Vault="vault",e.Application="application",e.Developer="developer",e.acls="ACL Credential",e["basic-auth"]="Basic Auth Credential",e["key-auth"]="Key Auth Credential",e["key-auth-enc"]="Key Auth Encrypted Credential",e.oauth2="OAuth 2.0 Credential",e["hmac-auth"]="HMAC Credential",e.jwt="JWT Credential",e.Target="target",e))($e||{}),Y=(e=>(e[e.Loading=0]="Loading",e[e.Idle=1]="Idle",e[e.NoResults=2]="NoResults",e[e.Error=3]="Error",e))(Y||{});function ot(e,r,o="data"){const t=s(r),{axiosInstance:l}=ye({headers:e.requestHeaders}),a=Te(e,t),g=h({status:Y.Idle});return{fetcher:async P=>{try{g.value={status:Y.Loading};const v=a(P),{data:d}=await l.get(v),I=o&&o.replace(/[^\w-_]/gi,"");let y;d[I]&&Array.isArray(d[I])?y=d[I]:y=Object.keys(d).length?[d]:[];const E={data:y,total:y.length,...d.offset?{pagination:{offset:d.offset}}:null};return g.value={status:Y.Idle,response:E},E}catch(v){const d={data:[],total:0};return P.query&&v.response.status===404?(g.value={status:Y.NoResults,response:d,error:v},d):(g.value={status:Y.Error,response:d,error:v},d)}},fetcherState:g}}const ue={useAxios:ye,useDeleteUrlBuilder:Le,useErrors:Ze,useFetchUrlBuilder:Te,useDebouncedFilter:at,useFetcher:ot,useI18n:ve},be=(e,r)=>{const o=e.__vccOpts||e;for(const[t,l]of r)o[t]=l;return o},rt={class:"toolbar-container"},st={key:0,class:"toolbar-button-container"},nt=["data-testid"],lt=ae({__name:"EntityBaseTable",props:{tableHeaders:{type:Object,required:!0,default:()=>({})},fetcher:{type:Function,required:!0,default:async()=>({data:[],total:0})},initialFetcherParams:{type:Object,default:null},fetcherCacheKey:{type:Number,default:1},isLoading:{type:Boolean,default:!1},query:{type:String,default:""},enableClientSort:{type:Boolean,default:!1},enableEntityActions:{type:Boolean,default:!0},emptyStateOptions:{type:Object,default:()=>({})},errorMessage:{type:String,default:""},disablePaginationPageJump:{type:Boolean,default:void 0},disableSorting:{type:Boolean,default:void 0},paginationType:{type:String,default:void 0},cellAttributes:{type:Function,default:()=>({})},rowAttributes:{type:Function,default:()=>({})},preferencesStorageKey:{type:String,default:"",required:!0},dropdownMenuWidth:{type:String,default:"",required:!1}},emits:["click:row","sort","clear-search-input","empty-state-cta-clicked"],setup(e,{emit:r}){const o=e,{i18n:{t}}=ue.useI18n(),l=A(()=>{const i=[];return Object.keys(o.tableHeaders).forEach(m=>{const f=o.tableHeaders[m];i.push({label:f.label??m,key:m,sortable:f.sortable??!1})}),o.enableEntityActions&&i.push({key:"actions",hideLabel:!0}),i}),a=i=>({"data-rowid":i.id,"data-testid":i.name,...o.rowAttributes(i)}),g=i=>({"data-testid":i.headerKey,...o.cellAttributes(i)}),P=()=>{r("empty-state-cta-clicked"),v()},v=()=>{r("clear-search-input")},d=(i,m)=>{r("click:row",m)},I=i=>{r("sort",i)},{setTablePreferences:y,getTablePreferences:E}=tt(),K=A(()=>{const i=E(o.preferencesStorageKey);return{...o.initialFetcherParams,...i}}),q=i=>{o.preferencesStorageKey&&y(o.preferencesStorageKey,i)};return(i,m)=>{const f=M("KIcon"),p=M("KButton"),b=M("KDropdownMenu"),j=M("KTable"),c=M("KCard");return T(),H(c,{class:"kong-ui-entity-base-table"},{body:u(()=>[k(j,{"cell-attrs":g,"disable-pagination-page-jump":e.disablePaginationPageJump,"disable-sorting":e.disableSorting,"empty-state-action-button-icon":e.query?"":"plus","empty-state-action-message":e.query?s(t)("baseTable.emptyState.noSearchResultsCtaText"):e.emptyStateOptions.ctaText,"empty-state-action-route":e.query?"":e.emptyStateOptions.ctaPath,"empty-state-icon":e.query?"stateNoSearchResults":"stateGruceo","empty-state-icon-size":"96","empty-state-message":e.query?s(t)("baseTable.emptyState.noSearchResultsMessage"):e.emptyStateOptions.message,"empty-state-title":e.query?s(t)("baseTable.emptyState.noSearchResultsTitle"):e.emptyStateOptions.title,"enable-client-sort":e.enableClientSort,"error-state-title":e.errorMessage,fetcher:e.fetcher,"fetcher-cache-key":String(e.fetcherCacheKey),"has-error":!!e.errorMessage,headers:s(l),"hide-pagination-when-optional":"","initial-fetcher-params":s(K),"is-loading":e.isLoading,"pagination-type":e.paginationType,"row-attrs":a,"search-input":e.query,onKtableEmptyStateCtaClicked:P,"onRow:click":d,onSort:I,"onUpdate:tablePreferences":q},de({toolbar:u(()=>[B("div",rt,[se(i.$slots,"toolbar-filter",{},void 0,!0),i.$slots["toolbar-button"]?(T(),D("div",st,[se(i.$slots,"toolbar-button",{},void 0,!0)])):Z("",!0)])]),actions:u(({row:x,rowKey:w,rowValue:L})=>[B("div",{class:"actions-container","data-testid":x.name},[k(b,{"kpop-attributes":{placement:"bottomEnd"},width:e.dropdownMenuWidth},{items:u(()=>[se(i.$slots,"actions",{row:x,rowKey:w,rowValue:L},void 0,!0)]),default:u(()=>[k(p,{class:"non-visual-button","data-testid":"overflow-actions-button",size:"small"},{icon:u(()=>[k(f,{color:"var(--black-400, #3c4557)",icon:"more",size:"16"})]),_:1})]),_:2},1032,["width"])],8,nt)]),_:2},[ge(e.tableHeaders,(x,w)=>({name:w,fn:u(({row:L,rowKey:R,rowValue:X})=>[se(i.$slots,w,{row:L,rowKey:R,rowValue:X},void 0,!0)])}))]),1032,["disable-pagination-page-jump","disable-sorting","empty-state-action-button-icon","empty-state-action-message","empty-state-action-route","empty-state-icon","empty-state-message","empty-state-title","enable-client-sort","error-state-title","fetcher","fetcher-cache-key","has-error","headers","initial-fetcher-params","is-loading","pagination-type","search-input"])]),_:3})}}}),ut=be(lt,[["__scopeId","data-v-6eab8cd1"]]),it={key:0,class:"kong-ui-entity-delete-error"},ct={key:1,class:"description"},dt=ae({__name:"EntityDeleteModal",props:{visible:{type:Boolean,required:!0,default:!1},title:{type:String,default:"Delete"},entityType:{type:String,required:!0},entityName:{type:String,default:""},needConfirm:{type:Boolean,default:!0},description:{type:String,default:""},actionPending:{type:Boolean,default:!1},error:{type:String,default:""}},emits:["cancel","proceed"],setup(e,{emit:r}){const o=e,{i18nT:t}=ue.useI18n(),l=A(()=>o.needConfirm?o.entityName:""),a=()=>{r("cancel")},g=()=>{r("proceed")};return(P,v)=>{const d=M("KAlert"),I=M("KPrompt");return T(),H(I,{"action-button-text":"Yes, delete","action-pending":e.actionPending,class:"kong-ui-entity-delete-modal","confirmation-text":s(l),"is-visible":e.visible,title:e.title,type:"danger",onCanceled:a,onProceed:g},{"body-content":u(()=>[e.error?(T(),D("div",it,[k(d,{appearance:"danger"},{alertMessage:u(()=>[z($(e.error),1)]),_:1})])):Z("",!0),k(s(t),{class:"message",keypath:o.entityName?"deleteModal.messageWithName":"deleteModal.message",tag:"p"},de({entityType:u(()=>[z($(o.entityType),1)]),_:2},[o.entityName?{name:"entityName",fn:u(()=>[B("strong",null,$(o.entityName),1)]),key:"0"}:void 0]),1032,["keypath"]),o.description||P.$slots.description?(T(),D("div",ct,[se(P.$slots,"description",{},()=>[B("p",null,$(o.description),1)],!0)])):Z("",!0)]),_:3},8,["action-pending","confirmation-text","is-visible","title"])}}}),pt=be(dt,[["__scopeId","data-v-3513e33b"]]),mt={fill:"none",height:"20",viewBox:"0 0 20 20",width:"20",xmlns:"http://www.w3.org/2000/svg"},gt={id:"mask0_180_20349",height:"20",maskUnits:"userSpaceOnUse",style:{"mask-type":"alpha"},width:"20",x:"0",y:"0"},ft=["fill"],yt={mask:"url(#mask0_180_20349)"},vt=["fill"],ht=ae({__name:"IconFilter",props:{color:{type:String,default:"var(--kong-ui-entity-filter-color, var(--blue-500, #1155cb))"}},setup(e){return(r,o)=>(T(),D("svg",mt,[B("mask",gt,[B("rect",{fill:e.color,height:"20",width:"20"},null,8,ft)]),B("g",yt,[B("path",{d:"M8 14.5V13H12V14.5H8ZM5 10.75V9.25H15V10.75H5ZM3 7V5.5H17V7H3Z",fill:e.color},null,8,vt)])]))}}),bt={key:1,class:"kong-ui-entity-filter"},_t={class:"menu-item-title"},wt={class:"menu-item-indicator"},Ct={class:"menu-item-body"},kt=["for"],It={class:"menu-item-buttons"},St=ae({__name:"EntityFilter",props:{config:{type:Object,required:!0,default:()=>({isExactMatch:!0,placeholder:""})},modelValue:{type:String,required:!0}},emits:["update:modelValue"],setup(e,{emit:r}){const o=e,{i18n:{t}}=ue.useI18n(),l=h(!1),a=h({}),g=A(()=>{const m=[];return new URLSearchParams(o.modelValue).forEach((f,p)=>{f!==""&&m.push(p)}),m}),P=A(()=>{const m=o.config.fields;return Object.keys(m).filter(f=>m[f].searchable).map(f=>({label:m[f].label||f,value:f}))});ce(()=>o.modelValue,m=>{a.value={},new URLSearchParams(m).forEach((f,p)=>{a.value[p]=f})});const v=()=>{l.value=!l.value},d=m=>{r("update:modelValue",m)},I=m=>`filter-${m}`,y=m=>{var f,p;return(((p=(f=o.config.schema)==null?void 0:f[m])==null?void 0:p.values)??[]).map(b=>({value:b,label:b}))},E=m=>{var f,p;return((p=(f=o.config.schema)==null?void 0:f[m])==null?void 0:p.type)??"text"},K=m=>{a.value={...a.value,[m]:""},i()},q=()=>{a.value={},i(!0)},i=(m=!1)=>{const f=Object.keys(a.value).reduce((p,b)=>(a.value[b]&&(p[b]=`${a.value[b]}`),p),{});m&&(l.value=!1),r("update:modelValue",new URLSearchParams(f).toString())};return(m,f)=>{const p=M("KInput"),b=M("KButton"),j=M("KSelect"),c=M("KMenuItem"),x=M("KMenu");return e.config.isExactMatch?(T(),H(p,{key:0,autocomplete:"off",class:"kong-ui-entity-filter-input","data-testid":"search-input","model-value":e.modelValue,placeholder:e.config.placeholder,"onUpdate:modelValue":d},{icon:u(()=>[k(ht)]),_:1},8,["model-value","placeholder"])):(T(),D("div",bt,[k(b,{appearance:"btn-link","data-testid":"filter-button",icon:"filter",onClick:v},{default:u(()=>[z($(s(t)("filter.filterButtonText"))+" "+$(s(g).length>0?`(${s(g).length})`:""),1)]),_:1}),pe(B("div",{class:"kong-ui-entity-filter-backdrop",onClick:v},null,512),[[me,l.value]]),pe(k(x,{class:"kong-ui-entity-filter-menu"},{body:u(()=>[(T(!0),D(Ie,null,ge(s(P),(w,L)=>(T(),H(c,{key:w.value,"data-testid":w.value,expandable:"","last-menu-item":L===s(P).length-1},{itemTitle:u(()=>[B("span",_t,[z($(w.label)+" ",1),pe(B("span",wt,null,512),[[me,s(g).includes(w.value)]])])]),itemBody:u(()=>{var R,X;return[B("div",Ct,[B("label",{class:"menu-item-label",for:I(w.value)},$(s(t)("filter.fieldLabel")),9,kt),((X=(R=e.config.schema)==null?void 0:R[w.value])==null?void 0:X.type)==="select"?(T(),H(j,{key:0,id:I(w.value),modelValue:a.value[w.value],"onUpdate:modelValue":C=>a.value[w.value]=C,appearance:"select",items:y(w.value),placeholder:s(t)("filter.selectPlaceholder")},null,8,["id","modelValue","onUpdate:modelValue","items","placeholder"])):(T(),H(p,{key:1,id:I(w.value),modelValue:a.value[w.value],"onUpdate:modelValue":C=>a.value[w.value]=C,autocomplete:"off",placeholder:s(t)("filter.inputPlaceholder"),size:"small",type:E(w.value)},null,8,["id","modelValue","onUpdate:modelValue","placeholder","type"]))]),B("div",It,[k(b,{appearance:"btn-link","data-testid":"apply-filter",size:"small",onClick:f[0]||(f[0]=C=>i(!0))},{default:u(()=>[z($(s(t)("filter.applyButtonText")),1)]),_:1}),k(b,{appearance:"btn-link","data-testid":"clear-filter",size:"small",onClick:C=>K(w.value)},{default:u(()=>[z($(s(t)("filter.clearButtonText")),1)]),_:2},1032,["onClick"])])]}),_:2},1032,["data-testid","last-menu-item"]))),128))]),actionButton:u(()=>[k(b,{onClick:q},{default:u(()=>[z($(s(t)("filter.clearAllButtonText")),1)]),_:1})]),_:1},512),[[me,l.value]])]))}}}),Tt=be(St,[["__scopeId","data-v-fcf9a8f1"]]),ie=ae({__name:"PermissionsWrapper",props:{authFunction:{type:Function,required:!0,default:async()=>!0},forceShow:{type:Boolean,default:!1}},setup(e){const r=e,o=h(void 0),t=A(()=>o.value===!0||o.value!==void 0&&r.forceShow===!0);return ke(async()=>{o.value=await r.authFunction()}),(l,a)=>s(t)?se(l.$slots,"default",{key:0,isAllowed:o.value}):Z("",!0)}}),{useAxios:Pe,useDeleteUrlBuilder:$t,useErrors:pa,useFetchUrlBuilder:ma,useFetcher:Pt,useDebouncedFilter:Kt}=ue,xt={class:"add-to-group-form-container"},At={class:"add-to-group-cta-text"},Et={key:0,class:"kong-ui-entity-add-to-groups-error"},Bt={key:0},Mt=ae({__name:"AddToGroupModal",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.consumerId)},visible:{type:Boolean,required:!0,default:!1}},emits:["cancel","add:success","add:partial-success","error"],setup(e,{emit:r}){var o;const t=e,{i18n:{t:l}}=Se.useI18n(),{axiosInstance:a}=Pe({headers:(o=t.config)==null?void 0:o.requestHeaders}),g=h([]),{debouncedQueryChange:P,loading:v,allRecords:d,error:I,loadItems:y,results:E}=Kt(t.config,le.list[t.config.app].all,"",{fetchedItemsKey:"data",searchKeys:["name","id"]}),K=A(()=>I.value?l("consumer_groups.errors.general"):""),q=h(0),i=A(()=>d.value===void 0),m=A(()=>E.value.map(C=>({label:C.name,value:C.id,selected:g.value.includes(C.id),data:C}))),f=C=>{var V;const U=i.value?E.value.find(F=>F.id===C):(V=d.value)==null?void 0:V.find(F=>F.id===C);return U?U.name:C},p=()=>{c.value="",b.value=[],R.value=[],r("cancel")},b=h([]),j=h(!1),c=h(""),x=async()=>{if(!g.value.length){c.value="",R.value=[],r("cancel");return}j.value=!0,c.value="",b.value=[],R.value=[];try{const C=g.value.map(F=>L(F)),V=await Promise.allSettled(C);let U=!0;V.forEach(F=>{F.status!=="fulfilled"&&(U=!1)}),U?(b.value=[],R.value=[],r("add:success",g.value),g.value=[]):(b.value.length&&r("add:partial-success",b.value),g.value=[],X(V))}catch{c.value=l("consumer_groups.errors.add"),r("error",c.value)}finally{j.value=!1}},w=A(()=>{var C,V,U,F;let N=`${t.config.apiBaseUrl}${le.list[t.config.app].forConsumer}`;return t.config.app==="konnect"?N=N.replace(/{controlPlaneId}/gi,((C=t.config)==null?void 0:C.controlPlaneId)||"").replace(/{consumerId}/gi,((V=t.config)==null?void 0:V.consumerId)||""):t.config.app==="kongManager"&&(N=N.replace(/{workspace}/gi,((U=t.config)==null?void 0:U.workspace)||"").replace(/{consumerId}/gi,((F=t.config)==null?void 0:F.consumerId)||"")),N}),L=async C=>{const V={group:C};try{const U=await a.post(w.value,V);return b.value.push(C),U}catch(U){let F=`${f(C)} - ${U.message}`;return U.response.status===409&&(F=`${f(C)} - ${l("consumer_groups.errors.already_added")}`),Promise.reject(Error(F))}},R=h([]),X=C=>{R.value=C.map(V=>{var U;return(U=V.reason)==null?void 0:U.message}).filter(Boolean)};return ce(m,()=>{q.value++},{immediate:!0,deep:!0}),ke(async()=>{await y()}),(C,V)=>{const U=M("KMultiselect"),F=M("KAlert"),N=M("KPrompt");return T(),H(N,{"action-pending":j.value,class:"kong-ui-entities-add-to-groups-modal","data-testid":"add-to-group-modal","is-visible":e.visible,title:s(l)("consumer_groups.consumers.add.title"),onCanceled:p,onProceed:x},{"body-content":u(()=>[B("div",xt,[B("p",At,$(s(l)("consumer_groups.consumers.add.ctaText")),1),k(U,{modelValue:g.value,"onUpdate:modelValue":V[0]||(V[0]=ee=>g.value=ee),autosuggest:"","data-testid":"add-to-groups-multiselect","dropdown-footer-text":s(i)?s(l)("consumer_groups.consumers.add.footer"):void 0,items:s(m),label:s(l)("consumer_groups.consumers.add.consumer_groups_label"),loading:s(v),placeholder:s(l)("consumer_groups.consumers.add.consumer_group_placeholder"),readonly:j.value,required:"",width:"100%",onQueryChange:s(P)},null,8,["modelValue","dropdown-footer-text","items","label","loading","placeholder","readonly","onQueryChange"]),c.value||s(K)||R.value.length?(T(),D("div",Et,[k(F,{appearance:"danger"},{alertMessage:u(()=>[B("p",null,$(s(l)("consumer_groups.errors.add")),1),R.value.length?(T(),D("ul",Bt,[(T(!0),D(Ie,null,ge(R.value,(ee,oe)=>(T(),D("li",{key:oe},$(ee),1))),128))])):Z("",!0),B("div",null,$(c.value||s(K)),1)]),_:1})])):Z("",!0)])]),_:1},8,["action-pending","is-visible","title"])}}}),Ke=(e,r)=>{const o=e.__vccOpts||e;for(const[t,l]of r)o[t]=l;return o},Ut=Ke(Mt,[["__scopeId","data-v-098ec45f"]]),qt={class:"kong-ui-entities-consumer-groups-list"},Rt={key:1},Vt=ae({__name:"ConsumerGroupList",props:{config:{type:Object,required:!0,validator:e=>!(!e||!["konnect","kongManager"].includes(e==null?void 0:e.app)||!e.createRoute||!e.getViewRoute||!e.getEditRoute||e.app==="kongManager"&&!e.isExactMatch&&!e.filterSchema)},canCreate:{type:Function,required:!1,default:async()=>!0},canDelete:{type:Function,required:!1,default:async()=>!0},canEdit:{type:Function,required:!1,default:async()=>!0},canRetrieve:{type:Function,required:!1,default:async()=>!0}},emits:["error","loading","copy:success","copy:error","delete:success","add:success","remove:success"],setup(e,{emit:r}){var o;const t=e,{i18nT:l,i18n:{t:a}}=Se.useI18n(),g=Yt(),{axiosInstance:P}=Pe({headers:(o=t.config)==null?void 0:o.requestHeaders}),v=h(1),d=A(()=>!!t.config.consumerId),I=A(()=>t.config.app!=="kongManager"||!!t.config.disableSorting),y={name:{label:a("consumer_groups.list.table_headers.name"),searchable:!0,sortable:!0}};t.config.app==="kongManager"&&(y.consumers_count={label:a("consumer_groups.list.table_headers.consumers_count"),searchable:!1,sortable:!1}),y.tags={label:a("consumer_groups.list.table_headers.tags"),sortable:!1};const E=y,K=n=>({"data-testid":n.username??n.custom_id??n.id}),q=A(()=>{var n,_,O,W;let G=`${t.config.apiBaseUrl}${le.list[t.config.app][d.value?"forConsumer":"all"]}`;return t.config.app==="konnect"?G=G.replace(/{controlPlaneId}/gi,((n=t.config)==null?void 0:n.controlPlaneId)||"").replace(/{consumerId}/gi,((_=t.config)==null?void 0:_.consumerId)||""):t.config.app==="kongManager"&&(G=G.replace(/{workspace}/gi,((O=t.config)==null?void 0:O.workspace)||"").replace(/{consumerId}/gi,((W=t.config)==null?void 0:W.consumerId)||"")),G}),i=h(""),m=A(()=>{const n=t.config.app==="konnect"||t.config.isExactMatch;return n?{isExactMatch:n,fields:{username:y.name,id:{label:a("consumer_groups.list.table_headers.id")}},placeholder:a("consumer_groups.search.placeholder")}:{isExactMatch:n,fields:{name:y.name},schema:t.config.filterSchema}}),f=A(()=>d.value?"consumer_groups":void 0),{fetcher:p,fetcherState:b}=Pt(t.config,q.value,f.value),j=()=>{i.value=""},c=()=>{v.value++},x=h(""),w=A(()=>b.value.status===Y.Loading),L=A(()=>{var n;return b.value.status===Y.Idle&&!!((n=b.value.response)!=null&&n.data.length)}),R=A(()=>!w.value&&(L.value||!!i.value)),X=(n,_)=>{const O=n.id;if(!_(O)){r("copy:error",{entity:n,field:"id",message:a("consumer_groups.errors.copy")});return}r("copy:success",{entity:n,field:"id",message:a("consumer_groups.copy.success",{val:O})})},C=(n,_)=>{const O=JSON.stringify(n);if(!_(O)){r("copy:error",{entity:n,message:a("consumer_groups.errors.copy")});return}r("copy:success",{entity:n,message:a("consumer_groups.copy.success_brief")})},V=async n=>{var _;await((_=t.canRetrieve)==null?void 0:_.call(t,n))&&g.push(t.config.getViewRoute(n.id))},U=n=>({label:a("consumer_groups.actions.view"),to:t.config.getViewRoute(n)}),F=n=>({label:a("consumer_groups.actions.edit"),to:t.config.getEditRoute(n)}),N=h(void 0),ee=h(!1),oe=h(!1),xe=h(""),jt=$t(t.config,q.value),Nt=n=>{N.value=n,ee.value=!0},Ot=()=>{ee.value=!1},Lt=async()=>{var n,_,O;if((n=N.value)!=null&&n.id){oe.value=!0;try{await P.delete(jt(N.value.id)),oe.value=!1,ee.value=!1,v.value++,r("delete:success",N.value)}catch(W){xe.value=((O=(_=W.response)==null?void 0:_.data)==null?void 0:O.message)||W.message||a("consumer_groups.errors.delete"),r("error",W)}finally{oe.value=!1}}},_e=h(!1),Ae=()=>{_e.value=!0},Ee=()=>{_e.value=!1},Be=(n,_)=>{_||Ee(),v.value++,r("add:success",n)},Gt=()=>{d.value&&Ae()},te=h(void 0),we=h(!1),Dt=h(""),zt=n=>{te.value=n,we.value=!0},Me=()=>{we.value=!1,te.value=void 0},Ht=A(()=>{var n,_,O,W;let G=`${t.config.apiBaseUrl}${le.list[t.config.app].oneForConsumer}`;return t.config.app==="konnect"?G=G.replace(/{controlPlaneId}/gi,((n=t.config)==null?void 0:n.controlPlaneId)||"").replace(/{consumerId}/gi,((_=t.config)==null?void 0:_.consumerId)||""):t.config.app==="kongManager"&&(G=G.replace(/{workspace}/gi,((O=t.config)==null?void 0:O.workspace)||"").replace(/{consumerId}/gi,((W=t.config)==null?void 0:W.consumerId)||"")),G}),Ue=h(!1),Wt=async()=>{if(te.value){Ue.value=!0;try{const n=Ht.value.replace(/{consumerGroupId}/gi,te.value.id);await P.delete(n),r("remove:success",te.value),Me(),v.value++}catch(n){Dt.value=n.message||a("consumer_groups.errors.delete"),r("error",n)}finally{Ue.value=!1}}};ce(w,n=>{r("loading",n)},{immediate:!0}),ce(b,n=>{if(n.status===Y.Error){x.value=a("consumer_groups.errors.general"),r("error",n.error);return}x.value=""});const Ce=h({ctaPath:d.value?void 0:t.config.createRoute,ctaText:void 0,message:a("consumer_groups.list.empty_state.description"),title:a("consumer_groups.title")});return ke(async()=>{await t.canCreate()&&(Ce.value.title=d.value?a("consumer_groups.list.empty_state.title_for_consumer"):a("consumer_groups.list.empty_state.title"),Ce.value.ctaText=d.value?a("consumer_groups.actions.add_to_group"):a("consumer_groups.actions.create"))}),(n,_)=>{const O=M("KButton"),W=M("KBadge"),G=M("KTruncate"),ne=M("KDropdownItem"),qe=M("KClipboardProvider"),Jt=M("KPrompt");return T(),D("div",qt,[k(s(ut),{"disable-pagination":s(d),"disable-pagination-page-jump":"","disable-sorting":s(I),"empty-state-options":Ce.value,"enable-entity-actions":"","error-message":x.value,fetcher:s(p),"fetcher-cache-key":v.value,"is-loading":s(w),"pagination-type":"offset","preferences-storage-key":"kong-ui-entities-consumer-groups-list",query:i.value,"row-attributes":K,"table-headers":s(E),onClearSearchInput:j,"onClick:row":_[3]||(_[3]=S=>V(S)),onEmptyStateCtaClicked:Gt,onSort:c},de({"toolbar-filter":u(()=>[s(d)?Z("",!0):pe((T(),H(s(Tt),{key:0,modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=S=>i.value=S),config:s(m)},null,8,["modelValue","config"])),[[me,s(R)]])]),name:u(({rowValue:S})=>[B("b",null,$(S??"-"),1)]),consumers_count:u(({rowValue:S})=>[z($(S??"-"),1)]),tags:u(({rowValue:S})=>[(S==null?void 0:S.length)>0?(T(),H(G,{key:0},{default:u(()=>[(T(!0),D(Ie,null,ge(S,re=>(T(),H(W,{key:re,onClick:_[2]||(_[2]=Zt(()=>{},["stop"]))},{default:u(()=>[z($(re),1)]),_:2},1024))),128))]),_:2},1024)):(T(),D("span",Rt,"-"))]),actions:u(({row:S})=>[k(qe,null,{default:u(({copyToClipboard:re})=>[k(ne,{"data-testid":"action-entity-copy-id",onClick:Qt=>X(S,re)},{default:u(()=>[z($(s(a)("consumer_groups.actions.copy_id")),1)]),_:2},1032,["onClick"])]),_:2},1024),k(qe,null,{default:u(({copyToClipboard:re})=>[k(ne,{"data-testid":"action-entity-copy-json",onClick:Qt=>C(S,re)},{default:u(()=>[z($(s(a)("consumer_groups.actions.copy_json")),1)]),_:2},1032,["onClick"])]),_:2},1024),k(s(ie),{"auth-function":()=>e.canRetrieve(S)},{default:u(()=>[k(ne,{"data-testid":"action-entity-view","has-divider":"",item:U(S.id)},null,8,["item"])]),_:2},1032,["auth-function"]),k(s(ie),{"auth-function":()=>e.canEdit(S)},{default:u(()=>[k(ne,{"data-testid":"action-entity-edit",item:F(S.id)},null,8,["item"])]),_:2},1032,["auth-function"]),k(s(ie),{"auth-function":()=>e.canDelete(S)},{default:u(()=>[k(ne,{"data-testid":"action-entity-delete","has-divider":"","is-dangerous":"",onClick:()=>e.config.consumerId?zt(S):Nt(S)},{default:u(()=>[z($(e.config.consumerId?s(a)("consumer_groups.actions.exit"):s(a)("consumer_groups.actions.delete")),1)]),_:2},1032,["onClick"])]),_:2},1032,["auth-function"])]),_:2},[s(R)?{name:"toolbar-button",fn:u(()=>[k(s(ie),{"auth-function":()=>e.canCreate()},{default:u(()=>[k(O,{appearance:"primary","data-testid":"toolbar-add-consumer-group",icon:"plus",to:e.config.consumerId?void 0:e.config.createRoute,onClick:_[1]||(_[1]=()=>e.config.consumerId?Ae():void 0)},{default:u(()=>[z($(e.config.consumerId?s(a)("consumer_groups.actions.add_to_group"):s(a)("consumer_groups.list.toolbar_actions.new_consumer_group")),1)]),_:1},8,["to"])]),_:1},8,["auth-function"])]),key:"0"}:void 0]),1032,["disable-pagination","disable-sorting","empty-state-options","error-message","fetcher","fetcher-cache-key","is-loading","query","table-headers"]),k(s(pt),{"action-pending":oe.value,"data-testid":"delete-consumer-group-modal",description:s(a)("consumer_groups.delete.description"),"entity-name":N.value&&(N.value.name||N.value.id),"entity-type":s($e).ConsumerGroup,error:xe.value,title:s(a)("consumer_groups.delete.title"),visible:ee.value,onCancel:Ot,onProceed:Lt},null,8,["action-pending","description","entity-name","entity-type","error","title","visible"]),e.config.consumerId?(T(),H(Ut,{key:0,config:e.config,"data-testid":"add-to-group-modal",visible:_e.value,"onAdd:partialSuccess":_[4]||(_[4]=S=>Be(S,!0)),"onAdd:success":_[5]||(_[5]=S=>Be(S)),onCancel:Ee},null,8,["config","visible"])):Z("",!0),e.config.consumerId&&te.value?(T(),H(Jt,{key:1,"data-testid":"exit-group-modal","is-visible":we.value,title:s(a)("consumer_groups.consumers.exit.title"),type:"danger",onCanceled:Me,onProceed:Wt},{"body-content":u(()=>[k(s(l),{class:"exit-modal-message",keypath:e.config.consumerUsername?"consumer_groups.consumers.exit.confirmation":"consumer_groups.consumers.exit.confirmationNoUsername",tag:"p"},de({consumerGroup:u(()=>[B("strong",null,$(te.value.name||te.value.id),1)]),_:2},[e.config.consumerUsername?{name:"consumer",fn:u(()=>[B("strong",null,$(e.config.consumerUsername),1)]),key:"0"}:void 0]),1032,["keypath"]),B("p",null,$(s(a)("consumer_groups.consumers.exit.description")),1)]),_:1},8,["is-visible","title"])):Z("",!0)])}}}),Ft=Ke(Vt,[["__scopeId","data-v-4566ab58"]]);Fe=ae({__name:"List",props:{consumerId:{type:String,required:!1,default:""}},setup(e){const r=e,o=aa("rbac"),t=oa(),{createRedirectRouteQuery:l}=ua(),a=ea(),g=A(()=>t.name!=="consumer_groups"),P=A(()=>g.value?`consumers/${r.consumerId}/consumer_groups`:"consumer_groups"),v={name:{type:"text"}},d=c=>({name:"show-consumer-group",params:{id:c},query:{...l()}}),I=c=>({name:"update-consumer-group",params:{workspace:t.params.workspace,id:c},query:{...l()}}),y=ta({...sa(),consumerId:r.consumerId,createRoute:{name:"create-consumer-group"},getViewRoute:d,getEditRoute:I,filterSchema:v}),E=()=>fe(o,{path:P.value,action:"create"}),K=c=>fe(o,{path:`${P.value}/${c.id}`,action:"delete"}),q=c=>fe(o,{path:`${P.value}/${c.id}`,action:"update"}),i=c=>fe(o,{path:`${P.value}/${c.id}`,action:"read"}),{onCopySuccess:m,onCopyError:f}=na(),p=c=>{const x=c.length;a.notify({message:`Successfully added to ${x} ${x===1?"Consumer Group":"Consumer Groups"}!`,type:"success"})},b=c=>{a.notify({message:`${c.name} Consumer Group successfully deleted!`,type:"success"})},j=c=>{a.notify({message:`Successfully exited from ${c.name??c.id} group!`,type:"success"})};return(c,x)=>(T(),H(s(Ft),{config:y,"can-create":E,"can-delete":K,"can-edit":q,"can-retrieve":i,"onCopy:success":s(m),"onCopy:error":s(f),"onAdd:success":p,"onDelete:success":b,"onRemove:success":j},null,8,["config","onCopy:success","onCopy:error"]))}})});export{da as __tla,Fe as default};
