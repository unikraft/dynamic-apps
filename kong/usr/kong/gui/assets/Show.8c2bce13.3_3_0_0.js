/*
  This software is copyright Kong Inc. and its licensors.
  Use of the software is subject to the agreement between your organization
  and Kong Inc. If there is no such agreement, use is governed by and
  subject to the terms of the Kong Master Software License Agreement found
  at https://konghq.com/enterprisesoftwarelicense/.
*/

import{F as O,__tla as Y}from"./FetchWrapper.51724faf.3_3_0_0.js";import{D as J,T as Z,__tla as G}from"./TagsBlock.4b7d5635.3_3_0_0.js";import{D as X,__tla as tt}from"./DetailContainer.85becad9.3_3_0_0.js";import{E as et,__tla as rt}from"./EntityConfiguration.03651df4.3_3_0_0.js";import{S as at,__tla as ot}from"./StatusCodesWrapper.94765128.3_3_0_0.js";import{_ as v,aI as m,r as o,o as d,c as h,a as u,R as it,U as st,l as _,w as n,d as f,t as g,p as nt,e as lt,z as R,J as dt,Z as ct,Y as b,aF as ut,b as l,h as k,__tla as mt}from"./index.84d84090.3_3_0_0.js";import{D as ht,__tla as _t}from"./DatetimeBlock.a1dc28a1.3_3_0_0.js";import{E as pt,__tla as yt}from"./EntityToggleBadge.6a1cd1fb.3_3_0_0.js";import{B as ft,__tla as gt}from"./Breadcrumbs.6127883e.3_3_0_0.js";import{E as vt,__tla as Rt}from"./EntityDeleteModal.673d985c.3_3_0_0.js";import{d as bt}from"./chartHelpers.1bf67333.3_3_0_0.js";import{R as kt,__tla as Dt}from"./RbacPermMixin.3a5f32ef.3_3_0_0.js";import{a as $t,__tla as Et}from"./Route.a29fff26.3_3_0_0.js";import{E as Mt,__tla as Pt}from"./EntityMixin.2764673d.3_3_0_0.js";import{b as wt}from"./buildRoute.1ddadad0.3_3_0_0.js";import{R as Ct}from"./RedirectMixin.efeb36f2.3_3_0_0.js";import{__tla as At}from"./KDataProvider.78c9bca8.3_3_0_0.js";import{__tla as xt}from"./monaco-editor.90904fcf.3_3_0_0.js";import"./icon-help.699f8c28.3_3_0_0.js";import{__tla as Bt}from"./ChartDataController.a765a4e0.3_3_0_0.js";import{__tla as It}from"./ChartHeader.0a2c695d.3_3_0_0.js";import{__tla as Nt}from"./TimeFramePicker.465b75eb.3_3_0_0.js";import"./TimeFrames.25a2a20b.3_3_0_0.js";import{__tla as Ut}from"./VitalsDisabled.f093ed15.3_3_0_0.js";import{__tla as Tt}from"./LineChartWrapper.be3dd56e.3_3_0_0.js";import{__tla as Ft}from"./ConfirmModalDialog.af276128.3_3_0_0.js";import"./ArrayCardContainerFields.468b3825.3_3_0_0.js";import"./typedefs.6c779761.3_3_0_0.js";import"./index.6d4e40f9.3_3_0_0.js";import"./transform.db23dc95.3_3_0_0.js";import"./marked.esm.77963db0.3_3_0_0.js";import{__tla as St}from"./EntityButton.1838e0e9.3_3_0_0.js";import{__tla as qt}from"./EntityFilter.bf4158bc.3_3_0_0.js";let D,jt=Promise.all([(()=>{try{return Y}catch{}})(),(()=>{try{return G}catch{}})(),(()=>{try{return tt}catch{}})(),(()=>{try{return rt}catch{}})(),(()=>{try{return ot}catch{}})(),(()=>{try{return mt}catch{}})(),(()=>{try{return _t}catch{}})(),(()=>{try{return yt}catch{}})(),(()=>{try{return gt}catch{}})(),(()=>{try{return Rt}catch{}})(),(()=>{try{return Dt}catch{}})(),(()=>{try{return Et}catch{}})(),(()=>{try{return Pt}catch{}})(),(()=>{try{return At}catch{}})(),(()=>{try{return xt}catch{}})(),(()=>{try{return Bt}catch{}})(),(()=>{try{return It}catch{}})(),(()=>{try{return Nt}catch{}})(),(()=>{try{return Ut}catch{}})(),(()=>{try{return Tt}catch{}})(),(()=>{try{return Ft}catch{}})(),(()=>{try{return St}catch{}})(),(()=>{try{return qt}catch{}})()]).then(async()=>{const $={name:"MethodBadges",props:{methods:{type:Array,required:!0}},methods:{methodColors(t){return m[t]||m.DEFAULT}}},E=t=>(nt("data-v-3775a559"),t=t(),lt(),t),M={class:"methods flex items-center"},P=E(()=>u("div",{class:"methods-label"}," Methods ",-1)),w={class:"methods-badges flex items-center"};function C(t,s,r,p,e,a){const y=o("KBadge");return d(),h("div",M,[P,u("div",w,[(d(!0),h(it,null,st(r.methods,c=>(d(),_(y,{key:c,color:a.methodColors(c).foreground,"background-color":a.methodColors(c).background},{default:n(()=>[f(g(c),1)]),_:2},1032,["color","background-color"]))),128))])])}const A=v($,[["render",C],["__scopeId","data-v-3775a559"]]),x={name:"KMRoute",components:{FetchWrapper:O,DetailsHeader:J,DetailContainer:X,Breadcrumbs:ft,StatusCodesWrapper:at,MethodBadges:A,DatetimeBlock:ht,TagsBlock:Z,EntityTags:pt,EntityDeleteModal:vt,EntityConfiguration:et},mixins:[Mt,kt,Ct],props:{entity:{type:Object,default:()=>({name:"Route",path:"route",rootPath:"routes"})},serviceRouteName:{type:String,default:null},pluginRouteNames:{type:Object,default:()=>({selectRouteName:"select-plugin",viewRouteName:"view-plugin"})},canEdit:{type:Boolean,default:!0},serviceId:{type:String,required:!1,default:""}},data(){return{record:null,editRoute:{name:"update-route"},infoTexts:{statusCodes:bt.statusCodesRoute},skeletonProps:{"table-rows":2,"table-columns":3,type:"table"},deleteModalModel:null,redirectRouteAfterDelete:{name:"routes"},navItems:[{key:"show-route",label:"Configuration"},{key:"route-analytics",label:"Analytics"},{key:"route-plugins",label:"Plugins"}]}},computed:{...R(dt,["workspace"]),...R(ct,{config:"infoConfig"}),configSchema(){return $t(this.config.router_flavor)},id(){return this.record&&this.record.id||this.entity.id||this.$route.params.id},resourceEndpoint(){return this.entity.rootPath},actions(){return[{name:"Edit configuration",testAction:"action-edit",isAllowed:this.hasUpdatePerm,handler:this.handleEdit},{name:"Install Plugin",divider:this.hasUpdatePerm,testAction:"action-install-plugin",isAllowed:this.canCreatePlugins,handler:this.installPlugin},{name:"Delete",divider:this.hasUpdatePerm||this.hasUpdatePerm,testAction:"action-delete",isAllowed:this.hasDeletePerm,dangerous:!0,handler:this.confirmDelete}]},title(){return this.record&&this.record.name||""},titleMapping(){let t=b(this.record,"routes")||this.id;return ut(t)&&(t=t.split("-")[0].trim()),{id:t}},chartDataUrls(){return{statusCodes:`status_codes/by_route?route_id=${this.id}`}},entityQuery(){return{entity_id:this.id,entity_type:"route_id"}},entityId(){return this.entity.id||this.$route.query.entity_id},currentEntity(){return{id:this.record.name??this.id,name:"route"}},fields(){return{entity_id:this.id,entity_type:"route_id"}},hasHosts(){return this.record.hosts&&this.record.hosts.length===1&&this.record.protocols.length===1},canCreatePlugins(){return this.hasPerms(["create"],`${this.resourceEndpoint}/${this.id}/plugins`)}},methods:{async handleResolve(t){if(this.record=t,t.service&&t.service.id)try{const{data:s}=await this.$api.findRecord("services",t.service.id);this.record.service={id:s.id,name:b(s,"services")}}catch{}},buildRouteFor({name:t,path:s,redirect:r}){const{entityQuery:p,$route:e}=this;return wt({$route:e,name:t,path:s,fields:{route_id:this.id},query:p,redirect:r})},handleEdit(){this.$router.push({name:this.editRoute.name,params:this.editRoute.params||{id:this.record.id,returnLink:this.$route.fullPath},query:{...this.editRoute.query,...this.createRedirectRouteQuery(),...this.createPostDeleteRouteQuery()}})},installPlugin(){this.$router.push(this.buildRouteFor({name:this.pluginRouteNames.selectRouteName,path:`/${this.$route.params.workspace}/plugins/select`,redirect:this.$router.resolve({name:"route-plugins",params:{id:this.id}}).path}))},confirmDelete(){this.deleteModalModel={record:this.record}},colorizeMethods(t){const{foreground:s,background:r}=m[t]||m.DEFAULT;return{label:t,foreground:s,background:r}}}},B={class:"route-details"},I={class:"flex flex-col gap-2 mt-4"},N={class:"flex items-center justify-between"},U={key:1},T={class:"flex items-center justify-between"};function F(t,s,r,p,e,a){const y=o("Breadcrumbs"),c=o("router-link"),S=o("TagsBlock"),q=o("DatetimeBlock"),j=o("MethodBadges"),L=o("DetailsHeader"),Q=o("EntityTags"),W=o("EntityConfiguration"),z=o("StatusCodesWrapper"),H=o("DetailContainer"),V=o("FetchWrapper"),K=o("EntityDeleteModal");return d(),h("div",null,[l(y,{"title-mapping":a.titleMapping},null,8,["title-mapping"]),l(V,{url:`${r.serviceId?`services/${r.serviceId}/`:""}${a.resourceEndpoint}/${a.id}`,"skeleton-props":e.skeletonProps,onResolve:a.handleResolve},{default:n(()=>[u("section",B,[l(L,{title:a.title,record:e.record,entity:{...r.entity,name:r.entity.name.toLowerCase(),id:a.id},actions:a.actions},{service:n(({value:i})=>[l(c,{to:r.serviceRouteName?{name:r.serviceRouteName}:{path:`/${t.workspace}/services/${i}`},"data-testid":"goto-service"},{default:n(()=>[f(g(i),1)]),_:2},1032,["to"])]),"below-title":n(()=>[u("div",I,[u("div",N,[e.record.tags&&e.record.tags.length?(d(),_(S,{key:0,tags:e.record.tags},null,8,["tags"])):(d(),h("div",U)),l(q,{record:e.record},null,8,["record"])]),u("div",T,[e.record.methods&&e.record.methods.length?(d(),_(j,{key:0,methods:e.record.methods},null,8,["methods"])):k("",!0)])])]),_:1},8,["title","record","entity","actions"])]),l(H,{entity:r.entity,items:e.navItems,"entity-name":"route"},{"show-route":n(()=>[l(W,{record:e.record,"config-schema":a.configSchema,"edit-route":e.editRoute,entity:"routes","entity-name":"route","flatten-actions":""},{methods:n(({value:i})=>[l(Q,{tags:(i||[]).map(a.colorizeMethods)},null,8,["tags"])]),service:n(({value:i})=>[i&&i.id?(d(),_(c,{key:0,to:r.serviceRouteName?{name:r.serviceRouteName}:{path:`/${t.workspace}/services/${i.id}`},"data-testid":"goto-service"},{default:n(()=>[f(g(i.name||i.id),1)]),_:2},1032,["to"])):k("",!0)]),_:1},8,["record","config-schema","edit-route"])]),"route-analytics":n(()=>[l(z,{entity:a.currentEntity,"info-texts":e.infoTexts,"chart-data-urls":a.chartDataUrls,"is-card-view":"","as-detail-tab-content":"",title:"Analytics"},null,8,["entity","info-texts","chart-data-urls"])]),_:1},8,["entity","items"])]),_:1},8,["url","skeleton-props","onResolve"]),l(K,{modelValue:e.deleteModalModel,"onUpdate:modelValue":s[0]||(s[0]=i=>e.deleteModalModel=i),entity:r.entity.rootPath,"entity-name":r.entity.name,"redirect-route":e.redirectRouteAfterDelete,class:"defaultModal"},null,8,["modelValue","entity","entity-name","redirect-route"])])}D=v(x,[["render",F],["__scopeId","data-v-f416c050"]])});export{jt as __tla,D as default};
